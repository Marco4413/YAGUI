local a=settings.get("YAGUI_PATH")if not(type(a)=="string")then printError("YAGUI is not installed, please install it by opening it with argument \"setup\".")return end;if not fs.exists(a)then printError("Couldn't find YAGUI in path: \""..a.."\", Please reinstall it by opening it with argument \"setup\".")return end;local b=dofile(a)local c="new"local d=".txt"local e=1;local f=20;local g=6;local h=true;local i=0.5;local j=string.char(149)local k=0.5;local l=colors.white;local m=nil;local n=colors.white;local o=colors.black;local p=colors.gray;local q=colors.lightGray;local r=colors.green;local s=colors.red;local t=colors.yellow;local u=colors.blue;local v=colors.orange;local w=colors.green;local x=colors.red;local y=true;local z=true;local A=c..d;local B=shell.resolve(A)local C={"1","2","3","4","5","6","7","8","9","0"}local D={...}b.screen_buffer.buffer.background=p;local E={}local F={}local function G(H,I)if not F[I]then F[I]={}end;for J,K in next,H do F[I][J]=K end end;G({["and"]=true,["break"]=true,["do"]=true,["else"]=true,["elseif"]=true,["end"]=true,["false"]=true,["for"]=true,["function"]=true,["if"]=true,["in"]=true,["local"]=true,["nil"]=true,["not"]=true,["or"]=true,["repeat"]=true,["return"]=true,["then"]=true,["true"]=true,["until"]=true,["while"]=true},t)G({["bit"]=true,["colors"]=true,["colours"]=true,["commands"]=true,["coroutine"]=true,["disk"]=true,["fs"]=true,["gps"]=true,["help"]=true,["http"]=true,["io"]=true,["keys"]=true,["math"]=true,["multishell"]=true,["os"]=true,["paintutils"]=true,["parallel"]=true,["peripheral"]=true,["rednet"]=true,["redstone"]=true,["rs"]=true,["settings"]=true,["shell"]=true,["string"]=true,["table"]=true,["term"]=true,["textutils"]=true,["turtle"]=true,["pocket"]=true,["vector"]=true,["window"]=true,["YAGUI"]=true},u)G({["info"]=true,["generic_utils"]=true,["string_utils"]=true,["math_utils"]=true,["table_utils"]=true,["color_utils"]=true,["event_utils"]=true,["setting_utils"]=true,["monitor_utils"]=true,["screen_buffer"]=true,["input"]=true,["gui_elements"]=true,["WSS"]=true,["wireless_screen_share"]=true,["FT"]=true,["file_transfer"]=true,["Loop"]=true,["self"]=true},v)local L=b.Loop(f,g)local M=b.Loop(f,g)local N=b.Loop(f,g)local O={["main"]=L,["input"]=M,["overwrite"]=N}local P=b.WSS(e)local Q=b.gui_elements.Label(0,0,"Lines: 0",n)local R=b.gui_elements.Label(0,0,"Cursor: (1; 1)",n)local S=b.gui_elements.Button(0,0,0,0,"C",n,r,s)local T=b.gui_elements.Memo(0,0,0,0,n,o)local U=b.gui_elements.Label(0,0,"/path/",n)S.timed.enabled=true;S.timed.clock.interval=i;S.shortcut={b.KEY_LEFTCTRL,b.KEY_LEFTSHIFT,b.KEY_C}T.cursor.text=j;T.cursor.blink.interval=k;T.colors.cursor=m;T.colors.cursor_text=l;T.border=true;T.colors.border_color=p;local V=b.gui_elements.Button(0,0,0,0,"File",n,q,p)local W=b.gui_elements.Window(0,0,0,0,p,y)local X=b.gui_elements.Button(0,0,0,0,"New/Open",n,q,p)local Y=b.gui_elements.Button(0,0,0,0,"Save",n,q,p)local Z=b.gui_elements.Button(0,0,0,0,"SaveAs",n,q,p)local _=b.gui_elements.Button(0,0,0,0,"Delete",n,q,p)local a0=b.gui_elements.Button(0,0,0,0,"Goto",n,q,p)local a1=b.gui_elements.Button(0,0,0,0,"Run",n,q,p)local a2=b.gui_elements.Button(0,0,0,0,"SyntaxHL",n,q,p)local a3=b.gui_elements.Button(0,0,0,0,"Exit",n,r,s)W.draw_priority=b.LOW_PRIORITY;W.hidden=true;W.dragging.enabled=false;W.resizing.enabled=false;W:set_elements({X,Y,Z,_,a0,a1,a2,a3})X.timed.enabled=true;X.timed.clock.interval=i/2;Y.timed.enabled=true;Y.timed.clock.interval=i;Z.timed.enabled=true;Z.timed.clock.interval=i/2;_.timed.enabled=true;_.timed.clock.interval=i;a0.timed.enabled=true;a0.timed.clock.interval=i/2;a1.timed.enabled=true;a1.timed.clock.interval=i;a3.timed.enabled=true;a3.timed.clock.interval=i;V.shortcut={b.KEY_LEFTCTRL,b.KEY_TAB}a2.active=z;local a4=b.gui_elements.Label(0,0,"",n)local a5=b.gui_elements.Memo(0,0,0,0,n,q)local a6=b.gui_elements.Label(0,0,"You can press CONTROL to cancel.",n)a5.limits=b.math_utils.Vector2(0,1)a5.cursor.text=j;a5.cursor.blink.interval=k;a5.colors.cursor=m;a5.colors.cursor_text=l;a5.border=true;a5.colors.border_color=p;local a7=b.gui_elements.Window(0,0,0,0,q,y)local a8=b.gui_elements.Label(0,0,"Do you want\nto overwrite?",n)local a9=b.gui_elements.Button(0,0,0,0,"Yes",n,p,q)local aa=b.gui_elements.Button(0,0,0,0,"No",n,p,q)a7:set_elements({a8,a9,aa})a9.timed.enabled=true;a9.timed.clock.interval=i;aa.timed.enabled=true;aa.timed.clock.interval=i;a9.shortcut={b.KEY_Y}aa.shortcut={b.KEY_N}a8.text_alignment=b.ALIGN_CENTER;local function ab()local ac,ad=term.getSize()local ae={["all"]={lLines=function()return 9,1 end,lCursor=function()return ac-5,1,b.ALIGN_RIGHT end,bCompact=function()return ac,1,1,1 end,mEditor=function()return 1,2,ac,ad-2 end,lPath=function()return 1,ad end,bFile=function()return 1,1,4,1 end,wFileMenu=function()return 1,2,10,8 end,bNewOpen=function()return 1,1,10,1 end,bSave=function()return 1,2,10,1 end,bSaveAs=function()return 1,3,10,1 end,bDelete=function()return 1,4,10,1 end,bGoto=function()return 1,5,10,1 end,bRun=function()return 1,6,10,1 end,bSHL=function()return 1,7,10,1 end,bQuit=function()return 1,8,10,1 end,lInputTitle=function()return 3,math.floor(ad/2-1)end,mInput=function()return 1,math.floor(ad/2)-1,ac,3 end,lInputTip=function()return 3,math.floor(ad/2+2),"You can press CONTROL to cancel."end,wOverWrite=function()return math.floor(ac/2-7),math.floor(ad/2-3),15,6 end,lOW=function()return 8,2 end,bOWAccept=function()return 2,5,3,1 end,bOWReject=function()return 13,5,2,1 end,stats=function()return ac-1,ad-1 end},[b.COMPUTER]={},[b.TURTLE]={},[b.POCKET]={lCursor=function()return 1,ad-1,b.ALIGN_LEFT end,mEditor=function()return 1,2,ac,ad-3 end,lPath=function()return 1,ad end,lInputTip=function()return 3,math.floor(ad/2+2),"You can press\nCONTROL to cancel."end},["this_layout"]={}}local af,ag=b.generic_utils.get_computer_type()ae.this_layout=ae.all;for ah,ai in next,ae[af]do ae.this_layout[ah]=ai end;E=ae.this_layout end;local function aj()Q.pos.x,Q.pos.y=E.lLines()R.pos.x,R.pos.y,R.text_alignment=E.lCursor()S.pos.x,S.pos.y,S.size.x,S.size.y=E.bCompact()T.pos.x,T.pos.y,T.size.x,T.size.y=E.mEditor()U.pos.x,U.pos.y=E.lPath()V.pos.x,V.pos.y,V.size.x,V.size.y=E.bFile()W.pos.x,W.pos.y,W.size.x,W.size.y=E.wFileMenu()X.pos.x,X.pos.y,X.size.x,X.size.y=E.bNewOpen()Y.pos.x,Y.pos.y,Y.size.x,Y.size.y=E.bSave()Z.pos.x,Z.pos.y,Z.size.x,Z.size.y=E.bSaveAs()_.pos.x,_.pos.y,_.size.x,_.size.y=E.bDelete()a0.pos.x,a0.pos.y,a0.size.x,a0.size.y=E.bGoto()a1.pos.x,a1.pos.y,a1.size.x,a1.size.y=E.bRun()a2.pos.x,a2.pos.y,a2.size.x,a2.size.y=E.bSHL()a3.pos.x,a3.pos.y,a3.size.x,a3.size.y=E.bQuit()a4.pos.x,a4.pos.y=E.lInputTitle()a5.pos.x,a5.pos.y,a5.size.x,a5.size.y=E.mInput()a6.pos.x,a6.pos.y,a6.text=E.lInputTip()a7.pos.x,a7.pos.y,a7.size.x,a7.size.y=E.wOverWrite()a7.resizing.min_size=a7.size:duplicate()a7.resizing.max_size=a7.size:duplicate()*2;a8.pos.x,a8.pos.y=E.lOW()a9.pos.x,a9.pos.y,a9.size.x,a9.size.y=E.bOWAccept()aa.pos.x,aa.pos.y,aa.size.x,aa.size.y=E.bOWReject()a8.offset=b.math_utils.Vector2.new(0,b.math_utils.round(a7.size.y/2)-a8.pos.y)for ah,ak in next,O do ak.stats.pos=b.math_utils.Vector2(E.stats())ak.stats:update_pos()end end;local function al()for ah,am in next,L.monitors do b.monitor_utils.better_clear(am)end end;local function an()T.rich_text={}if T.focussed then T.rich_text[T.cursor.pos.y]={["background"]=p}end end;local ao={}local function ap(aq,ar)local as=b.color_utils.colors[n]local at=b.color_utils.colors[w]local au=b.color_utils.colors[x]local function av(aw,ax,ay)return aw:sub(0,ax-1)..ay..aw:sub(ax+1)end;aq=aq or T.first_visible_line;ar=ar or T.first_visible_line+T.size.y-1;local az="code"local aA="none"local aB=false;local aC=""local aD=ao[aq-1]if aD then az=aD.state;aA=aD.nested_state;aB=aD.quote_ignore;aC=aD.current_quote end;for aE=aq,ar do if not T.rich_text[aE]then T.rich_text[aE]={}end;local aF=T.lines[aE]if not aF then break end;local aG=""local aH=b.string_utils.split(aF,"[^%w_]")local ax=0;for ah,J in next,aH do for aI,aJ in next,F do if aJ[J]then aG=aG..string.rep(b.color_utils.colors[n],ax-#aG)..string.rep(b.color_utils.colors[aI],#J)end end;ax=ax+#J+1 end;aG=aG..b.color_utils.colors[n]for aK=1,#aF do local ay=aF:sub(aK,aK)if az=="code"then if ay=="\""then aG=av(aG,aK,au)if aK~=#aF then az="string"aC="\""end elseif ay=="'"then aG=av(aG,aK,au)if aK~=#aF then az="string"aC="'"end elseif aF:sub(aK,aK+1)=="[["then az="long-string"aG=av(aG,aK,au)elseif aF:sub(aK,aK+1)=="--"then if aF:sub(aK,aK+3)=="--[["then az="closed-comment"aG=av(aG,aK,at)else az="comment"aG=av(aG,aK,at)end elseif aK>#aG then aG=av(aG,aK,as)end elseif az=="string"then aG=av(aG,aK,au)if ay=="\\"then if aK==#aF then aA="multi-line"else local aL=aF:sub(aK+1,aK+1)if aL==aC then aB=true end end elseif aA=="none"and aK==#aF then aB=false;aC=""az="code"elseif ay==aC then if aB then aB=false else aC=""az="code"aA="none"end else aA="none"end elseif az=="long-string"then aG=av(aG,aK,au)if aF:sub(aK,aK+1)=="]]"then aG=av(aG,aK+1,au)az="code"end elseif az=="comment"then aG=aG:sub(0,aK-1)az="code"break elseif az=="closed-comment"then aG=av(aG,aK,at)if aF:sub(aK,aK+1)=="]]"then aG=av(aG,aK+1,at)az="code"end end end;ao[aE]={["state"]=az,["nested_state"]=aA,["quote_ignore"]=aB,["current_quote"]=aC}T.rich_text[aE].foreground=aG end end;local function aM(aN)aN=shell.resolve(aN)if#aN:gsub(" ","")==0 then aN=A end;if b.string_utils.get_extension(aN)==""then aN=aN..d end;if fs.isDir(aN)then return end;T:clear()B=aN;if fs.exists(aN)then local aO=fs.open(aN,"r")local aP=pcall(T.write,T,aO.readAll())if not aP then al()P:close()error("It took too long to open the file")end;aO.close()else local aO=fs.open(aN,"w")aO.write("")aO.close()end;T:set_cursor(1,1)if z then ap(1)end end;local function aQ(aN)aN=shell.resolve(aN)if#aN:gsub(" ","")==0 then aN=B end;if fs.isDir(aN)then return end;if fs.isReadOnly(aN)then return end;B=aN;local aO=fs.open(aN,"w")aO.write(b.string_utils.join(T.lines,"\n"))aO.close()end;V:set_callback(b.ONPRESS,function(self)W.hidden=not self.active end)W:set_callback(b.ONFAILEDPRESS,function(self)if V.active then self.hidden=true;V.active=false end end)X:set_callback(b.ONTIMEOUT,function(self)a4.text=" New File / Open File "a5.bound=self;M:start()end)X.callbacks.onActionComplete=function(aN)if aN then aN=shell.resolve(aN)aM(aN)else aM(A)end end;Y:set_callback(b.ONTIMEOUT,function(self)aQ(B)end)Z:set_callback(b.ONTIMEOUT,function(self)a4.text=" Save File As "a5.bound=self;M:start()end)Z.callbacks.onActionComplete=function(aN)if not aN then aN=B end;aN=shell.resolve(aN)if fs.exists(aN)then a9.bound=Z;Z.path=aN;N:start()else aQ(aN)end end;Z.callbacks.onOverWrite=function()aQ(Z.path)Z.path=nil end;_:set_callback(b.ONTIMEOUT,function(self)if fs.isReadOnly(B)then return end;fs.delete(B)end)a0:set_callback(b.ONTIMEOUT,function(self)a4.text=" Go to Line "a5.bound=self;a5.whitelist=C;M:start()end)a0.callbacks.onActionComplete=function(aF)T:set_cursor(1,tonumber(aF)or T.cursor.pos.y)end;a1:set_callback(b.ONTIMEOUT,function(self)aQ(B)local aR=shell.openTab(B)shell.switchTab(aR)end)a2:set_callback(b.ONPRESS,function(self)z=self.active;if z then ap(1)else an()end end)a3:set_callback(b.ONTIMEOUT,function(self)L:stop()end)S:set_callback(b.ONTIMEOUT,function(self)local aS={}for aT=1,#T.lines do local aF=T.lines[aT]if not aF then break end;local aU=aF:gsub(" ","")if#aU==0 then table.insert(aS,1,aT)end end;for ah,aV in next,aS do table.remove(T.lines,aV)end;T:set_cursor(1,1)if z then ap(1)end end)T:set_callback(b.ONFOCUS,function(self)if not self.focussed then local aW=self.rich_text[self.cursor.pos.y]if aW and aW.foreground then aW.background=nil else self.rich_text[self.cursor.pos.y]=nil end end end)T:set_callback(b.ONMOUSESCROLL,function(self)return true end)T:set_callback(b.ONCURSORCHANGE,function(self,aX,aY)local aZ=self.rich_text[self.cursor.pos.y]if aZ and aZ["foreground"]then aZ["background"]=nil else self.rich_text[self.cursor.pos.y]=nil end;if self.focussed then local a_=self.rich_text[aY]if a_ and a_["foreground"]then a_["background"]=p else self.rich_text[aY]={["background"]=p}end end end)T:set_callback(b.ONWRITE,function(self,b0,b1)if z then ap(math.max(1,self.cursor.pos.y-#b1),#self.lines)end end)L:set_callback(b.ONCLOCK,function(self)Q.text=string.format("Lines: %d",#T.lines)R.text="Cursor: "..tostring(T.cursor.pos)U.text="/"..B end)L:set_callback(b.ONEVENT,function(self,b2)if b.input:are_keys_pressed(true,b.KEY_LEFTCTRL,b.KEY_LEFTALT,b.KEY_S)then Z.callbacks.onPress(Z,b2)elseif b.input:are_keys_pressed(true,b.KEY_LEFTCTRL,b.KEY_N)then X.callbacks.onPress(X,b2)elseif b.input:are_keys_pressed(true,b.KEY_LEFTCTRL,b.KEY_S)then Y.callbacks.onTimeout(Y,b2)elseif b.input:are_keys_pressed(true,b.KEY_LEFTCTRL,b.KEY_G)then a0.callbacks.onPress(a0,b2)elseif b.input:are_keys_pressed(true,b.KEY_LEFTALT,b.KEY_R)then a1.callbacks.onTimeout(a1,b2)elseif not T.focussed then if b.input:are_keys_pressed(false,b.KEY_LEFTCTRL,b.KEY_LEFT)then T.first_visible_char=math.max(1,T.first_visible_char-1)elseif b.input:are_keys_pressed(false,b.KEY_LEFTCTRL,b.KEY_RIGHT)then T.first_visible_char=T.first_visible_char+1 end;if b.input:are_keys_pressed(false,b.KEY_LEFTCTRL,b.KEY_UP)then T.first_visible_line=math.max(1,T.first_visible_line-1)elseif b.input:are_keys_pressed(false,b.KEY_LEFTCTRL,b.KEY_DOWN)then T.first_visible_line=math.min(#T.lines,T.first_visible_line+1)end end;if b2.name==b.MOUSESCROLL then T.first_visible_line=b.math_utils.constrain(T.first_visible_line+b2.direction,1,#T.lines)elseif b2.name==b.TERMRESIZE then ab()aj()end;if z and T.first_visible_line+T.size.y-1>#ao then ap(#ao)end end)a5:set_callback(b.ONKEY,function(self,b2)if b2.key==b.KEY_ENTER then self.bound.callbacks.onActionComplete(self.lines[1])M:stop()return true end end)M:set_callback(b.ONSTART,function(self)a5:focus(true)end)M:set_callback(b.ONEVENT,function(self,b2)if b2.name==b.KEY then if b2.key==b.KEY_LEFTCTRL or b2.key==b.KEY_RIGHTCTRL then M:stop()return true end elseif b2.name==b.TERMRESIZE then ab()aj()end end)M:set_callback(b.ONSTOP,function(self)a5.bound=nil;a5.whitelist={}a5:clear()a5:focus(false)end)a7:set_callback(b.ONRESIZE,function(self,b3,b4,b5,b6)a8.pos=b.math_utils.Vector2(self.size.x/2,self.size.y/2)-a8.offset;a9.pos.y=self.size.y-1;aa.pos.x=self.size.x-2;aa.pos.y=self.size.y-1 end)a9:set_callback(b.ONTIMEOUT,function(self)self.bound.callbacks.onOverWrite()self.bound=nil;N:stop()end)aa:set_callback(b.ONTIMEOUT,function(self)N:stop()end)N:set_callback(b.ONEVENT,function(self,b2)if b2.name==b.TERMRESIZE then ab()aj()end end)ab()aj()if#D>0 then if D[1]:lower()=="help"then local b1={{text="Note <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - open <PATH> (opens file at PATH)",foreground=colors.yellow,background=nil},{text=" - multi <MONITORS> (sets MONITORS\n   as io for the app)",foreground=colors.green,background=nil},{text=" - wss <MODEM_SIDE> [BROADCAST_INTERVAL]\n   (hosts a WSS server using the modem\n   on MODEM_SIDE and updates connected users\n   every BROADCAST_INTERVAL seconds)",foreground=colors.blue,background=nil}}for ah,aF in next,b1 do b.monitor_utils.better_print(term,aF.foreground,aF.background,aF.text)end;return end;local b7={open={},multi={},wss={}}local b8;for ah,K in next,D do if b8 then table.insert(b7[b8],K)end;local b9=K:lower()if b9~=b8 and b7[b9]then b8=b9 end end;if#b7.open>0 then B=b7.open[1]end;if#b7.multi>0 then table.insert(b7.multi,1,"terminal")for ah,ak in next,O do ak:set_monitors(b7.multi)end end;if#b7.wss>0 then if b7.wss[1]then local ba=b7.wss[1]if peripheral.getType(ba)~="modem"then b.monitor_utils.better_print(term,colors.red,nil,"Modem: ",ba," wasn't found.")return end;P:use_side(ba)P:host()P.broadcast_clock.interval=tonumber(b7.wss[2])or P.broadcast_clock.interval end end end;aM(B)L:set_elements({V,W,Q,R,S,T,U,P})M:set_elements({a4,a5,a6,P})N:set_elements({a7,P})for ah,ak in next,O do ak.stats.elements.FPS_label.text_alignment=b.ALIGN_RIGHT;ak.stats.elements.EPS_label.text_alignment=b.ALIGN_RIGHT;ak.stats:show(h)ak.options.raw_mode=true;ak.options.stop_on_terminate=false end;L.options.stop_on_terminate=true;L:start()al()P:close()