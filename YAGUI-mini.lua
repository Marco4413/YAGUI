--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.16.5",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI/",documentation="https://hds536jhmk.github.io/YAGUI/",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",MOUSEDRAG="mouse_drag",MOUSESCROLL="mouse_scroll",CHAR="char",KEY="key",KEYUP="key_up",PASTE="paste",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONSTART=1,ONSTOP=2,ONDRAW=3,ONPRESS=4,ONFAILEDPRESS=5,ONTIMEOUT=6,ONCLOCK=7,ONEVENT=8,ONFOCUS=9,ONKEY=10,ONCHAR=11,MOUSE_LEFT=1,MOUSE_RIGHT=2,MOUSE_MIDDLE=3,SCROLL_UP=-1,SCROLL_DOWN=1,COMPUTER="computer",TURTLE="turtle",POCKET="pocket",ALIGN_LEFT=1,ALIGN_CENTER=2}for c,d in next,keys do if type(d)=="number"then b["KEY_"..c:upper()]=d end end;local e={set_callback=function(f,g,h)if g==b.ONSTART then f.callbacks.onStart=h elseif g==b.ONSTOP then f.callbacks.onStop=h elseif g==b.ONDRAW then f.callbacks.onDraw=h elseif g==b.ONPRESS then f.callbacks.onPress=h elseif g==b.ONFAILEDPRESS then f.callbacks.onFailedPress=h elseif g==b.ONTIMEOUT then f.callbacks.onTimeout=h elseif g==b.ONCLOCK then f.callbacks.onClock=h elseif g==b.ONEVENT then f.callbacks.onEvent=h elseif g==b.ONFOCUS then f.callbacks.onFocus=h elseif g==b.ONKEY then f.callbacks.onKey=h elseif g==b.ONCHAR then f.callbacks.onChar=h end end,get_computer_type=function()local i=b.COMPUTER;if turtle then i=b.TURTLE elseif pocket then i=b.POCKET end;return i,term.isColor()end}local j={}j={magic_characters={"(",")",".","%","+","-","*","?","[","]","^","$"},join=function(k,l)if not l then l=""end;local m=""for d=1,#k do local n=k[d]m=m..tostring(n)if d<#k then m=m..l end end;return m end,split=function(m,l)local k={}if not(#l>0)then return k end;while true do local o=m:find(l)if o then table.insert(k,m:sub(1,o-1))m=m:sub(o+1)else table.insert(k,m)break end end;return k end,compare_versions=function(p,q)local r=j.split(p,".")local s=j.split(q,".")local t=#r;local u=#s;for v=1,math.min(t,u)do if tonumber(r[v])>tonumber(s[v])then return 1 elseif tonumber(r[v])<tonumber(s[v])then return-1 end end;if t>u then return 1 elseif t<u then return-1 end;return 0 end,escape_magic_characters=function(m)for d,w in next,j.magic_characters do m=m:gsub("[%"..w.."]",'%%%'..w)end;return m end,get_extension=function(x)local y,z=x:gsub(".*%.","")if z>0 then return y end;return""end}local A={}A={Vector2={new=function(B,C)local D={x=B or 0,y=C or 0}setmetatable(D,A.Vector2)return D end,duplicate=function(self)return A.Vector2.new(self.x,self.y)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y end,cross=function(self,E)return self.x*E.y-self.y*E.x end,rotate=function(self,F)local G=math.cos(F)local H=math.sin(F)return A.Vector2.new(G*self.x-H*self.y,H*self.x+G*self.y)end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y)else return string.format("(%f; %f)",self.x,self.y)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector2.new(self.x+E.x,self.y+E.y)end,__sub=function(self,E)return A.Vector2.new(self.x-E.x,self.y-E.y)end,__mul=function(self,J)if type(self)=="number"then return A.Vector2.new(J.x*self,J.y*self)else return A.Vector2.new(self.x*J,self.y*J)end end,__div=function(self,J)return A.Vector2.new(self.x/J,self.y/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},Vector3={new=function(B,C,K)local L={x=B or 0,y=C or 0,z=K or 0}setmetatable(L,A.Vector3)return L end,duplicate=function(self)return A.Vector3.new(self.x,self.y,self.z)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)+math.pow(self.z,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y+self.z*E.z end,cross=function(self,E)return A.Vector3.new(self.y*E.z-self.z*E.y,self.z*E.x-self.x*E.z,self.x*E.y-self.y*E.x)end,rotate=function(self,M,F)local G=math.cos(F)return G*self+math.sin(F)*M:cross(self)+(1-G)*M:dot(self)*M end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y,self.z)else return string.format("(%f; %f; %f)",self.x,self.y,self.z)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector3.new(self.x+E.x,self.y+E.y,self.z+E.z)end,__sub=function(self,E)return A.Vector3.new(self.x-E.x,self.y-E.y,self.z-E.z)end,__mul=function(self,J)if type(self)=="number"then return A.Vector3.new(J.x*self,J.y*self,J.z*self)else return A.Vector3.new(self.x*J,self.y*J,self.z*J)end end,__div=function(self,J)return A.Vector3.new(self.x/J,self.y/J,self.z/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},map=function(n,N,O,P,Q,R)local S=(n-N)/(O-N)*(Q-P)+P;if R then return A.constrain(S,P,Q)end;return S end,constrain=function(n,T,U)return math.min(U,math.max(T,n))end,round=function(J)return math.floor(J+0.5)end,round_numbers=function(...)local V={...}local W={}for d,J in next,V do table.insert(W,A.round(J))end;return table.unpack(W)end,floor_numbers=function(...)local V={...}local X={}for d,J in next,V do table.insert(X,math.floor(J))end;return table.unpack(X)end,ceil_numbers=function(...)local V={...}local Y={}for d,J in next,V do table.insert(Y,math.ceil(J))end;return table.unpack(Y)end}A.Vector2.__index=A.Vector2;A.Vector3.__index=A.Vector3;A.Vector2.ONE=A.Vector2.new(1,1)A.Vector2.UP=A.Vector2.new(0,-1)A.Vector2.DOWN=A.Vector2.new(0,1)A.Vector2.LEFT=A.Vector2.new(-1,0)A.Vector2.RIGHT=A.Vector2.new(1,0)A.Vector2.ZERO=A.Vector2.new(0,0)A.Vector3.ONE=A.Vector3.new(1,1,1)A.Vector3.UP=A.Vector3.new(0,1,0)A.Vector3.DOWN=A.Vector3.new(0,-1,0)A.Vector3.LEFT=A.Vector3.new(-1,0,0)A.Vector3.RIGHT=A.Vector3.new(1,0,0)A.Vector3.FORWARD=A.Vector3.new(0,0,1)A.Vector3.BACK=A.Vector3.new(0,0,-1)A.Vector3.ZERO=A.Vector3.new(0,0,0)local Z={}Z={has_value=function(k,n)for _,a0 in next,k do if a0==n then return true,_ end end;return false,nil end,has_key=function(k,d)if k[d]~=nil then return true,k[d]end;return false,nil end,serialise=function(k,a1,a2,a3,a4,a5,a6,a7)local a1=a1 or 0;local a5=a5 or"  "local a8=0;local a6=a6 or"\n"local a7=a7 or" "if not a2 then a5,a6,a7="","",""end;local function a9(k)local aa=a5:rep(a8+1)local ab="{"..a6;local function ac(k)for d,n in next,k do local ad=type(d)local ae;if ad=="string"then ae=string.format("%q",d)else ae=tostring(d)end;if not a4 and d=="__index"then n={}end;local af=type(n)local ag=tostring(n)ab=ab..string.format("%s[%s]%s=%s",aa,ae,a7,a7)if af=="table"then if a8<a1 then a8=a8+1;ab=ab..a9(n)a8=a8-1 else ab=ab.."{}"end elseif af=="string"or af=="function"then ab=ab..string.format("%q",ag)else ab=ab..string.format("%s",ag)end;if next(k,d)then ab=ab..","..a6 else ab=ab..a6 end end end;local ah=getmetatable(k)if a3 and ah then ac(ah)if next(k)then ab=ab:sub(1,#ab-#a6)..","..ab:sub(#ab-#a6+1)end end;ac(k)ab=ab..a5:rep(a8).."}"return ab end;return a9(k)end,unserialise=textutils.unserialise,unserialize=textutils.unserialize}Z.serialize=Z.serialise;local ai={}ai={colors={[1]="0",[2]="1",[4]="2",[8]="3",[16]="4",[32]="5",[64]="6",[128]="7",[256]="8",[512]="9",[1024]="a",[2048]="b",[4096]="c",[8192]="d",[16384]="e",[32768]="f"},color_to_paint=function(aj)return ai.colors[aj]end,paint_to_color=function(ak)local al,aj=Z.has_value(ai.colors,ak)if al then return aj end end}local am={is_area_pressed=function(an,ao,B,C,ap,aq)if an>=B and an<B+ap then if ao>=C and ao<C+aq then return true end end;return false end,format_event_table=function(ar)local g={}g.name=ar[1]if g.name=="mouse_click"then g.name=b.TOUCH;g.from="terminal"g.button=ar[2]g.x=ar[3]g.y=ar[4]return g elseif g.name=="monitor_touch"then g.name=b.TOUCH;g.from=ar[2]g.button=1;g.x=ar[3]g.y=ar[4]return g elseif g.name=="mouse_drag"then g.name=b.MOUSEDRAG;g.button=ar[2]g.x=ar[3]g.y=ar[4]return g elseif g.name=="mouse_up"then g.name=b.MOUSEUP;g.button=ar[2]g.x=ar[3]g.y=ar[4]return g elseif g.name=="mouse_scroll"then g.name=b.MOUSESCROLL;g.direction=ar[2]g.x=ar[3]g.y=ar[4]return g elseif g.name=="char"then g.name=b.CHAR;g.char=ar[2]return g elseif g.name=="key"then g.name=b.KEY;g.key=ar[2]return g elseif g.name=="key_up"then g.name=b.KEYUP;g.key=ar[2]return g elseif g.name=="paste"then g.name=b.PASTE;g.paste=ar[2]return g end;table.remove(ar,1)g.parameters=ar;return g end}local as={}as={_path="/.settings",set=function(at,n)settings.set(at,n)settings.save(as._path)end,unset=function(at)settings.unset(at)settings.save(as._path)end,get=function(at)return settings.get(at)end}local au={get_monitors=function(av)local aw={}for d,ax in next,av do if ax=="terminal"then aw[ax]=term else if peripheral.getType(ax)=="monitor"then aw[ax]=peripheral.wrap(ax)end end end;return aw end,better_print=function(ay,az,aA,...)local aB=j.join({...},"")local aC=ay.getTextColor()local aD=ay.getBackgroundColor()if az then ay.setTextColor(az)end;if aA then ay.setBackgroundColor(aA)end;print(aB)ay.setTextColor(aC)ay.setBackgroundColor(aD)end,better_clear=function(ay)ay.clear()ay.setCursorPos(1,1)end}local aE={frame={pixels={},background=nil},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,B,C)B=tostring(B)C=tostring(C)if self.pixels[B]then if self.pixels[B][C]then return true end end;return false end,get_pixel=function(self,B,C)B=tostring(B)C=tostring(C)if self:is_pixel_custom(B,C)then return self.pixels[B][C]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,B,C,char,az,aA)B=tostring(B)C=tostring(C)local aF=self:get_pixel(B,C)if char and#char==1 then aF.char=char end;aF.foreground=az or aF.background;aF.background=aA or aF.background;if not self.pixels[B]then self.pixels[B]={}end;self.pixels[B][C]=aF end,clear=function(self)self.pixels={}end},set_screens=function(self,aG)self.screens=au.get_monitors(aG)end,set_monitors=function(self,av)self:set_screens(av)end,clear=function(self)self.buffer:clear()end,draw=function(self)local aH=self.screens;local aI=self.buffer;for aJ,aK in next,aH do local aL,aM=aK.getCursorPos()local ap,aq=aK.getSize()for C=1,aq do local aN={text="",background="",foreground=""}for B=1,ap do local aF=aI:get_pixel(B,C)aN.text=aN.text..aF.char;aN.background=aN.background..ai.colors[aF.background]aN.foreground=aN.foreground..ai.colors[aF.foreground]end;aK.setCursorPos(1,C)aK.blit(aN.text,aN.foreground,aN.background)end;aK.setCursorPos(aL,aM)end;self.frame.pixels=self.buffer.pixels;self.frame.background=self.buffer.background;if self.clear_after_draw then self:clear()end end,point=function(self,B,C,aj)self.buffer:set_pixel(B,C," ",aj,aj)end,write=function(self,B,C,aO,az,aA)for aP=0,#aO-1 do char=aO:sub(aP+1,aP+1)self.buffer:set_pixel(B+aP,C,char,az,aA)end end,rectangle=function(self,B,C,ap,aq,aj)for aP=0,ap-1 do for aQ=0,aq-1 do self:point(B+aP,C+aQ,aj)end end end,line=function(self,aR,aS,aT,aU,aj)local function aV(aR,aS,aT,aU)local aW=1;if aR>aT then aW=-1 end;local aX=aT-aR;local aY=aU-aS;local aZ=1;if aY<0 then aZ=-1;aY=-aY end;local a_=2*aY-aX;local C=aS;for B=aR,aT,aW do self:point(B,C,aj)if a_>0 then C=C+aZ;a_=a_-2*aX end;a_=a_+2*aY end end;local function b0(aR,aS,aT,aU)local aW=1;if aS>aU then aW=-1 end;local aX=aT-aR;local aY=aU-aS;local b1=1;if aX<0 then b1=-1;aX=-aX end;local a_=2*aX-aY;local B=aR;for C=aS,aU,aW do self:point(B,C,aj)if a_>0 then B=B+b1;a_=a_-2*aY end;a_=a_+2*aX end end;if math.abs(aU-aS)<math.abs(aT-aR)then if aR>aT then aV(aT,aU,aR,aS)else aV(aR,aS,aT,aU)end else if aS>aU then b0(aT,aU,aR,aS)else b0(aR,aS,aT,aU)end end end,circle=function(self,b2,b3,b4,aj)local b5=b4*b4;self:point(b2,b3+b4,aj)self:point(b2,b3-b4,aj)self:point(b2+b4,b3,aj)self:point(b2-b4,b3,aj)local B=1;local C=math.floor(math.sqrt(b5-1)+0.5)while B<C do self:point(b2+B,b3+C,aj)self:point(b2+B,b3-C,aj)self:point(b2-B,b3+C,aj)self:point(b2-B,b3-C,aj)self:point(b2+C,b3+B,aj)self:point(b2+C,b3-B,aj)self:point(b2-C,b3+B,aj)self:point(b2-C,b3-B,aj)B=B+1;C=math.floor(math.sqrt(b5-B*B)+0.5)end;if B==C then self:point(b2+B,b3+C,aj)self:point(b2+B,b3-C,aj)self:point(b2-B,b3+C,aj)self:point(b2-B,b3-C,aj)end end}local b6={pressed_keys={},reset=function(self)self.pressed_keys={}end,is_key_pressed=function(self,b7,d)if self.pressed_keys[d]then if b7 then self:remove_key(d)end;return true end;return false end,are_keys_pressed=function(self,b8,...)local keys={...}if not(#keys>0)then return false end;for b9,d in next,keys do if not self:is_key_pressed(false,d)then return false end end;if b8 then self:remove_keys(table.unpack(keys))end;return true end,add_key=function(self,d)self.pressed_keys[d]=true end,remove_key=function(self,d)self.pressed_keys[d]=nil end,remove_keys=function(self,...)local keys={...}for b9,d in next,keys do self:remove_key(d)end end,manage_event=function(self,ba)if ba.name==b.KEY then self:add_key(ba.key)elseif ba.name==b.KEYUP then self:remove_key(ba.key)end end}local bb={}bb={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,bc)rednet.open(bc)self.side=bc end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,bd)if not bd then bd=os.getComputerID()end;bd=tostring(bd)local be=self.root.protocol..self.root.host_prefix..bd;if rednet.lookup(be,bd)then return false,bd end;rednet.host(be,bd)self.servername=be;self.hostname=bd;return true,bd end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast(aE.frame,self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,bd)bd=tostring(bd)local be=self.root.protocol..self.root.host_prefix..bd;local bf=rednet.lookup(be,bd)if not bf then return false,bd end;self.servername=be;self.host_id=bf;return true,bd end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,bg)if not bg then bg=self.root.default_timeout end;local bh={rednet.receive(self.servername,bg)}if bh[1]==self.host_id then local aI=bh[2]if not aI then return false end;if aI==b.DISCONNECTED then return aI end;aE.buffer.background=aI.background;aE.buffer.pixels=aI.pixels;return true end;return false end}}bb.server.root=bb;bb.client.root=bb;local bi={}bi={Clock={new=function(bj)local bk={enabled=true,oneshot=false,clock=os.clock(),interval=bj,callbacks={onClock=function()end}}setmetatable(bk,bi.Clock)return bk end,event=function(self,ba)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,ba)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(B,C,aO,az,aA)local bl={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text_alignment=b.ALIGN_CENTER,text=aO,pos=A.Vector2.new(B,C),colors={foreground=az,background=aA},callbacks={onDraw=function()end}}setmetatable(bl,bi.Label)return bl end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bm=j.split(self.text,"\n")if self.text_alignment==b.ALIGN_LEFT then for d,bn in next,bm do aE:write(self.pos.x,self.pos.y+d-1,bn,self.colors.foreground,self.colors.background)end elseif self.text_alignment==b.ALIGN_CENTER then local bo=0;for d,bn in next,bm do if d==1 then bo=math.floor(#bn/2)aE:write(self.pos.x,self.pos.y,bn,self.colors.foreground,self.colors.background)else aE:write(self.pos.x+bo-math.floor(#bn/2),self.pos.y+d-1,bn,self.colors.foreground,self.colors.background)end end end end},Button={new=function(B,C,ap,aq,aO,az,bp,bq)local br={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,shortcut_once=true,shortcut={},text_alignment=b.ALIGN_CENTER,text=aO,pos=A.Vector2.new(B,C),size=A.Vector2.new(ap,aq),timed={enabled=false,clock=bi.Clock.new(0.5)},colors={foreground=az,active_background=bp,unactive_background=bq},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onTimeout=function()end}}br.timed.clock.binded_button=br;br.timed.clock.oneshot=true;br.timed.clock:stop()e.set_callback(br.timed.clock,b.ONCLOCK,function(self,ba)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,ba)self.binded_button.callbacks.onTimeout(self.binded_button,ba)end)setmetatable(br,bi.Button)return br end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.active then aE:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else aE:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local bm=j.split(self.text,"\n")local bs=math.floor((self.size.y-#bm)/2)+self.pos.y;for aQ=0,#bm-1 do local bn=bm[aQ+1]local bt;if self.text_alignment==b.ALIGN_LEFT then bt=self.pos.x elseif self.text_alignment==b.ALIGN_CENTER then bt=math.floor((self.size.x-#bn)/2)+self.pos.x end;aE:write(bt,bs+aQ,bn,self.colors.foreground)end end,event=function(self,ba)if self.hidden then return false end;if ba.name==b.TOUCH then if am.is_area_pressed(ba.x,ba.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self:press(ba)return true else self.callbacks.onFailedPress(self,ba)end elseif b6:are_keys_pressed(self.shortcut_once,table.unpack(self.shortcut))then self:press(ba)end;if self.timed.enabled then self.timed.clock:event(ba)end end,press=function(self,ba)if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,ba)end else self.active=not self.active;self.callbacks.onPress(self,ba)end end},Progressbar={new=function(B,C,ap,aq,bu,T,U,az,bv,bw)local bx={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(ap,aq),value={max=U,min=T,current=bu,draw_percentage=true},colors={foreground=az,filled_background=bv,unfilled_background=bw},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end}}setmetatable(bx,bi.Progressbar)return bx end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local by=A.map(self.value.current,self.value.min,self.value.max,0,1,true)local bz=math.floor(self.size.x*by)aE:rectangle(self.pos.x,self.pos.y,bz,self.size.y,self.colors.filled_background)aE:rectangle(self.pos.x+bz,self.pos.y,self.size.x-bz,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local bA=string.format("%d%%",by*100)local bB=math.floor((self.size.x-#bA)/2)+self.pos.x;local bs=math.floor((self.size.y-1)/2)+self.pos.y;aE:write(bB,bs,bA,self.colors.foreground)end end,event=function(self,ba)if self.hidden then return false end;if ba.name==b.TOUCH then if am.is_area_pressed(ba.x,ba.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,ba)end end end,set=function(self,n)local bC=A.constrain(n,self.value.min,self.value.max)self.value.current=bC end},Memo={new=function(B,C,ap,aq,az,aA)local bD={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(ap,aq),editable=true,lines={},first_visible_line=1,first_visible_char=1,cursor={visible=false,text=" ",blink=bi.Clock.new(0.5),pos=A.Vector2.new(1,1)},limits=A.Vector2.new(0,0),whitelist={},blacklist={},colors={foreground=az,background=aA,cursor=colors.white,cursor_text=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end,onKey=function()end,onChar=function()end}}bD.cursor.blink.binded_cursor=bD.cursor;e.set_callback(bD.cursor.blink,b.ONCLOCK,function(self,ba)self.binded_cursor.visible=not self.binded_cursor.visible end)setmetatable(bD,bi.Memo)return bD end,draw=function(self)if self.hidden then return end;aE:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)local bE=self.cursor.pos.x-self.first_visible_char;local bF=self.cursor.pos.y-self.first_visible_line;if bE>=self.size.x then self.first_visible_char=self.first_visible_char+bE-self.size.x+1;bE=self.cursor.pos.x-self.first_visible_char-1 elseif bE<1 then self.first_visible_char=self.first_visible_char+bE;bE=0 end;if bF>=self.size.y then self.first_visible_line=self.first_visible_line+bF-self.size.y+1;bF=self.cursor.pos.y-self.first_visible_line-1 elseif bF<1 then self.first_visible_line=self.first_visible_line+bF;bF=0 end;for C=1,self.size.y do local bn=self.lines[C+self.first_visible_line-1]or""local bG=bn:sub(self.first_visible_char,self.first_visible_char+self.size.x-1)aE:write(self.pos.x,self.pos.y+C-1,bG,self.colors.foreground)end;if self.cursor.visible then aE:write(bE+self.pos.x,bF+self.pos.y,self.cursor.text,self.colors.cursor_text,self.colors.cursor)end end,event=function(self,ba)if self.hidden then return false end;if not self.editable then return false end;if ba.name==b.TOUCH then if am.is_area_pressed(ba.x,ba.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then local B=ba.x-self.pos.x;local C=ba.y-self.pos.y;self:set_cursor(B+self.first_visible_char,C+self.first_visible_line)self:focus(true,ba)self.callbacks.onPress(self,ba)return true else self:focus(false,ba)self.callbacks.onFailedPress(self,ba)return false end elseif ba.name==b.DELETED then self:focus(false,ba)return false end;if self.focussed then self.cursor.blink:event(self.cursor.blink,ba)if ba.name==b.PASTE then self:write(ba.paste)elseif ba.name==b.CHAR then if self.callbacks.onChar(self,ba)then return true end;self:write(ba.char)elseif ba.name==b.KEY then if self.callbacks.onKey(self,ba)then return true end;if ba.key==b.KEY_UP then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y-1)elseif ba.key==b.KEY_DOWN then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)elseif ba.key==b.KEY_RIGHT then local bn=self.lines[self.cursor.pos.y]if self.lines[self.cursor.pos.y+1]and self.cursor.pos.x>=#bn+1 then self:set_cursor(1,self.cursor.pos.y+1)else self:set_cursor(self.cursor.pos.x+1,self.cursor.pos.y)end elseif ba.key==b.KEY_LEFT then if self.cursor.pos.x<=1 and self.cursor.pos.y>1 then local bH=self.lines[self.cursor.pos.y-1]self:set_cursor(#bH+1,self.cursor.pos.y-1)else self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif ba.key==b.KEY_BACKSPACE then local bn=self.lines[self.cursor.pos.y]if self.cursor.pos.x<=1 then if self.cursor.pos.y>1 then table.remove(self.lines,self.cursor.pos.y)local bI=#self.lines[self.cursor.pos.y-1]+1;local bJ=self.cursor.pos.y-1;self:set_cursor(bI,bJ)self:write(bn)self:set_cursor(bI,bJ)end else self.lines[self.cursor.pos.y]=bn:sub(1,self.cursor.pos.x-2)..bn:sub(self.cursor.pos.x)self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif ba.key==b.KEY_DELETE then local bn=self.lines[self.cursor.pos.y]local bK=bn:sub(self.cursor.pos.x)if#bK>0 then self.lines[self.cursor.pos.y]=bn:sub(1,self.cursor.pos.x-1)..bn:sub(self.cursor.pos.x+1)else local bL=self.lines[self.cursor.pos.y+1]if bL then local bI=self.cursor.pos.x;local bJ=self.cursor.pos.y;table.remove(self.lines,self.cursor.pos.y+1)self:write(bL)self:set_cursor(bI,bJ)end end elseif ba.key==b.KEY_ENTER then self:write("\n")elseif ba.key==b.KEY_TAB then self:write("  ")end elseif ba.name==b.MOUSESCROLL then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+ba.direction)end;return true end end,focus=function(self,bM,ba)if bM then self.focussed=true;self.callbacks.onFocus(self,ba)else self.focussed=false;self.cursor.visible=false;self.callbacks.onFocus(self,ba)end end,set_cursor=function(self,bI,bJ,bN)if not self.lines[1]then self.lines[1]=""end;if self.limits.y>0 then bJ=A.constrain(bJ,1,self.limits.y)end;if bN then for C=#self.lines+1,bJ do if not self.lines[C]then self.lines[C]=""end end else bJ=A.constrain(bJ,1,#self.lines)end;bI=A.constrain(bI,1,#self.lines[bJ]+1)self.cursor.pos=A.Vector2.new(bI,bJ)end,write=function(self,...)local aO=j.join({...},"")local bm=j.split(aO,"\n")self:set_cursor(self.cursor.pos.x,self.cursor.pos.y,true)if#self.whitelist>0 then local bO="[^"..j.escape_magic_characters(j.join(self.whitelist,"")).."]"for d,bn in next,bm do bm[d]=bn:gsub(bO,"")end elseif#self.blacklist>0 then local bO="["..j.escape_magic_characters(j.join(self.blacklist,"")).."]"for d,bn in next,bm do bm[d]=bn:gsub(bO,"")end end;if self.limits.y>0 then for C=1,#self.lines+#bm-1-self.limits.y do table.remove(bm)end;if#bm==0 then return end end;if#bm>1 then for bP,bn in next,bm do if bP==1 then local bQ=self.lines[self.cursor.pos.y]local bR=bQ:sub(1,self.cursor.pos.x-1)local bK=bQ:sub(self.cursor.pos.x)local bS=bm[#bm]if self.limits.x>0 then bn=bn:sub(1,self.limits.x-#bR)bS=bS:sub(1,self.limits.x-#bK)end;self.lines[self.cursor.pos.y]=bR..bn;self:set_cursor(1,self.cursor.pos.y+1,true)table.insert(self.lines,self.cursor.pos.y,bS..bK)self:set_cursor(#bS+1,self.cursor.pos.y)elseif bP==#bm then break else if self.limits.x>0 then bn=bn:sub(1,self.limits.x)end;table.insert(self.lines,self.cursor.pos.y,bn)self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)end end else local bQ=self.lines[self.cursor.pos.y]local bR=bQ:sub(1,self.cursor.pos.x-1)local bK=bQ:sub(self.cursor.pos.x)if self.limits.x>0 then bm[1]=bm[1]:sub(1,self.limits.x-(#bR+#bK))end;self.lines[self.cursor.pos.y]=bR..bm[1]..bK;self:set_cursor(self.cursor.pos.x+#bm[1],self.cursor.pos.y)end end,print=function(self,...)local aO=j.join({...},"\n").."\n"self:write(aO)end,clear=function(self)self.lines={""}self:set_cursor(1,1)end},Window={new=function(B,C,ap,aq,aA,bT)local bU={draw_priority=b.HIGH_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(ap,aq),drag_options={enabled=true,from=A.Vector2.new(1,1)},shadow={enabled=bT,offset=A.Vector2.new(1,1)},elements={},colors={background=aA,shadow=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end}}setmetatable(bU,bi.Window)return bU end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.shadow.enabled then aE:rectangle(self.pos.x+self.shadow.offset.x,self.pos.y+self.shadow.offset.y,self.size.x,self.size.y,self.colors.shadow)end;aE:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)self:draw_elements()end,event=function(self,ba)if self.hidden then return false end;local bV=self:event_elements(ba)if not bV then if ba.name==b.TOUCH then if am.is_area_pressed(ba.x,ba.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.drag_options.from=A.Vector2.new(ba.x,ba.y)self.focussed=true;self.callbacks.onPress(self,ba)self.callbacks.onFocus(self,ba)return true else self.focussed=false;self.callbacks.onFailedPress(self,ba)self.callbacks.onFocus(self,ba)end elseif ba.name==b.MOUSEDRAG and self.focussed then self:drag(ba.x,ba.y)return true elseif ba.name==b.DELETED then self.focussed=false;self.callbacks.onFocus(self,ba)end else self.focussed=false;self.callbacks.onFocus(self,ba)end;return bV end,drag=function(self,B,C)if self.drag_options.enabled then local bW=A.Vector2.new(B-self.drag_options.from.x,C-self.drag_options.from.y)self.pos=self.pos+bW;for d,bX in next,self.elements do if bX.pos then bX.pos=bX.pos+bW end end;self.drag_options.from=A.Vector2.new(B,C)end end,set_elements=function(self,bY,bZ)self.elements={}for d,bX in next,bY do if bZ then bX.pos=self.pos+bX.pos-A.Vector2.ONE end;table.insert(self.elements,bX)end end,draw_elements=function(self)for d=#self.elements,1,-1 do local bX=self.elements[d]if bX.draw then bX:draw()end end end,event_elements=function(self,ba)local bV=false;for d,bX in next,self.elements do if bX.event then local b_=bX:event(ba)bV=bV or b_;if b_ then ba={name=b.DELETED}end end end;return bV end}}bi.Clock.__index=bi.Clock;bi.Label.__index=bi.Label;bi.Button.__index=bi.Button;bi.Progressbar.__index=bi.Progressbar;bi.Memo.__index=bi.Memo;bi.Window.__index=bi.Window;local c0={}c0={new=function(c1,c2)local c3={options={enabled=false,FPS_target=c1,EPS_target=c2},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=bi.Clock.new(1/c1),stats_clock=bi.Clock.new(1),FPS_label=bi.Label.new(1,1,"1 FPS",colors.white),EPS_label=bi.Label.new(1,2,"1 EPS",colors.white)}},stats={pos=A.Vector2.new(1,1),elements=nil,enabled=true,enable=function(self,c4)self.enabled=c4;self.elements.stats_clock.enabled=c4;self.elements.FPS_label.hidden=not c4;self.elements.EPS_label.hidden=not c4 end,update_pos=function(self)self.elements.FPS_label.pos=self.pos;self.elements.EPS_label.pos=self.pos+A.Vector2.DOWN end,FPS=0,EPS=0},callbacks={onStart=function()end,onStop=function()end,onDraw=function()end,onClock=function()end,onEvent=function()end}}c3.elements.loop.stats_clock.stats=c3.stats;c3.stats.elements=c3.elements.loop;e.set_callback(c3.elements.loop.stats_clock,b.ONCLOCK,function(self,ba)self.stats:update_pos()self.stats.elements.FPS_label.text=tostring(self.stats.FPS).." FPS"self.stats.elements.EPS_label.text=tostring(self.stats.EPS).." EPS"self.stats.FPS=0;self.stats.EPS=0 end)c3.stats:enable(false)setmetatable(c3,c0)return c3 end,set_monitors=function(self,av)self.monitors=au.get_monitors(av)end,set_elements=function(self,bY)self.elements.high_priority={}self.elements.low_priority={}for d,n in next,bY do if n.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,n)else table.insert(self.elements.low_priority,n)end end end,draw_elements=function(self)local function c5(k)for d=#k,1,-1 do local bX=k[d]if bX.draw then bX:draw()end end end;self.callbacks.onDraw(self)local c6=aE.screens;aE.screens=self.monitors;c5(self.elements.low_priority)c5(self.elements.high_priority)for d,bX in next,self.elements.loop do if bX.draw then bX:draw()end end;aE:draw()aE.screens=c6;if self.stats.enabled then self.stats.FPS=self.stats.FPS+1 end end,event_elements=function(self,ba)local function ar(k)for d,bX in next,k do if bX.event then if bX:event(ba)then ba={name=b.DELETED}end end end end;if self.callbacks.onEvent(self,ba)then ba={name=b.DELETED}end;if ba.name==b.TOUCH then local c7=false;for c8,ay in next,self.monitors do if ba.from==c8 then c7=true;break end end;if not c7 then ba={name=b.DELETED}end end;ar(self.elements.loop)local c9={}for d,bX in next,self.elements.high_priority do if bX.event then local ca=bX:event(ba)if ca then ba={name=b.DELETED}if self.elements.high_priority~=bX then table.insert(c9,{element=bX,key=d})end end end end;if#c9>0 then for d,n in next,c9 do table.insert(self.elements.high_priority,1,n.element)table.remove(self.elements.high_priority,n.key+#c9)end end;ar(self.elements.low_priority)if self.stats.enabled then self.stats.EPS=self.stats.EPS+1 end end,start=function(self)self.enabled=true;b6:reset()e.set_callback(self.elements.loop.clock,b.ONCLOCK,function(cb,ba)self.callbacks.onClock(self,ba)self:draw_elements()cb.interval=1/self.options.FPS_target end)self.stats:update_pos()self.callbacks.onStart(self)while self.enabled do local cc=os.startTimer(1/self.options.EPS_target)local cd={os.pullEvent()}local ba=am.format_event_table(cd)b6:manage_event(ba)self:event_elements(ba)os.cancelTimer(cc)end;b6:reset()self.callbacks.onStop(self)end,stop=function(self)self.enabled=false end}c0.__index=c0;local ce={...}if ce[1]=="help"then local bm={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil},{text=" - create <PATH> (creates a new YAGUI project)",foreground=colors.green,background=nil}}for d,bn in next,bm do au.better_print(term,bn.foreground,bn.background,bn.text)end elseif ce[1]=="info"then au.better_print(term,colors.red,nil,"Library Version: ",a.ver)au.better_print(term,colors.yellow,nil,"Library Author: ",a.author)au.better_print(term,colors.green,nil,"Library Website: ",a.website)au.better_print(term,colors.blue,nil,"Library Documentation: ",a.documentation)elseif ce[1]=="ver"then au.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif ce[1]=="copyright"then local cf={colors.red,colors.yellow,colors.green}local cg=j.split(a.copyright,"\n\n")for d,ch in next,cg do au.better_print(term,cf[d],nil,ch)if d<#cg then read("")end end elseif ce[1]=="setup"then if shell then local ci="YAGUI_PATH"local x="/"..shell.getRunningProgram()as.set(ci,x)au.better_print(term,colors.green,nil,"Lib path was set to \"",as.get(ci),"\".")else au.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE!")end elseif ce[1]=="create"then if ce[2]then local x=shell.resolve(ce[2])local at=fs.getName(x):lower()if j.get_extension(x)~="lua"then x=x..".lua"end;if fs.exists(x)then au.better_print(term,colors.red,nil,"PATH: \"/",x,"\" already exists, please use another path or delete it.")else local cj=fs.open(x,"w")cj.write("\n-- AUTO-GENERATED with \"YAGUI create\"\nlocal YAGUI_PATH = settings.get(\"YAGUI_PATH\")\nif not (type(YAGUI_PATH) == \"string\") then printError(\"YAGUI is not installed, please install it by opening it with argument \\\"setup\\\".\"); return; end\nif not fs.exists(YAGUI_PATH) then printError(\"Couldn't find YAGUI in path: \\\"\"..YAGUI_PATH..\"\\\", Please reinstall it by opening it with argument \\\"setup\\\".\"); return; end\nlocal YAGUI = dofile(YAGUI_PATH)\n-- End of AUTO-GENERATED code\n\n")cj.close()au.better_print(term,colors.green,nil,"New project was created at \"/",x,"\".")end else au.better_print(term,colors.red,nil,"You must specify a path to create a new project.")end elseif ce[1]then au.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",ce[1],"\"")au.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local ck={info=a,generic_utils=e,string_utils=j,math_utils=A,table_utils=Z,color_utils=ai,event_utils=am,setting_utils=as,monitor_utils=au,screen_buffer=aE,input=b6,WSS=bb,wireless_screen_share=bb,gui_elements=bi,Loop=c0}for d,n in next,b do ck[d]=n end;return ck