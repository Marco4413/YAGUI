--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.11",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI/",documentation="https://yagui.readthedocs.io/en/latest/",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",MOUSEDRAG="mouse_drag",MOUSESCROLL="mouse_scroll",CHAR="char",KEY="key",KEYUP="key_up",PASTE="paste",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONSTART=1,ONSTOP=2,ONDRAW=3,ONPRESS=4,ONFAILEDPRESS=5,ONTIMEOUT=6,ONCLOCK=7,ONEVENT=8,ONFOCUS=9,ONKEY=10,ONCHAR=11,MOUSE_LEFT=1,MOUSE_RIGHT=2,MOUSE_MIDDLE=3,SCROLL_UP=-1,SCROLL_DOWN=1,COMPUTER="computer",TURTLE="turtle",POCKET="pocket",ALIGN_LEFT=1,ALIGN_CENTER=2}for c,d in pairs(keys)do if type(d)=="number"then b["KEY_"..c:upper()]=d end end;local e={set_callback=function(f,g,h)if g==b.ONSTART then f.callbacks.onStart=h elseif g==b.ONSTOP then f.callbacks.onStop=h elseif g==b.ONDRAW then f.callbacks.onDraw=h elseif g==b.ONPRESS then f.callbacks.onPress=h elseif g==b.ONFAILEDPRESS then f.callbacks.onFailedPress=h elseif g==b.ONTIMEOUT then f.callbacks.onTimeout=h elseif g==b.ONCLOCK then f.callbacks.onClock=h elseif g==b.ONEVENT then f.callbacks.onEvent=h elseif g==b.ONFOCUS then f.callbacks.onFocus=h elseif g==b.ONKEY then f.callbacks.onKey=h elseif g==b.ONCHAR then f.callbacks.onChar=h end end,get_computer_type=function()local i=b.COMPUTER;if turtle then i=b.TURTLE elseif pocket then i=b.POCKET end;return i,term.isColor()end}local j={}j={magic_characters={"(",")",".","%","+","-","*","?","[","]","^","$"},join=function(k,l)if not l then l=""end;local m=""for d=1,#k do local n=k[d]m=m..tostring(n)if d<#k then m=m..l end end;return m end,split=function(m,l)local k={}while true do local o=m:find(l)if o then table.insert(k,m:sub(1,o-1))m=m:sub(o+1)else table.insert(k,m)break end end;return k end,compare_versions=function(p,q)local r=j.split(p,".")local s=j.split(q,".")local t=#r;local u=#s;for v=1,math.min(t,u)do if tonumber(r[v])>tonumber(s[v])then return 1 elseif tonumber(r[v])<tonumber(s[v])then return-1 end end;if t>u then return 1 elseif t<u then return-1 end;return 0 end,escape_magic_characters=function(m)for d,w in pairs(j.magic_characters)do m=m:gsub("[%"..w.."]",'%%%'..w)end;return m end,get_extension=function(x)local y,z=x:gsub(".*%.","")if z>0 then return y end;return""end}local A={}A={Vector2={new=function(B,C)local D={x=B or 0,y=C or 0}setmetatable(D,A.Vector2)return D end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y end,cross=function(self,E)return self.x*E.y-self.y*E.x end,rotate=function(self,F)local G=math.cos(F)local H=math.sin(F)return A.Vector2.new(G*self.x-H*self.y,H*self.x+G*self.y)end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y)else return string.format("(%f; %f)",self.x,self.y)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector2.new(self.x+E.x,self.y+E.y)end,__sub=function(self,E)return A.Vector2.new(self.x-E.x,self.y-E.y)end,__mul=function(self,J)if type(self)=="number"then return A.Vector2.new(J.x*self,J.y*self)else return A.Vector2.new(self.x*J,self.y*J)end end,__div=function(self,J)return A.Vector2.new(self.x/J,self.y/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},Vector3={new=function(B,C,K)local L={x=B or 0,y=C or 0,z=K or 0}setmetatable(L,A.Vector3)return L end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)+math.pow(self.z,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y+self.z*E.z end,cross=function(self,E)return A.Vector3.new(self.y*E.z-self.z*E.y,self.z*E.x-self.x*E.z,self.x*E.y-self.y*E.x)end,rotate=function(self,M,F)local G=math.cos(F)return G*self+math.sin(F)*M:cross(self)+(1-G)*M:dot(self)*M end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y,self.z)else return string.format("(%f; %f; %f)",self.x,self.y,self.z)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector3.new(self.x+E.x,self.y+E.y,self.z+E.z)end,__sub=function(self,E)return A.Vector3.new(self.x-E.x,self.y-E.y,self.z-E.z)end,__mul=function(self,J)if type(self)=="number"then return A.Vector3.new(J.x*self,J.y*self,J.z*self)else return A.Vector3.new(self.x*J,self.y*J,self.z*J)end end,__div=function(self,J)return A.Vector3.new(self.x/J,self.y/J,self.z/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},map=function(n,N,O,P,Q,R)local S=(n-N)/(O-N)*(Q-P)+P;if R then return A.constrain(S,P,Q)end;return S end,constrain=function(n,T,U)return math.min(U,math.max(T,n))end}A.Vector2.__index=A.Vector2;A.Vector3.__index=A.Vector3;A.Vector2.ONE=A.Vector2.new(1,1)A.Vector2.UP=A.Vector2.new(0,-1)A.Vector2.DOWN=A.Vector2.new(0,1)A.Vector2.LEFT=A.Vector2.new(-1,0)A.Vector2.RIGHT=A.Vector2.new(1,0)A.Vector2.ZERO=A.Vector2.new(0,0)A.Vector3.ONE=A.Vector3.new(1,1,1)A.Vector3.UP=A.Vector3.new(0,1,0)A.Vector3.DOWN=A.Vector3.new(0,-1,0)A.Vector3.LEFT=A.Vector3.new(-1,0,0)A.Vector3.RIGHT=A.Vector3.new(1,0,0)A.Vector3.FORWARD=A.Vector3.new(0,0,1)A.Vector3.BACK=A.Vector3.new(0,0,-1)A.Vector3.ZERO=A.Vector3.new(0,0,0)local V={has_value=function(k,n)for W,X in pairs(k)do if X==n then return true,W end end;return false,nil end,has_key=function(k,d)if k[d]~=nil then return true,k[d]end;return false,nil end}local Y={}Y={colors={[1]="0",[2]="1",[4]="2",[8]="3",[16]="4",[32]="5",[64]="6",[128]="7",[256]="8",[512]="9",[1024]="a",[2048]="b",[4096]="c",[8192]="d",[16384]="e",[32768]="f"},color_to_paint=function(Z)return Y.colors[Z]end,paint_to_color=function(_)local a0,Z=V.has_value(Y.colors,_)if a0 then return Z end end}local a1={is_area_pressed=function(a2,a3,B,C,a4,a5)if a2>=B and a2<B+a4 then if a3>=C and a3<C+a5 then return true end end;return false end,format_event_table=function(a6)local g={}g.name=a6[1]if g.name=="mouse_click"then g.name=b.TOUCH;g.from="terminal"g.button=a6[2]g.x=a6[3]g.y=a6[4]return g elseif g.name=="monitor_touch"then g.name=b.TOUCH;g.from=a6[2]g.button=1;g.x=a6[3]g.y=a6[4]return g elseif g.name=="mouse_drag"then g.name=b.MOUSEDRAG;g.button=a6[2]g.x=a6[3]g.y=a6[4]return g elseif g.name=="mouse_up"then g.name=b.MOUSEUP;g.button=a6[2]g.x=a6[3]g.y=a6[4]return g elseif g.name=="mouse_scroll"then g.name=b.MOUSESCROLL;g.direction=a6[2]g.x=a6[3]g.y=a6[4]return g elseif g.name=="char"then g.name=b.CHAR;g.char=a6[2]return g elseif g.name=="key"then g.name=b.KEY;g.key=a6[2]return g elseif g.name=="key_up"then g.name=b.KEYUP;g.key=a6[2]return g elseif g.name=="paste"then g.name=b.PASTE;g.paste=a6[2]return g end;table.remove(a6,1)g.parameters=a6;return g end}local a7={_path="/.settings",set=function(self,a8,n)settings.set(a8,n)settings.save(self._path)end,unset=function(self,a8)settings.unset(a8)settings.save(self._path)end,get=function(a8)return settings.get(a8)end}local a9={get_monitors=function(aa)local ab={}for d,ac in pairs(aa)do if ac=="terminal"then ab[ac]=term else if peripheral.getType(ac)=="monitor"then ab[ac]=peripheral.wrap(ac)end end end;return ab end,better_print=function(ad,ae,af,...)local ag=j.join({...},"")local ah=ad.getTextColor()local ai=ad.getBackgroundColor()if ae then ad.setTextColor(ae)end;if af then ad.setBackgroundColor(af)end;print(ag)ad.setTextColor(ah)ad.setBackgroundColor(ai)end,better_clear=function(ad)ad.clear()ad.setCursorPos(1,1)end}local aj={frame={pixels={},background=nil},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,B,C)B=tostring(B)C=tostring(C)if self.pixels[B]then if self.pixels[B][C]then return true end end;return false end,get_pixel=function(self,B,C)B=tostring(B)C=tostring(C)if self:is_pixel_custom(B,C)then return self.pixels[B][C]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,B,C,char,ae,af)B=tostring(B)C=tostring(C)local ak=self:get_pixel(B,C)if char and#char==1 then ak.char=char end;ak.foreground=ae or ak.background;ak.background=af or ak.background;if not self.pixels[B]then self.pixels[B]={}end;self.pixels[B][C]=ak end,clear=function(self)self.pixels={}end},set_screens=function(self,al)self.screens=a9.get_monitors(al)end,set_monitors=function(self,aa)self:set_screens(aa)end,clear=function(self)self.buffer:clear()end,draw=function(self)local am=self.screens;local an=self.buffer;for ao,ap in pairs(am)do local aq,ar=ap.getCursorPos()local a4,a5=ap.getSize()for C=1,a5 do local as={text="",background="",foreground=""}for B=1,a4 do local ak=an:get_pixel(B,C)as.text=as.text..ak.char;as.background=as.background..Y.colors[ak.background]as.foreground=as.foreground..Y.colors[ak.foreground]end;ap.setCursorPos(1,C)ap.blit(as.text,as.foreground,as.background)end;ap.setCursorPos(aq,ar)end;self.frame.pixels=self.buffer.pixels;self.frame.background=self.buffer.background;if self.clear_after_draw then self:clear()end end,point=function(self,B,C,Z)self.buffer:set_pixel(B,C," ",Z,Z)end,write=function(self,B,C,at,ae,af)for au=0,#at-1 do char=at:sub(au+1,au+1)self.buffer:set_pixel(B+au,C,char,ae,af)end end,rectangle=function(self,B,C,a4,a5,Z)for au=0,a4-1 do for av=0,a5-1 do self:point(B+au,C+av,Z)end end end,line=function(self,aw,ax,ay,az,Z)local function aA(aw,ax,ay,az)local aB=1;if aw>ay then aB=-1 end;local aC=ay-aw;local aD=az-ax;local aE=1;if aD<0 then aE=-1;aD=-aD end;local aF=2*aD-aC;local C=ax;for B=aw,ay,aB do self:point(B,C,Z)if aF>0 then C=C+aE;aF=aF-2*aC end;aF=aF+2*aD end end;local function aG(aw,ax,ay,az)local aB=1;if ax>az then aB=-1 end;local aC=ay-aw;local aD=az-ax;local aH=1;if aC<0 then aH=-1;aC=-aC end;local aF=2*aC-aD;local B=aw;for C=ax,az,aB do self:point(B,C,Z)if aF>0 then B=B+aH;aF=aF-2*aD end;aF=aF+2*aC end end;if math.abs(az-ax)<math.abs(ay-aw)then if aw>ay then aA(ay,az,aw,ax)else aA(aw,ax,ay,az)end else if ax>az then aG(ay,az,aw,ax)else aG(aw,ax,ay,az)end end end,circle=function(self,aI,aJ,aK,Z)local aL=aK*aK;self:point(aI,aJ+aK,Z)self:point(aI,aJ-aK,Z)self:point(aI+aK,aJ,Z)self:point(aI-aK,aJ,Z)local B=1;local C=math.floor(math.sqrt(aL-1)+0.5)while B<C do self:point(aI+B,aJ+C,Z)self:point(aI+B,aJ-C,Z)self:point(aI-B,aJ+C,Z)self:point(aI-B,aJ-C,Z)self:point(aI+C,aJ+B,Z)self:point(aI+C,aJ-B,Z)self:point(aI-C,aJ+B,Z)self:point(aI-C,aJ-B,Z)B=B+1;C=math.floor(math.sqrt(aL-B*B)+0.5)end;if B==C then self:point(aI+B,aJ+C,Z)self:point(aI+B,aJ-C,Z)self:point(aI-B,aJ+C,Z)self:point(aI-B,aJ-C,Z)end end}local aM={pressed_keys={},reset=function(self)self.pressed_keys={}end,is_key_pressed=function(self,aN,d)if self.pressed_keys[d]then if aN then self:remove_key(d)end;return true end;return false end,are_keys_pressed=function(self,aO,...)local keys={...}if not(#keys>0)then return false end;for aP,d in pairs(keys)do if not self:is_key_pressed(false,d)then return false end end;if aO then self:remove_keys(table.unpack(keys))end;return true end,add_key=function(self,d)self.pressed_keys[d]=true end,remove_key=function(self,d)self.pressed_keys[d]=nil end,remove_keys=function(self,...)local keys={...}for aP,d in pairs(keys)do self:remove_key(d)end end,manage_event=function(self,aQ)if aQ.name==b.KEY then self:add_key(aQ.key)elseif aQ.name==b.KEYUP then self:remove_key(aQ.key)end end}local aR={}aR={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,aS)rednet.open(aS)self.side=aS end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,aT)if not aT then aT=os.getComputerID()end;aT=tostring(aT)local aU=self.root.protocol..self.root.host_prefix..aT;if rednet.lookup(aU,aT)then return false,aT end;rednet.host(aU,aT)self.servername=aU;self.hostname=aT;return true,aT end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast(aj.frame,self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,aT)aT=tostring(aT)local aU=self.root.protocol..self.root.host_prefix..aT;local aV=rednet.lookup(aU,aT)if not aV then return false,aT end;self.servername=aU;self.host_id=aV;return true,aT end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,aW)if not aW then aW=self.root.default_timeout end;local aX={rednet.receive(self.servername,aW)}if aX[1]==self.host_id then local an=aX[2]if not an then return false end;if an==b.DISCONNECTED then return an end;aj.buffer.background=an.background;aj.buffer.pixels=an.pixels;return true end;return false end}}aR.server.root=aR;aR.client.root=aR;local aY={}aY={Clock={new=function(aZ)local a_={enabled=true,oneshot=false,clock=os.clock(),interval=aZ,callbacks={onClock=function()end}}setmetatable(a_,aY.Clock)return a_ end,event=function(self,aQ)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,aQ)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(B,C,at,ae,af)local b0={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text_alignment=b.ALIGN_CENTER,text=at,pos=A.Vector2.new(B,C),colors={foreground=ae,background=af},callbacks={onDraw=function()end}}setmetatable(b0,aY.Label)return b0 end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local b1=j.split(self.text,"\n")if self.text_alignment==b.ALIGN_LEFT then for d,b2 in pairs(b1)do aj:write(self.pos.x,self.pos.y+d-1,b2,self.colors.foreground,self.colors.background)end elseif self.text_alignment==b.ALIGN_CENTER then local b3=0;for d,b2 in pairs(b1)do if d==1 then b3=math.floor(#b2/2)aj:write(self.pos.x,self.pos.y,b2,self.colors.foreground,self.colors.background)else aj:write(self.pos.x+b3-math.floor(#b2/2),self.pos.y+d-1,b2,self.colors.foreground,self.colors.background)end end end end},Button={new=function(B,C,a4,a5,at,ae,b4,b5)local b6={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,shortcut_once=true,shortcut={},text_alignment=b.ALIGN_CENTER,text=at,pos=A.Vector2.new(B,C),size=A.Vector2.new(a4,a5),timed={enabled=false,clock=aY.Clock.new(0.5)},colors={foreground=ae,active_background=b4,unactive_background=b5},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onTimeout=function()end}}b6.timed.clock.binded_button=b6;b6.timed.clock.oneshot=true;b6.timed.clock:stop()e.set_callback(b6.timed.clock,b.ONCLOCK,function(self,aQ)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,aQ)self.binded_button.callbacks.onTimeout(self.binded_button,aQ)end)setmetatable(b6,aY.Button)return b6 end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.active then aj:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else aj:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local b1=j.split(self.text,"\n")local b7=math.floor((self.size.y-#b1)/2)+self.pos.y;for av=0,#b1-1 do local b2=b1[av+1]local b8;if self.text_alignment==b.ALIGN_LEFT then b8=self.pos.x elseif self.text_alignment==b.ALIGN_CENTER then b8=math.floor((self.size.x-#b2)/2)+self.pos.x end;aj:write(b8,b7+av,b2,self.colors.foreground)end end,event=function(self,aQ)if self.hidden then return false end;if aQ.name==b.TOUCH then if a1.is_area_pressed(aQ.x,aQ.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self:press(aQ)return true else self.callbacks.onFailedPress(self,aQ)end elseif aM:are_keys_pressed(self.shortcut_once,table.unpack(self.shortcut))then self:press(aQ)end;if self.timed.enabled then self.timed.clock:event(aQ)end end,press=function(self,aQ)if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,aQ)end else self.active=not self.active;self.callbacks.onPress(self,aQ)end end},Progressbar={new=function(B,C,a4,a5,b9,T,U,ae,ba,bb)local bc={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a4,a5),value={max=U,min=T,current=b9,draw_percentage=true},colors={foreground=ae,filled_background=ba,unfilled_background=bb},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end}}setmetatable(bc,aY.Progressbar)return bc end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bd=A.map(self.value.current,self.value.min,self.value.max,0,1,true)local be=math.floor(self.size.x*bd)aj:rectangle(self.pos.x,self.pos.y,be,self.size.y,self.colors.filled_background)aj:rectangle(self.pos.x+be,self.pos.y,self.size.x-be,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local bf=tostring(bd*100).."%"local bg=math.floor((self.size.x-#bf)/2)+self.pos.x;local b7=math.floor((self.size.y-1)/2)+self.pos.y;aj:write(bg,b7,bf,self.colors.foreground)end end,event=function(self,aQ)if self.hidden then return false end;if aQ.name==b.TOUCH then if a1.is_area_pressed(aQ.x,aQ.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,aQ)end end end,set=function(self,n)local bh=A.constrain(n,self.value.min,self.value.max)self.value.current=bh end},Memo={new=function(B,C,a4,a5,ae,af)local bi={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a4,a5),editable=true,lines={},first_visible_line=1,first_visible_char=1,cursor={visible=false,text=" ",blink=aY.Clock.new(0.5),pos=A.Vector2.new(1,1)},limits=A.Vector2.new(0,0),whitelist={},blacklist={},colors={foreground=ae,background=af,cursor=colors.white,cursor_text=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end,onKey=function()end,onChar=function()end}}bi.cursor.blink.binded_cursor=bi.cursor;e.set_callback(bi.cursor.blink,b.ONCLOCK,function(self,aQ)self.binded_cursor.visible=not self.binded_cursor.visible end)setmetatable(bi,aY.Memo)return bi end,draw=function(self)if self.hidden then return end;aj:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)local bj=self.cursor.pos.x-self.first_visible_char;local bk=self.cursor.pos.y-self.first_visible_line;if bj>=self.size.x then self.first_visible_char=self.first_visible_char+bj-self.size.x+1;bj=self.cursor.pos.x-self.first_visible_char-1 elseif bj<1 then self.first_visible_char=self.first_visible_char+bj;bj=0 end;if bk>=self.size.y then self.first_visible_line=self.first_visible_line+bk-self.size.y+1;bk=self.cursor.pos.y-self.first_visible_line-1 elseif bk<1 then self.first_visible_line=self.first_visible_line+bk;bk=0 end;for C=1,self.size.y do local b2=self.lines[C+self.first_visible_line-1]or""local bl=b2:sub(self.first_visible_char,self.first_visible_char+self.size.x-1)aj:write(self.pos.x,self.pos.y+C-1,bl,self.colors.foreground)end;if self.cursor.visible then aj:write(bj+self.pos.x,bk+self.pos.y,self.cursor.text,self.colors.cursor_text,self.colors.cursor)end end,event=function(self,aQ)if self.hidden then return false end;if not self.editable then return false end;if aQ.name==b.TOUCH then if a1.is_area_pressed(aQ.x,aQ.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then local B=aQ.x-self.pos.x;local C=aQ.y-self.pos.y;self:set_cursor(B+self.first_visible_char,C+self.first_visible_line)self:focus(true,aQ)self.callbacks.onPress(self,aQ)return true else self:focus(false,aQ)self.callbacks.onFailedPress(self,aQ)return false end elseif aQ.name==b.DELETED then self:focus(false,aQ)return false end;if self.focussed then self.cursor.blink:event(self.cursor.blink,aQ)if aQ.name==b.PASTE then self:write(aQ.paste)elseif aQ.name==b.CHAR then if self.callbacks.onChar(self,aQ)then return true end;self:write(aQ.char)elseif aQ.name==b.KEY then if self.callbacks.onKey(self,aQ)then return true end;if aQ.key==b.KEY_UP then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y-1)elseif aQ.key==b.KEY_DOWN then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)elseif aQ.key==b.KEY_RIGHT then local b2=self.lines[self.cursor.pos.y]if self.lines[self.cursor.pos.y+1]and self.cursor.pos.x>=#b2+1 then self:set_cursor(1,self.cursor.pos.y+1)else self:set_cursor(self.cursor.pos.x+1,self.cursor.pos.y)end elseif aQ.key==b.KEY_LEFT then if self.cursor.pos.x<=1 and self.cursor.pos.y>1 then local bm=self.lines[self.cursor.pos.y-1]self:set_cursor(#bm+1,self.cursor.pos.y-1)else self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aQ.key==b.KEY_BACKSPACE then local b2=self.lines[self.cursor.pos.y]if self.cursor.pos.x<=1 then if self.cursor.pos.y>1 then table.remove(self.lines,self.cursor.pos.y)local bn=#self.lines[self.cursor.pos.y-1]+1;local bo=self.cursor.pos.y-1;self:set_cursor(bn,bo)self:write(b2)self:set_cursor(bn,bo)end else self.lines[self.cursor.pos.y]=b2:sub(1,self.cursor.pos.x-2)..b2:sub(self.cursor.pos.x)self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aQ.key==b.KEY_DELETE then local b2=self.lines[self.cursor.pos.y]local bp=b2:sub(self.cursor.pos.x)if#bp>0 then self.lines[self.cursor.pos.y]=b2:sub(1,self.cursor.pos.x-1)..b2:sub(self.cursor.pos.x+1)else local bq=self.lines[self.cursor.pos.y+1]if bq then local bn=self.cursor.pos.x;local bo=self.cursor.pos.y;table.remove(self.lines,self.cursor.pos.y+1)self:write(bq)self:set_cursor(bn,bo)end end elseif aQ.key==b.KEY_ENTER then self:write("\n")elseif aQ.key==b.KEY_TAB then self:write("  ")end elseif aQ.name==b.MOUSESCROLL then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+aQ.direction)end;return true end end,focus=function(self,br,aQ)if br then self.focussed=true;self.callbacks.onFocus(self,aQ)else self.focussed=false;self.cursor.visible=false;self.callbacks.onFocus(self,aQ)end end,set_cursor=function(self,bn,bo,bs)if not self.lines[1]then self.lines[1]=""end;if self.limits.y>0 then bo=A.constrain(bo,1,self.limits.y)end;if bs then for C=#self.lines+1,bo do if not self.lines[C]then self.lines[C]=""end end else bo=A.constrain(bo,1,#self.lines)end;bn=A.constrain(bn,1,#self.lines[bo]+1)self.cursor.pos=A.Vector2.new(bn,bo)end,write=function(self,...)local at=j.join({...},"")local b1=j.split(at,"\n")self:set_cursor(self.cursor.pos.x,self.cursor.pos.y,true)if#self.whitelist>0 then local bt="[^"..j.escape_magic_characters(j.join(self.whitelist,"")).."]"for d,b2 in pairs(b1)do b1[d]=b2:gsub(bt,"")end elseif#self.blacklist>0 then local bt="["..j.escape_magic_characters(j.join(self.blacklist,"")).."]"for d,b2 in pairs(b1)do b1[d]=b2:gsub(bt,"")end end;if self.limits.y>0 then for C=1,#self.lines+#b1-1-self.limits.y do table.remove(b1)end;if#b1==0 then return end end;if#b1>1 then for bu,b2 in pairs(b1)do if bu==1 then local bv=self.lines[self.cursor.pos.y]local bw=bv:sub(1,self.cursor.pos.x-1)local bp=bv:sub(self.cursor.pos.x)local bx=b1[#b1]if self.limits.x>0 then b2=b2:sub(1,self.limits.x-#bw)bx=bx:sub(1,self.limits.x-#bp)end;self.lines[self.cursor.pos.y]=bw..b2;self:set_cursor(1,self.cursor.pos.y+1,true)table.insert(self.lines,self.cursor.pos.y,bx..bp)self:set_cursor(#bx+1,self.cursor.pos.y)elseif bu==#b1 then break else if self.limits.x>0 then b2=b2:sub(1,self.limits.x)end;table.insert(self.lines,self.cursor.pos.y,b2)self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)end end else local bv=self.lines[self.cursor.pos.y]local bw=bv:sub(1,self.cursor.pos.x-1)local bp=bv:sub(self.cursor.pos.x)if self.limits.x>0 then b1[1]=b1[1]:sub(1,self.limits.x-(#bw+#bp))end;self.lines[self.cursor.pos.y]=bw..b1[1]..bp;self:set_cursor(self.cursor.pos.x+#b1[1],self.cursor.pos.y)end end,print=function(self,...)local at=j.join({...},"\n").."\n"self:write(at)end,clear=function(self)self.lines={""}self:set_cursor(1,1)end},Window={new=function(B,C,a4,a5,af,by)local bz={draw_priority=b.HIGH_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a4,a5),drag_options={enabled=true,from=A.Vector2.new(1,1)},shadow={enabled=by,offset=A.Vector2.new(1,1)},elements={},colors={background=af,shadow=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end}}setmetatable(bz,aY.Window)return bz end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.shadow.enabled then aj:rectangle(self.pos.x+self.shadow.offset.x,self.pos.y+self.shadow.offset.y,self.size.x,self.size.y,self.colors.shadow)end;aj:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)self:draw_elements()end,event=function(self,aQ)if self.hidden then return false end;local bA=self:event_elements(aQ)if not bA then if aQ.name==b.TOUCH then if a1.is_area_pressed(aQ.x,aQ.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.drag_options.from=A.Vector2.new(aQ.x,aQ.y)self.focussed=true;self.callbacks.onPress(self,aQ)self.callbacks.onFocus(self,aQ)return true else self.focussed=false;self.callbacks.onFailedPress(self,aQ)self.callbacks.onFocus(self,aQ)end elseif aQ.name==b.MOUSEDRAG and self.focussed then self:drag(aQ.x,aQ.y)return true elseif aQ.name==b.DELETED then self.focussed=false;self.callbacks.onFocus(self,aQ)end else self.focussed=false;self.callbacks.onFocus(self,aQ)end;return bA end,drag=function(self,B,C)if self.drag_options.enabled then local bB=A.Vector2.new(B-self.drag_options.from.x,C-self.drag_options.from.y)self.pos=self.pos+bB;for d,bC in pairs(self.elements)do if bC.pos then bC.pos=bC.pos+bB end end;self.drag_options.from=A.Vector2.new(B,C)end end,set_elements=function(self,bD,bE)self.elements={}for d,bC in pairs(bD)do if bE then bC.pos=self.pos+bC.pos-A.Vector2.ONE end;table.insert(self.elements,bC)end end,draw_elements=function(self)for d=#self.elements,1,-1 do local bC=self.elements[d]if bC.draw then bC:draw()end end end,event_elements=function(self,aQ)local bA=false;for d,bC in pairs(self.elements)do if bC.event then local bF=bC:event(aQ)bA=bA or bF;if bF then aQ={name=b.DELETED}end end end;return bA end}}aY.Clock.__index=aY.Clock;aY.Label.__index=aY.Label;aY.Button.__index=aY.Button;aY.Progressbar.__index=aY.Progressbar;aY.Memo.__index=aY.Memo;aY.Window.__index=aY.Window;local bG={}bG={new=function(bH,bI)local bJ={options={enabled=false,FPS_target=bH,EPS_target=bI},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=aY.Clock.new(1/bH),stats_clock=aY.Clock.new(1),FPS_label=aY.Label.new(1,1,"1 FPS",colors.white),EPS_label=aY.Label.new(1,2,"1 EPS",colors.white)}},stats={pos=A.Vector2.new(1,1),elements=nil,enabled=true,enable=function(self,bK)self.enabled=bK;self.elements.stats_clock.enabled=bK;self.elements.FPS_label.hidden=not bK;self.elements.EPS_label.hidden=not bK end,update_pos=function(self)self.elements.FPS_label.pos=self.pos;self.elements.EPS_label.pos=self.pos+A.Vector2.DOWN end,FPS=0,EPS=0},callbacks={onStart=function()end,onStop=function()end,onDraw=function()end,onClock=function()end,onEvent=function()end}}bJ.elements.loop.stats_clock.stats=bJ.stats;bJ.stats.elements=bJ.elements.loop;e.set_callback(bJ.elements.loop.stats_clock,b.ONCLOCK,function(self,aQ)self.stats:update_pos()self.stats.elements.FPS_label.text=tostring(self.stats.FPS).." FPS"self.stats.elements.EPS_label.text=tostring(self.stats.EPS).." EPS"self.stats.FPS=0;self.stats.EPS=0 end)bJ.stats:enable(false)setmetatable(bJ,bG)return bJ end,set_monitors=function(self,aa)self.monitors=a9.get_monitors(aa)end,set_elements=function(self,bD)self.elements.high_priority={}self.elements.low_priority={}for d,n in pairs(bD)do if n.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,n)else table.insert(self.elements.low_priority,n)end end end,draw_elements=function(self)local function bL(k)for d=#k,1,-1 do local bC=k[d]if bC.draw then bC:draw()end end end;self.callbacks.onDraw(self)local bM=aj.screens;aj.screens=self.monitors;bL(self.elements.low_priority)bL(self.elements.high_priority)for d,bC in pairs(self.elements.loop)do if bC.draw then bC:draw()end end;aj:draw()aj.screens=bM;if self.stats.enabled then self.stats.FPS=self.stats.FPS+1 end end,event_elements=function(self,aQ)local function a6(k)for d,bC in pairs(k)do if bC.event then if bC:event(aQ)then aQ={name=b.DELETED}end end end end;if self.callbacks.onEvent(self,aQ)then aQ={name=b.DELETED}end;if aQ.name==b.TOUCH then local bN=false;for bO,ad in pairs(self.monitors)do if aQ.from==bO then bN=true;break end end;if not bN then aQ={name=b.DELETED}end end;a6(self.elements.loop)local bP={}for d,bC in pairs(self.elements.high_priority)do if bC.event then local bQ=bC:event(aQ)if bQ then aQ={name=b.DELETED}if self.elements.high_priority~=bC then table.insert(bP,{element=bC,key=d})end end end end;if#bP>0 then for d,n in pairs(bP)do table.insert(self.elements.high_priority,1,n.element)table.remove(self.elements.high_priority,n.key+#bP)end end;a6(self.elements.low_priority)if self.stats.enabled then self.stats.EPS=self.stats.EPS+1 end end,start=function(self)self.enabled=true;aM:reset()e.set_callback(self.elements.loop.clock,b.ONCLOCK,function(bR,aQ)self.callbacks.onClock(self,aQ)self:draw_elements()bR.interval=1/self.options.FPS_target end)self.stats:update_pos()self.callbacks.onStart(self)while self.enabled do local bS=os.startTimer(1/self.options.EPS_target)local bT={os.pullEvent()}local aQ=a1.format_event_table(bT)aM:manage_event(aQ)self:event_elements(aQ)os.cancelTimer(bS)end;aM:reset()self.callbacks.onStop(self)end,stop=function(self)self.enabled=false end}bG.__index=bG;local bU={...}if bU[1]=="help"then local b1={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil},{text=" - create <PATH> (creates a new YAGUI project)",foreground=colors.green,background=nil}}for d,b2 in pairs(b1)do a9.better_print(term,b2.foreground,b2.background,b2.text)end elseif bU[1]=="info"then a9.better_print(term,colors.red,nil,"Library Version: ",a.ver)a9.better_print(term,colors.yellow,nil,"Library Author: ",a.author)a9.better_print(term,colors.green,nil,"Library Website: ",a.website)a9.better_print(term,colors.blue,nil,"Library Documentation: ",a.documentation)elseif bU[1]=="ver"then a9.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif bU[1]=="copyright"then local bV={colors.red,colors.yellow,colors.green}local bW=j.split(a.copyright,"\n\n")for d,bX in pairs(bW)do a9.better_print(term,bV[d],nil,bX)if d<#bW then read("")end end elseif bU[1]=="setup"then if shell then local bY="YAGUI_PATH"local x="/"..shell.getRunningProgram()a7:set(bY,x)a9.better_print(term,colors.green,nil,"Lib path was set to \"",a7.get(bY),"\".")else a9.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE!")end elseif bU[1]=="create"then if bU[2]then local x=shell.resolve(bU[2])local a8=fs.getName(x):lower()if j.get_extension(x)~="lua"then x=x..".lua"end;if fs.exists(x)then a9.better_print(term,colors.red,nil,"PATH: \"/",x,"\" already exists, please use another path or delete it.")else local bZ=fs.open(x,"w")bZ.write("\n-- AUTO-GENERATED with \"YAGUI create\"\nlocal YAGUI_PATH = settings.get(\"YAGUI_PATH\")\nif not (type(YAGUI_PATH) == \"string\") then printError(\"YAGUI is not installed, please install it by opening it with argument \\\"setup\\\".\"); return; end\nif not fs.exists(YAGUI_PATH) then printError(\"Couldn't find YAGUI in path: \\\"\"..YAGUI_PATH..\"\\\", Please reinstall it by opening it with argument \\\"setup\\\".\"); return; end\nlocal YAGUI = dofile(YAGUI_PATH)\n-- End of AUTO-GENERATED code\n\n")bZ.close()a9.better_print(term,colors.green,nil,"New project was created at \"/",x,"\".")end else a9.better_print(term,colors.red,nil,"You must specify a path to create a new project.")end elseif bU[1]then a9.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",bU[1],"\"")a9.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local b_={info=a,generic_utils=e,string_utils=j,math_utils=A,table_utils=V,color_utils=Y,event_utils=a1,setting_utils=a7,monitor_utils=a9,screen_buffer=aj,input=aM,WSS=aR,wireless_screen_share=aR,gui_elements=aY,Loop=bG}for d,n in pairs(b)do b_[d]=n end;return b_