--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.1",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONDRAW=3,ONPRESS=4,ONCLOCK=5,ONEVENT=6}local c={set_callback=function(d,e,f)if e==b.ONDRAW then d.callbacks.onDraw=f elseif e==b.ONPRESS then d.callbacks.onPress=f elseif e==b.ONCLOCK then d.callbacks.onClock=f end end}local g={}g={join=function(h,i)if not i then i=""end;local j=""for k=1,#h do local l=h[k]j=j..tostring(l)if k<#h then j=j..i end end;return j end,split=function(j,i)local h={}while true do local m=j:find(i)if m then table.insert(h,j:sub(1,m-1))j=j:sub(m+1)else table.insert(h,j)break end end;return h end,compare_versions=function(n,o)local p=g.split(n,".")local q=g.split(o,".")local r=#p;local s=#q;for t=1,math.min(r,s)do if tonumber(p[t])>tonumber(q[t])then return 1 elseif tonumber(p[t])<tonumber(q[t])then return-1 end end;if r>s then return 1 elseif r<s then return-1 end;return 0 end}local u={}u={vector2=function(v,w)return{x=v,y=w}end,map=function(l,x,y,z,A,B)local C=(l-x)/(y-x)*(A-z)+z;if B then return u.constrain(C,z,A)end;return C end,constrain=function(l,D,E)return math.min(E,math.max(D,l))end}local F={is_area_pressed=function(G,H,v,w,I,J)if G>=v and G<v+I then if H>=w and H<w+J then return true end end;return false end,format_event_table=function(K)local e={}e.name=K[1]if e.name=="mouse_click"then e.name=b.TOUCH;e.from="terminal"e.button=K[2]e.x=K[3]e.y=K[4]return e elseif e.name=="monitor_touch"then e.name=b.TOUCH;e.from=K[2]e.button=1;e.x=K[3]e.y=K[4]return e end;table.remove(K,1)e.parameters=K;return e end}local L={_path="/.settings",set=function(self,M,l)settings.set(M,l)settings.save(self._path)end,unset=function(self,M)settings.unset(M)settings.save(self._path)end,get=function(M)return settings.get(M)end}local N={get_monitors=function(O)local P={}for k,Q in pairs(O)do if Q=="terminal"then P[Q]=term else if peripheral.getType(Q)=="monitor"then P[Q]=peripheral.wrap(Q)end end end;return P end,better_print=function(R,S,T,...)local U=g.join({...},"")local V=R.getTextColor()local W=R.getBackgroundColor()if S then R.setTextColor(S)end;if T then R.setBackgroundColor(T)end;print(U)R.setTextColor(V)R.setBackgroundColor(W)end}local X={frame={},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,v,w)v=tostring(v)w=tostring(w)if self.pixels[v]then if self.pixels[v][w]then return true end end;return false end,get_pixel=function(self,v,w)v=tostring(v)w=tostring(w)if self:is_pixel_custom(v,w)then return self.pixels[v][w]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,v,w,char,S,T)v=tostring(v)w=tostring(w)local Y=self:get_pixel(v,w)if char and#char==1 then Y.char=char end;if S then Y.foreground=S end;if T then Y.background=T end;if not self.pixels[v]then self.pixels[v]={}end;self.pixels[v][w]=Y end,clear=function(self)self.pixels={}end},set_screens=function(self,Z)self.screens=N.get_monitors(Z)end,clear=function(self)self.buffer:clear()end,draw=function(self)local _=self.screens;local a0=self.buffer;for a1,a2 in pairs(_)do local a3=a2.getBackgroundColor()local a4=a2.getTextColor()local a5,a6=a2.getCursorPos()local I,J=a2.getSize()for v=1,I do for w=1,J do a2.setCursorPos(v,w)local Y=a0:get_pixel(v,w)a2.setBackgroundColor(Y.background)a2.setTextColor(Y.foreground)a2.write(Y.char)end end;a2.setBackgroundColor(a3)a2.setTextColor(a4)a2.setCursorPos(a5,a6)end;self.frame=self.buffer.pixels;if self.clear_after_draw then self:clear()end end,point=function(self,v,w,a7)self.buffer:set_pixel(v,w," ",a7,a7)end,write=function(self,v,w,a8,S,T)for a9=0,#a8-1 do char=a8:sub(a9+1,a9+1)self.buffer:set_pixel(v+a9,w,char,S,T)end end,rectangle=function(self,v,w,I,J,a7)for a9=0,I-1 do for aa=0,J-1 do self:point(v+a9,w+aa,a7)end end end,line=function(self,ab,ac,ad,ae,a7)local function af(ab,ac,ad,ae)local ag=1;if ab>ad then ag=-1 end;local ah=ad-ab;local ai=ae-ac;local aj=1;if ai<0 then aj=-1;ai=-ai end;local ak=2*ai-ah;local w=ac;for v=ab,ad,ag do self:point(v,w,a7)if ak>0 then w=w+aj;ak=ak-2*ah end;ak=ak+2*ai end end;local function al(ab,ac,ad,ae)local ag=1;if ac>ae then ag=-1 end;local ah=ad-ab;local ai=ae-ac;local am=1;if ah<0 then am=-1;ah=-ah end;local ak=2*ah-ai;local v=ab;for w=ac,ae,ag do self:point(v,w,a7)if ak>0 then v=v+am;ak=ak-2*ai end;ak=ak+2*ah end end;if math.abs(ae-ac)<math.abs(ad-ab)then if ab>ad then af(ad,ae,ab,ac)else af(ab,ac,ad,ae)end else if ac>ae then al(ad,ae,ab,ac)else al(ab,ac,ad,ae)end end end,circle=function(self,an,ao,ap,a7)local aq=ap*ap;self:point(an,ao+ap,a7)self:point(an,ao-ap,a7)self:point(an+ap,ao,a7)self:point(an-ap,ao,a7)local v=1;local w=math.floor(math.sqrt(aq-1)+0.5)while v<w do self:point(an+v,ao+w,a7)self:point(an+v,ao-w,a7)self:point(an-v,ao+w,a7)self:point(an-v,ao-w,a7)self:point(an+w,ao+v,a7)self:point(an+w,ao-v,a7)self:point(an-w,ao+v,a7)self:point(an-w,ao-v,a7)v=v+1;w=math.floor(math.sqrt(aq-v*v)+0.5)end;if v==w then self:point(an+v,ao+w,a7)self:point(an+v,ao-w,a7)self:point(an-v,ao+w,a7)self:point(an-v,ao-w,a7)end end}local ar={}ar={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,as)rednet.open(as)self.side=as end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,at)if not at then at=os.getComputerID()end;at=tostring(at)local au=self.root.protocol..self.root.host_prefix..at;if rednet.lookup(au,at)then return false end;rednet.host(au,at)self.servername=au;self.hostname=at;return true end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast({background=X.buffer.background,frame=X.frame},self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,at)at=tostring(at)local au=self.root.protocol..self.root.host_prefix..at;local av=rednet.lookup(au,at)if not av then return false end;self.servername=au;self.host_id=av;return true end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,aw)if not aw then aw=self.root.default_timeout end;local ax={rednet.receive(self.servername,aw)}if ax[1]==self.host_id then local a0=ax[2]if not a0 then return false end;if a0==b.DISCONNECTED then return a0 end;X.buffer.background=a0.background;X.buffer.pixels=a0.frame;return true end;return false end}}ar.server.root=ar;ar.client.root=ar;local ay={}ay={Clock={new=function(az)local aA={enabled=true,oneshot=false,clock=os.clock(),interval=az,callbacks={onClock=function()end}}setmetatable(aA,ay.Clock)return aA end,event=function(self,aB)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,aB)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(v,w,a8,S,T)local aC={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text=a8,pos=u.vector2(v,w),colors={foreground=S,background=T},callbacks={onDraw=function()end,onPress=function()end}}setmetatable(aC,ay.Label)return aC end,draw=function(self)self.callbacks.onDraw(self)X:write(self.pos.x,self.pos.y,self.text,self.colors.foreground,self.colors.background)end,event=function(self,aB)if aB.name==b.TOUCH then if F.is_area_pressed(aB.x,aB.y,self.pos.x,self.pos.y,#self.text,1)then self.callbacks.onPress(self,aB)end end end},Button={new=function(v,w,I,J,a8,S,aD,aE)local aF={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,text=a8,pos=u.vector2(v,w),size=u.vector2(I,J),timed={enabled=false,clock=ay.Clock.new(0.5)},colors={foreground=S,active_background=aD,unactive_background=aE},callbacks={onDraw=function()end,onPress=function()end}}aF.timed.clock.binded_button=aF;aF.timed.clock.oneshot=true;c.set_callback(aF.timed.clock,b.ONCLOCK,function(self,aB)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,aB)end)setmetatable(aF,ay.Button)return aF end,draw=function(self)self.callbacks.onDraw(self)if self.active then X:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else X:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local aG=g.split(self.text,"\n")local aH=math.floor((self.size.y-#aG)/2)+self.pos.y;for aa=0,#aG-1 do local l=aG[aa+1]local aI=math.floor((self.size.x-#l)/2)+self.pos.x;X:write(aI,aH+aa,l,self.colors.foreground)end end,event=function(self,aB)if aB.name==b.TOUCH then if F.is_area_pressed(aB.x,aB.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,aB)end else self:press()self.callbacks.onPress(self,aB)end;return true end end;if self.timed.enabled then self.timed.clock:event(aB)end end,press=function(self)self.active=not self.active end},Progressbar={new=function(v,w,I,J,aJ,D,E,S,aK,aL)local aM={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=u.vector2(v,w),size=u.vector2(I,J),value={max=E,min=D,current=aJ,draw_percentage=true},colors={foreground=S,filled_background=aK,unfilled_background=aL},callbacks={onDraw=function()end,onPress=function()end}}setmetatable(aM,ay.Progressbar)return aM end,draw=function(self)self.callbacks.onDraw(self)local aN=u.map(self.value.current,self.value.min,self.value.max,0,1,true)local aO=math.floor(self.size.x*aN)X:rectangle(self.pos.x,self.pos.y,aO,self.size.y,self.colors.filled_background)X:rectangle(self.pos.x+aO,self.pos.y,self.size.x-aO,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local aP=tostring(aN*100).."%"local aQ=math.floor((self.size.x-#aP)/2)+self.pos.x;local aH=math.floor((self.size.y-1)/2)+self.pos.y;X:write(aQ,aH,aP,self.colors.foreground)end end,event=function(self,aB)if aB.name==b.TOUCH then if F.is_area_pressed(aB.x,aB.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,aB)end end end,set=function(self,l)local aR=u.constrain(l,self.value.min,self.value.max)self.value.current=aR end}}ay.Clock.__index=ay.Clock;ay.Label.__index=ay.Label;ay.Button.__index=ay.Button;ay.Progressbar.__index=ay.Progressbar;local aS={}aS={new=function(aT,aU)local aV={options={enabled=false,FPS_target=aT,EPS_target=aU},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=ay.Clock.new(1/aT)}},callbacks={onDraw=function()end,onClock=function()end,onEvent=function()end}}setmetatable(aV,aS)return aV end,set_monitors=function(self,O)self.monitors=N.get_monitors(O)end,set_elements=function(self,aW)self.elements.high_priority={}self.elements.low_priority={}for k,l in pairs(aW)do if l.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,l)else table.insert(self.elements.low_priority,l)end end end,draw_elements=function(self)local function aX(h)for k=#h,1,-1 do local aY=h[k]if aY.draw then aY:draw()end end end;self.callbacks.onDraw(self)local aZ=X.screens;X.screens=self.monitors;aX(self.elements.low_priority)aX(self.elements.high_priority)aX(self.elements.loop)X:draw()X.screens=aZ end,event_elements=function(self,a_)local aB=F.format_event_table(a_)local function K(h)for k,aY in pairs(h)do if aY:event(aB)then aB={name=b.DELETED}end end end;self.callbacks.onEvent(self,aB)if aB.name==b.TOUCH then local b0=false;for b1,R in pairs(self.monitors)do if aB.from==b1 then b0=true;break end end;if not b0 then aB={name=b.DELETED}end end;K(self.elements.loop)K(self.elements.high_priority)K(self.elements.low_priority)end,start=function(self)self.enabled=true;c.set_callback(self.elements.loop.clock,b.ONCLOCK,function(b2,aB)self.callbacks.onClock(self,aB)self:draw_elements()end)while self.enabled do local b3=os.startTimer(1/self.options.EPS_target)local a_={os.pullEvent()}self:event_elements(a_)os.cancelTimer(b3)end end,stop=function(self)self.enabled=false end}aS.__index=aS;local b4={...}if b4[1]=="help"then local b5={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil}}for k,b6 in pairs(b5)do N.better_print(term,b6.foreground,b6.background,b6.text)end elseif b4[1]=="info"then N.better_print(term,colors.red,nil,"Library Version: ",a.ver)N.better_print(term,colors.yellow,nil,"Library Author: ",a.author)N.better_print(term,colors.green,nil,"Library Website: ",a.website)elseif b4[1]=="ver"then N.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif b4[1]=="copyright"then local b7={colors.red,colors.yellow,colors.green}local b8=g.split(a.copyright,"\n\n")for k,b9 in pairs(b8)do N.better_print(term,b7[k],nil,b9)if k<#b8 then read("")end end elseif b4[1]=="setup"then if shell then local ba="YAGUI_PATH"local bb="/"..shell.getRunningProgram()L:set(ba,bb)N.better_print(term,colors.green,nil,"Lib path was set to ",L.get(ba))else N.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE")end elseif b4[1]then N.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",b4[1],"\"")N.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local bc={info=a,generic_utils=c,string_utils=g,math_utils=u,event_utils=F,setting_utils=L,monitor_utils=N,screen_buffer=X,WSS=ar,wireless_screen_share=ar,gui_elements=ay,Loop=aS}for k,l in pairs(b)do bc[k]=l end;return bc