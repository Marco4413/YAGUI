--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.12",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI/",documentation="https://yagui.readthedocs.io/en/latest/",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",MOUSEDRAG="mouse_drag",MOUSESCROLL="mouse_scroll",CHAR="char",KEY="key",KEYUP="key_up",PASTE="paste",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONSTART=1,ONSTOP=2,ONDRAW=3,ONPRESS=4,ONFAILEDPRESS=5,ONTIMEOUT=6,ONCLOCK=7,ONEVENT=8,ONFOCUS=9,ONKEY=10,ONCHAR=11,MOUSE_LEFT=1,MOUSE_RIGHT=2,MOUSE_MIDDLE=3,SCROLL_UP=-1,SCROLL_DOWN=1,COMPUTER="computer",TURTLE="turtle",POCKET="pocket",ALIGN_LEFT=1,ALIGN_CENTER=2}for c,d in pairs(keys)do if type(d)=="number"then b["KEY_"..c:upper()]=d end end;local e={set_callback=function(f,g,h)if g==b.ONSTART then f.callbacks.onStart=h elseif g==b.ONSTOP then f.callbacks.onStop=h elseif g==b.ONDRAW then f.callbacks.onDraw=h elseif g==b.ONPRESS then f.callbacks.onPress=h elseif g==b.ONFAILEDPRESS then f.callbacks.onFailedPress=h elseif g==b.ONTIMEOUT then f.callbacks.onTimeout=h elseif g==b.ONCLOCK then f.callbacks.onClock=h elseif g==b.ONEVENT then f.callbacks.onEvent=h elseif g==b.ONFOCUS then f.callbacks.onFocus=h elseif g==b.ONKEY then f.callbacks.onKey=h elseif g==b.ONCHAR then f.callbacks.onChar=h end end,get_computer_type=function()local i=b.COMPUTER;if turtle then i=b.TURTLE elseif pocket then i=b.POCKET end;return i,term.isColor()end}local j={}j={magic_characters={"(",")",".","%","+","-","*","?","[","]","^","$"},join=function(k,l)if not l then l=""end;local m=""for d=1,#k do local n=k[d]m=m..tostring(n)if d<#k then m=m..l end end;return m end,split=function(m,l)local k={}while true do local o=m:find(l)if o then table.insert(k,m:sub(1,o-1))m=m:sub(o+1)else table.insert(k,m)break end end;return k end,compare_versions=function(p,q)local r=j.split(p,".")local s=j.split(q,".")local t=#r;local u=#s;for v=1,math.min(t,u)do if tonumber(r[v])>tonumber(s[v])then return 1 elseif tonumber(r[v])<tonumber(s[v])then return-1 end end;if t>u then return 1 elseif t<u then return-1 end;return 0 end,escape_magic_characters=function(m)for d,w in pairs(j.magic_characters)do m=m:gsub("[%"..w.."]",'%%%'..w)end;return m end,get_extension=function(x)local y,z=x:gsub(".*%.","")if z>0 then return y end;return""end}local A={}A={Vector2={new=function(B,C)local D={x=B or 0,y=C or 0}setmetatable(D,A.Vector2)return D end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y end,cross=function(self,E)return self.x*E.y-self.y*E.x end,rotate=function(self,F)local G=math.cos(F)local H=math.sin(F)return A.Vector2.new(G*self.x-H*self.y,H*self.x+G*self.y)end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y)else return string.format("(%f; %f)",self.x,self.y)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector2.new(self.x+E.x,self.y+E.y)end,__sub=function(self,E)return A.Vector2.new(self.x-E.x,self.y-E.y)end,__mul=function(self,J)if type(self)=="number"then return A.Vector2.new(J.x*self,J.y*self)else return A.Vector2.new(self.x*J,self.y*J)end end,__div=function(self,J)return A.Vector2.new(self.x/J,self.y/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},Vector3={new=function(B,C,K)local L={x=B or 0,y=C or 0,z=K or 0}setmetatable(L,A.Vector3)return L end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)+math.pow(self.z,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y+self.z*E.z end,cross=function(self,E)return A.Vector3.new(self.y*E.z-self.z*E.y,self.z*E.x-self.x*E.z,self.x*E.y-self.y*E.x)end,rotate=function(self,M,F)local G=math.cos(F)return G*self+math.sin(F)*M:cross(self)+(1-G)*M:dot(self)*M end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y,self.z)else return string.format("(%f; %f; %f)",self.x,self.y,self.z)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector3.new(self.x+E.x,self.y+E.y,self.z+E.z)end,__sub=function(self,E)return A.Vector3.new(self.x-E.x,self.y-E.y,self.z-E.z)end,__mul=function(self,J)if type(self)=="number"then return A.Vector3.new(J.x*self,J.y*self,J.z*self)else return A.Vector3.new(self.x*J,self.y*J,self.z*J)end end,__div=function(self,J)return A.Vector3.new(self.x/J,self.y/J,self.z/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},map=function(n,N,O,P,Q,R)local S=(n-N)/(O-N)*(Q-P)+P;if R then return A.constrain(S,P,Q)end;return S end,constrain=function(n,T,U)return math.min(U,math.max(T,n))end,round=function(J)return math.floor(J+0.5)end,round_numbers=function(...)local V={...}local W={}for d,J in pairs(V)do table.insert(W,A.round(J))end;return table.unpack(W)end}A.Vector2.__index=A.Vector2;A.Vector3.__index=A.Vector3;A.Vector2.ONE=A.Vector2.new(1,1)A.Vector2.UP=A.Vector2.new(0,-1)A.Vector2.DOWN=A.Vector2.new(0,1)A.Vector2.LEFT=A.Vector2.new(-1,0)A.Vector2.RIGHT=A.Vector2.new(1,0)A.Vector2.ZERO=A.Vector2.new(0,0)A.Vector3.ONE=A.Vector3.new(1,1,1)A.Vector3.UP=A.Vector3.new(0,1,0)A.Vector3.DOWN=A.Vector3.new(0,-1,0)A.Vector3.LEFT=A.Vector3.new(-1,0,0)A.Vector3.RIGHT=A.Vector3.new(1,0,0)A.Vector3.FORWARD=A.Vector3.new(0,0,1)A.Vector3.BACK=A.Vector3.new(0,0,-1)A.Vector3.ZERO=A.Vector3.new(0,0,0)local X={has_value=function(k,n)for Y,Z in pairs(k)do if Z==n then return true,Y end end;return false,nil end,has_key=function(k,d)if k[d]~=nil then return true,k[d]end;return false,nil end}local _={}_={colors={[1]="0",[2]="1",[4]="2",[8]="3",[16]="4",[32]="5",[64]="6",[128]="7",[256]="8",[512]="9",[1024]="a",[2048]="b",[4096]="c",[8192]="d",[16384]="e",[32768]="f"},color_to_paint=function(a0)return _.colors[a0]end,paint_to_color=function(a1)local a2,a0=X.has_value(_.colors,a1)if a2 then return a0 end end}local a3={is_area_pressed=function(a4,a5,B,C,a6,a7)if a4>=B and a4<B+a6 then if a5>=C and a5<C+a7 then return true end end;return false end,format_event_table=function(a8)local g={}g.name=a8[1]if g.name=="mouse_click"then g.name=b.TOUCH;g.from="terminal"g.button=a8[2]g.x=a8[3]g.y=a8[4]return g elseif g.name=="monitor_touch"then g.name=b.TOUCH;g.from=a8[2]g.button=1;g.x=a8[3]g.y=a8[4]return g elseif g.name=="mouse_drag"then g.name=b.MOUSEDRAG;g.button=a8[2]g.x=a8[3]g.y=a8[4]return g elseif g.name=="mouse_up"then g.name=b.MOUSEUP;g.button=a8[2]g.x=a8[3]g.y=a8[4]return g elseif g.name=="mouse_scroll"then g.name=b.MOUSESCROLL;g.direction=a8[2]g.x=a8[3]g.y=a8[4]return g elseif g.name=="char"then g.name=b.CHAR;g.char=a8[2]return g elseif g.name=="key"then g.name=b.KEY;g.key=a8[2]return g elseif g.name=="key_up"then g.name=b.KEYUP;g.key=a8[2]return g elseif g.name=="paste"then g.name=b.PASTE;g.paste=a8[2]return g end;table.remove(a8,1)g.parameters=a8;return g end}local a9={_path="/.settings",set=function(self,aa,n)settings.set(aa,n)settings.save(self._path)end,unset=function(self,aa)settings.unset(aa)settings.save(self._path)end,get=function(aa)return settings.get(aa)end}local ab={get_monitors=function(ac)local ad={}for d,ae in pairs(ac)do if ae=="terminal"then ad[ae]=term else if peripheral.getType(ae)=="monitor"then ad[ae]=peripheral.wrap(ae)end end end;return ad end,better_print=function(af,ag,ah,...)local ai=j.join({...},"")local aj=af.getTextColor()local ak=af.getBackgroundColor()if ag then af.setTextColor(ag)end;if ah then af.setBackgroundColor(ah)end;print(ai)af.setTextColor(aj)af.setBackgroundColor(ak)end,better_clear=function(af)af.clear()af.setCursorPos(1,1)end}local al={frame={pixels={},background=nil},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,B,C)B=tostring(B)C=tostring(C)if self.pixels[B]then if self.pixels[B][C]then return true end end;return false end,get_pixel=function(self,B,C)B=tostring(B)C=tostring(C)if self:is_pixel_custom(B,C)then return self.pixels[B][C]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,B,C,char,ag,ah)B=tostring(B)C=tostring(C)local am=self:get_pixel(B,C)if char and#char==1 then am.char=char end;am.foreground=ag or am.background;am.background=ah or am.background;if not self.pixels[B]then self.pixels[B]={}end;self.pixels[B][C]=am end,clear=function(self)self.pixels={}end},set_screens=function(self,an)self.screens=ab.get_monitors(an)end,set_monitors=function(self,ac)self:set_screens(ac)end,clear=function(self)self.buffer:clear()end,draw=function(self)local ao=self.screens;local ap=self.buffer;for aq,ar in pairs(ao)do local as,at=ar.getCursorPos()local a6,a7=ar.getSize()for C=1,a7 do local au={text="",background="",foreground=""}for B=1,a6 do local am=ap:get_pixel(B,C)au.text=au.text..am.char;au.background=au.background.._.colors[am.background]au.foreground=au.foreground.._.colors[am.foreground]end;ar.setCursorPos(1,C)ar.blit(au.text,au.foreground,au.background)end;ar.setCursorPos(as,at)end;self.frame.pixels=self.buffer.pixels;self.frame.background=self.buffer.background;if self.clear_after_draw then self:clear()end end,point=function(self,B,C,a0)self.buffer:set_pixel(B,C," ",a0,a0)end,write=function(self,B,C,av,ag,ah)for aw=0,#av-1 do char=av:sub(aw+1,aw+1)self.buffer:set_pixel(B+aw,C,char,ag,ah)end end,rectangle=function(self,B,C,a6,a7,a0)for aw=0,a6-1 do for ax=0,a7-1 do self:point(B+aw,C+ax,a0)end end end,line=function(self,ay,az,aA,aB,a0)local function aC(ay,az,aA,aB)local aD=1;if ay>aA then aD=-1 end;local aE=aA-ay;local aF=aB-az;local aG=1;if aF<0 then aG=-1;aF=-aF end;local aH=2*aF-aE;local C=az;for B=ay,aA,aD do self:point(B,C,a0)if aH>0 then C=C+aG;aH=aH-2*aE end;aH=aH+2*aF end end;local function aI(ay,az,aA,aB)local aD=1;if az>aB then aD=-1 end;local aE=aA-ay;local aF=aB-az;local aJ=1;if aE<0 then aJ=-1;aE=-aE end;local aH=2*aE-aF;local B=ay;for C=az,aB,aD do self:point(B,C,a0)if aH>0 then B=B+aJ;aH=aH-2*aF end;aH=aH+2*aE end end;if math.abs(aB-az)<math.abs(aA-ay)then if ay>aA then aC(aA,aB,ay,az)else aC(ay,az,aA,aB)end else if az>aB then aI(aA,aB,ay,az)else aI(ay,az,aA,aB)end end end,circle=function(self,aK,aL,aM,a0)local aN=aM*aM;self:point(aK,aL+aM,a0)self:point(aK,aL-aM,a0)self:point(aK+aM,aL,a0)self:point(aK-aM,aL,a0)local B=1;local C=math.floor(math.sqrt(aN-1)+0.5)while B<C do self:point(aK+B,aL+C,a0)self:point(aK+B,aL-C,a0)self:point(aK-B,aL+C,a0)self:point(aK-B,aL-C,a0)self:point(aK+C,aL+B,a0)self:point(aK+C,aL-B,a0)self:point(aK-C,aL+B,a0)self:point(aK-C,aL-B,a0)B=B+1;C=math.floor(math.sqrt(aN-B*B)+0.5)end;if B==C then self:point(aK+B,aL+C,a0)self:point(aK+B,aL-C,a0)self:point(aK-B,aL+C,a0)self:point(aK-B,aL-C,a0)end end}local aO={pressed_keys={},reset=function(self)self.pressed_keys={}end,is_key_pressed=function(self,aP,d)if self.pressed_keys[d]then if aP then self:remove_key(d)end;return true end;return false end,are_keys_pressed=function(self,aQ,...)local keys={...}if not(#keys>0)then return false end;for aR,d in pairs(keys)do if not self:is_key_pressed(false,d)then return false end end;if aQ then self:remove_keys(table.unpack(keys))end;return true end,add_key=function(self,d)self.pressed_keys[d]=true end,remove_key=function(self,d)self.pressed_keys[d]=nil end,remove_keys=function(self,...)local keys={...}for aR,d in pairs(keys)do self:remove_key(d)end end,manage_event=function(self,aS)if aS.name==b.KEY then self:add_key(aS.key)elseif aS.name==b.KEYUP then self:remove_key(aS.key)end end}local aT={}aT={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,aU)rednet.open(aU)self.side=aU end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,aV)if not aV then aV=os.getComputerID()end;aV=tostring(aV)local aW=self.root.protocol..self.root.host_prefix..aV;if rednet.lookup(aW,aV)then return false,aV end;rednet.host(aW,aV)self.servername=aW;self.hostname=aV;return true,aV end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast(al.frame,self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,aV)aV=tostring(aV)local aW=self.root.protocol..self.root.host_prefix..aV;local aX=rednet.lookup(aW,aV)if not aX then return false,aV end;self.servername=aW;self.host_id=aX;return true,aV end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,aY)if not aY then aY=self.root.default_timeout end;local aZ={rednet.receive(self.servername,aY)}if aZ[1]==self.host_id then local ap=aZ[2]if not ap then return false end;if ap==b.DISCONNECTED then return ap end;al.buffer.background=ap.background;al.buffer.pixels=ap.pixels;return true end;return false end}}aT.server.root=aT;aT.client.root=aT;local a_={}a_={Clock={new=function(b0)local b1={enabled=true,oneshot=false,clock=os.clock(),interval=b0,callbacks={onClock=function()end}}setmetatable(b1,a_.Clock)return b1 end,event=function(self,aS)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,aS)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(B,C,av,ag,ah)local b2={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text_alignment=b.ALIGN_CENTER,text=av,pos=A.Vector2.new(B,C),colors={foreground=ag,background=ah},callbacks={onDraw=function()end}}setmetatable(b2,a_.Label)return b2 end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local b3=j.split(self.text,"\n")if self.text_alignment==b.ALIGN_LEFT then for d,b4 in pairs(b3)do al:write(self.pos.x,self.pos.y+d-1,b4,self.colors.foreground,self.colors.background)end elseif self.text_alignment==b.ALIGN_CENTER then local b5=0;for d,b4 in pairs(b3)do if d==1 then b5=math.floor(#b4/2)al:write(self.pos.x,self.pos.y,b4,self.colors.foreground,self.colors.background)else al:write(self.pos.x+b5-math.floor(#b4/2),self.pos.y+d-1,b4,self.colors.foreground,self.colors.background)end end end end},Button={new=function(B,C,a6,a7,av,ag,b6,b7)local b8={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,shortcut_once=true,shortcut={},text_alignment=b.ALIGN_CENTER,text=av,pos=A.Vector2.new(B,C),size=A.Vector2.new(a6,a7),timed={enabled=false,clock=a_.Clock.new(0.5)},colors={foreground=ag,active_background=b6,unactive_background=b7},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onTimeout=function()end}}b8.timed.clock.binded_button=b8;b8.timed.clock.oneshot=true;b8.timed.clock:stop()e.set_callback(b8.timed.clock,b.ONCLOCK,function(self,aS)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,aS)self.binded_button.callbacks.onTimeout(self.binded_button,aS)end)setmetatable(b8,a_.Button)return b8 end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.active then al:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else al:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local b3=j.split(self.text,"\n")local b9=math.floor((self.size.y-#b3)/2)+self.pos.y;for ax=0,#b3-1 do local b4=b3[ax+1]local ba;if self.text_alignment==b.ALIGN_LEFT then ba=self.pos.x elseif self.text_alignment==b.ALIGN_CENTER then ba=math.floor((self.size.x-#b4)/2)+self.pos.x end;al:write(ba,b9+ax,b4,self.colors.foreground)end end,event=function(self,aS)if self.hidden then return false end;if aS.name==b.TOUCH then if a3.is_area_pressed(aS.x,aS.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self:press(aS)return true else self.callbacks.onFailedPress(self,aS)end elseif aO:are_keys_pressed(self.shortcut_once,table.unpack(self.shortcut))then self:press(aS)end;if self.timed.enabled then self.timed.clock:event(aS)end end,press=function(self,aS)if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,aS)end else self.active=not self.active;self.callbacks.onPress(self,aS)end end},Progressbar={new=function(B,C,a6,a7,bb,T,U,ag,bc,bd)local be={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a6,a7),value={max=U,min=T,current=bb,draw_percentage=true},colors={foreground=ag,filled_background=bc,unfilled_background=bd},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end}}setmetatable(be,a_.Progressbar)return be end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bf=A.map(self.value.current,self.value.min,self.value.max,0,1,true)local bg=math.floor(self.size.x*bf)al:rectangle(self.pos.x,self.pos.y,bg,self.size.y,self.colors.filled_background)al:rectangle(self.pos.x+bg,self.pos.y,self.size.x-bg,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local bh=tostring(bf*100).."%"local bi=math.floor((self.size.x-#bh)/2)+self.pos.x;local b9=math.floor((self.size.y-1)/2)+self.pos.y;al:write(bi,b9,bh,self.colors.foreground)end end,event=function(self,aS)if self.hidden then return false end;if aS.name==b.TOUCH then if a3.is_area_pressed(aS.x,aS.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,aS)end end end,set=function(self,n)local bj=A.constrain(n,self.value.min,self.value.max)self.value.current=bj end},Memo={new=function(B,C,a6,a7,ag,ah)local bk={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a6,a7),editable=true,lines={},first_visible_line=1,first_visible_char=1,cursor={visible=false,text=" ",blink=a_.Clock.new(0.5),pos=A.Vector2.new(1,1)},limits=A.Vector2.new(0,0),whitelist={},blacklist={},colors={foreground=ag,background=ah,cursor=colors.white,cursor_text=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end,onKey=function()end,onChar=function()end}}bk.cursor.blink.binded_cursor=bk.cursor;e.set_callback(bk.cursor.blink,b.ONCLOCK,function(self,aS)self.binded_cursor.visible=not self.binded_cursor.visible end)setmetatable(bk,a_.Memo)return bk end,draw=function(self)if self.hidden then return end;al:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)local bl=self.cursor.pos.x-self.first_visible_char;local bm=self.cursor.pos.y-self.first_visible_line;if bl>=self.size.x then self.first_visible_char=self.first_visible_char+bl-self.size.x+1;bl=self.cursor.pos.x-self.first_visible_char-1 elseif bl<1 then self.first_visible_char=self.first_visible_char+bl;bl=0 end;if bm>=self.size.y then self.first_visible_line=self.first_visible_line+bm-self.size.y+1;bm=self.cursor.pos.y-self.first_visible_line-1 elseif bm<1 then self.first_visible_line=self.first_visible_line+bm;bm=0 end;for C=1,self.size.y do local b4=self.lines[C+self.first_visible_line-1]or""local bn=b4:sub(self.first_visible_char,self.first_visible_char+self.size.x-1)al:write(self.pos.x,self.pos.y+C-1,bn,self.colors.foreground)end;if self.cursor.visible then al:write(bl+self.pos.x,bm+self.pos.y,self.cursor.text,self.colors.cursor_text,self.colors.cursor)end end,event=function(self,aS)if self.hidden then return false end;if not self.editable then return false end;if aS.name==b.TOUCH then if a3.is_area_pressed(aS.x,aS.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then local B=aS.x-self.pos.x;local C=aS.y-self.pos.y;self:set_cursor(B+self.first_visible_char,C+self.first_visible_line)self:focus(true,aS)self.callbacks.onPress(self,aS)return true else self:focus(false,aS)self.callbacks.onFailedPress(self,aS)return false end elseif aS.name==b.DELETED then self:focus(false,aS)return false end;if self.focussed then self.cursor.blink:event(self.cursor.blink,aS)if aS.name==b.PASTE then self:write(aS.paste)elseif aS.name==b.CHAR then if self.callbacks.onChar(self,aS)then return true end;self:write(aS.char)elseif aS.name==b.KEY then if self.callbacks.onKey(self,aS)then return true end;if aS.key==b.KEY_UP then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y-1)elseif aS.key==b.KEY_DOWN then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)elseif aS.key==b.KEY_RIGHT then local b4=self.lines[self.cursor.pos.y]if self.lines[self.cursor.pos.y+1]and self.cursor.pos.x>=#b4+1 then self:set_cursor(1,self.cursor.pos.y+1)else self:set_cursor(self.cursor.pos.x+1,self.cursor.pos.y)end elseif aS.key==b.KEY_LEFT then if self.cursor.pos.x<=1 and self.cursor.pos.y>1 then local bo=self.lines[self.cursor.pos.y-1]self:set_cursor(#bo+1,self.cursor.pos.y-1)else self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aS.key==b.KEY_BACKSPACE then local b4=self.lines[self.cursor.pos.y]if self.cursor.pos.x<=1 then if self.cursor.pos.y>1 then table.remove(self.lines,self.cursor.pos.y)local bp=#self.lines[self.cursor.pos.y-1]+1;local bq=self.cursor.pos.y-1;self:set_cursor(bp,bq)self:write(b4)self:set_cursor(bp,bq)end else self.lines[self.cursor.pos.y]=b4:sub(1,self.cursor.pos.x-2)..b4:sub(self.cursor.pos.x)self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aS.key==b.KEY_DELETE then local b4=self.lines[self.cursor.pos.y]local br=b4:sub(self.cursor.pos.x)if#br>0 then self.lines[self.cursor.pos.y]=b4:sub(1,self.cursor.pos.x-1)..b4:sub(self.cursor.pos.x+1)else local bs=self.lines[self.cursor.pos.y+1]if bs then local bp=self.cursor.pos.x;local bq=self.cursor.pos.y;table.remove(self.lines,self.cursor.pos.y+1)self:write(bs)self:set_cursor(bp,bq)end end elseif aS.key==b.KEY_ENTER then self:write("\n")elseif aS.key==b.KEY_TAB then self:write("  ")end elseif aS.name==b.MOUSESCROLL then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+aS.direction)end;return true end end,focus=function(self,bt,aS)if bt then self.focussed=true;self.callbacks.onFocus(self,aS)else self.focussed=false;self.cursor.visible=false;self.callbacks.onFocus(self,aS)end end,set_cursor=function(self,bp,bq,bu)if not self.lines[1]then self.lines[1]=""end;if self.limits.y>0 then bq=A.constrain(bq,1,self.limits.y)end;if bu then for C=#self.lines+1,bq do if not self.lines[C]then self.lines[C]=""end end else bq=A.constrain(bq,1,#self.lines)end;bp=A.constrain(bp,1,#self.lines[bq]+1)self.cursor.pos=A.Vector2.new(bp,bq)end,write=function(self,...)local av=j.join({...},"")local b3=j.split(av,"\n")self:set_cursor(self.cursor.pos.x,self.cursor.pos.y,true)if#self.whitelist>0 then local bv="[^"..j.escape_magic_characters(j.join(self.whitelist,"")).."]"for d,b4 in pairs(b3)do b3[d]=b4:gsub(bv,"")end elseif#self.blacklist>0 then local bv="["..j.escape_magic_characters(j.join(self.blacklist,"")).."]"for d,b4 in pairs(b3)do b3[d]=b4:gsub(bv,"")end end;if self.limits.y>0 then for C=1,#self.lines+#b3-1-self.limits.y do table.remove(b3)end;if#b3==0 then return end end;if#b3>1 then for bw,b4 in pairs(b3)do if bw==1 then local bx=self.lines[self.cursor.pos.y]local by=bx:sub(1,self.cursor.pos.x-1)local br=bx:sub(self.cursor.pos.x)local bz=b3[#b3]if self.limits.x>0 then b4=b4:sub(1,self.limits.x-#by)bz=bz:sub(1,self.limits.x-#br)end;self.lines[self.cursor.pos.y]=by..b4;self:set_cursor(1,self.cursor.pos.y+1,true)table.insert(self.lines,self.cursor.pos.y,bz..br)self:set_cursor(#bz+1,self.cursor.pos.y)elseif bw==#b3 then break else if self.limits.x>0 then b4=b4:sub(1,self.limits.x)end;table.insert(self.lines,self.cursor.pos.y,b4)self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)end end else local bx=self.lines[self.cursor.pos.y]local by=bx:sub(1,self.cursor.pos.x-1)local br=bx:sub(self.cursor.pos.x)if self.limits.x>0 then b3[1]=b3[1]:sub(1,self.limits.x-(#by+#br))end;self.lines[self.cursor.pos.y]=by..b3[1]..br;self:set_cursor(self.cursor.pos.x+#b3[1],self.cursor.pos.y)end end,print=function(self,...)local av=j.join({...},"\n").."\n"self:write(av)end,clear=function(self)self.lines={""}self:set_cursor(1,1)end},Window={new=function(B,C,a6,a7,ah,bA)local bB={draw_priority=b.HIGH_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a6,a7),drag_options={enabled=true,from=A.Vector2.new(1,1)},shadow={enabled=bA,offset=A.Vector2.new(1,1)},elements={},colors={background=ah,shadow=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end}}setmetatable(bB,a_.Window)return bB end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.shadow.enabled then al:rectangle(self.pos.x+self.shadow.offset.x,self.pos.y+self.shadow.offset.y,self.size.x,self.size.y,self.colors.shadow)end;al:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)self:draw_elements()end,event=function(self,aS)if self.hidden then return false end;local bC=self:event_elements(aS)if not bC then if aS.name==b.TOUCH then if a3.is_area_pressed(aS.x,aS.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.drag_options.from=A.Vector2.new(aS.x,aS.y)self.focussed=true;self.callbacks.onPress(self,aS)self.callbacks.onFocus(self,aS)return true else self.focussed=false;self.callbacks.onFailedPress(self,aS)self.callbacks.onFocus(self,aS)end elseif aS.name==b.MOUSEDRAG and self.focussed then self:drag(aS.x,aS.y)return true elseif aS.name==b.DELETED then self.focussed=false;self.callbacks.onFocus(self,aS)end else self.focussed=false;self.callbacks.onFocus(self,aS)end;return bC end,drag=function(self,B,C)if self.drag_options.enabled then local bD=A.Vector2.new(B-self.drag_options.from.x,C-self.drag_options.from.y)self.pos=self.pos+bD;for d,bE in pairs(self.elements)do if bE.pos then bE.pos=bE.pos+bD end end;self.drag_options.from=A.Vector2.new(B,C)end end,set_elements=function(self,bF,bG)self.elements={}for d,bE in pairs(bF)do if bG then bE.pos=self.pos+bE.pos-A.Vector2.ONE end;table.insert(self.elements,bE)end end,draw_elements=function(self)for d=#self.elements,1,-1 do local bE=self.elements[d]if bE.draw then bE:draw()end end end,event_elements=function(self,aS)local bC=false;for d,bE in pairs(self.elements)do if bE.event then local bH=bE:event(aS)bC=bC or bH;if bH then aS={name=b.DELETED}end end end;return bC end}}a_.Clock.__index=a_.Clock;a_.Label.__index=a_.Label;a_.Button.__index=a_.Button;a_.Progressbar.__index=a_.Progressbar;a_.Memo.__index=a_.Memo;a_.Window.__index=a_.Window;local bI={}bI={new=function(bJ,bK)local bL={options={enabled=false,FPS_target=bJ,EPS_target=bK},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=a_.Clock.new(1/bJ),stats_clock=a_.Clock.new(1),FPS_label=a_.Label.new(1,1,"1 FPS",colors.white),EPS_label=a_.Label.new(1,2,"1 EPS",colors.white)}},stats={pos=A.Vector2.new(1,1),elements=nil,enabled=true,enable=function(self,bM)self.enabled=bM;self.elements.stats_clock.enabled=bM;self.elements.FPS_label.hidden=not bM;self.elements.EPS_label.hidden=not bM end,update_pos=function(self)self.elements.FPS_label.pos=self.pos;self.elements.EPS_label.pos=self.pos+A.Vector2.DOWN end,FPS=0,EPS=0},callbacks={onStart=function()end,onStop=function()end,onDraw=function()end,onClock=function()end,onEvent=function()end}}bL.elements.loop.stats_clock.stats=bL.stats;bL.stats.elements=bL.elements.loop;e.set_callback(bL.elements.loop.stats_clock,b.ONCLOCK,function(self,aS)self.stats:update_pos()self.stats.elements.FPS_label.text=tostring(self.stats.FPS).." FPS"self.stats.elements.EPS_label.text=tostring(self.stats.EPS).." EPS"self.stats.FPS=0;self.stats.EPS=0 end)bL.stats:enable(false)setmetatable(bL,bI)return bL end,set_monitors=function(self,ac)self.monitors=ab.get_monitors(ac)end,set_elements=function(self,bF)self.elements.high_priority={}self.elements.low_priority={}for d,n in pairs(bF)do if n.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,n)else table.insert(self.elements.low_priority,n)end end end,draw_elements=function(self)local function bN(k)for d=#k,1,-1 do local bE=k[d]if bE.draw then bE:draw()end end end;self.callbacks.onDraw(self)local bO=al.screens;al.screens=self.monitors;bN(self.elements.low_priority)bN(self.elements.high_priority)for d,bE in pairs(self.elements.loop)do if bE.draw then bE:draw()end end;al:draw()al.screens=bO;if self.stats.enabled then self.stats.FPS=self.stats.FPS+1 end end,event_elements=function(self,aS)local function a8(k)for d,bE in pairs(k)do if bE.event then if bE:event(aS)then aS={name=b.DELETED}end end end end;if self.callbacks.onEvent(self,aS)then aS={name=b.DELETED}end;if aS.name==b.TOUCH then local bP=false;for bQ,af in pairs(self.monitors)do if aS.from==bQ then bP=true;break end end;if not bP then aS={name=b.DELETED}end end;a8(self.elements.loop)local bR={}for d,bE in pairs(self.elements.high_priority)do if bE.event then local bS=bE:event(aS)if bS then aS={name=b.DELETED}if self.elements.high_priority~=bE then table.insert(bR,{element=bE,key=d})end end end end;if#bR>0 then for d,n in pairs(bR)do table.insert(self.elements.high_priority,1,n.element)table.remove(self.elements.high_priority,n.key+#bR)end end;a8(self.elements.low_priority)if self.stats.enabled then self.stats.EPS=self.stats.EPS+1 end end,start=function(self)self.enabled=true;aO:reset()e.set_callback(self.elements.loop.clock,b.ONCLOCK,function(bT,aS)self.callbacks.onClock(self,aS)self:draw_elements()bT.interval=1/self.options.FPS_target end)self.stats:update_pos()self.callbacks.onStart(self)while self.enabled do local bU=os.startTimer(1/self.options.EPS_target)local bV={os.pullEvent()}local aS=a3.format_event_table(bV)aO:manage_event(aS)self:event_elements(aS)os.cancelTimer(bU)end;aO:reset()self.callbacks.onStop(self)end,stop=function(self)self.enabled=false end}bI.__index=bI;local bW={...}if bW[1]=="help"then local b3={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil},{text=" - create <PATH> (creates a new YAGUI project)",foreground=colors.green,background=nil}}for d,b4 in pairs(b3)do ab.better_print(term,b4.foreground,b4.background,b4.text)end elseif bW[1]=="info"then ab.better_print(term,colors.red,nil,"Library Version: ",a.ver)ab.better_print(term,colors.yellow,nil,"Library Author: ",a.author)ab.better_print(term,colors.green,nil,"Library Website: ",a.website)ab.better_print(term,colors.blue,nil,"Library Documentation: ",a.documentation)elseif bW[1]=="ver"then ab.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif bW[1]=="copyright"then local bX={colors.red,colors.yellow,colors.green}local bY=j.split(a.copyright,"\n\n")for d,bZ in pairs(bY)do ab.better_print(term,bX[d],nil,bZ)if d<#bY then read("")end end elseif bW[1]=="setup"then if shell then local b_="YAGUI_PATH"local x="/"..shell.getRunningProgram()a9:set(b_,x)ab.better_print(term,colors.green,nil,"Lib path was set to \"",a9.get(b_),"\".")else ab.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE!")end elseif bW[1]=="create"then if bW[2]then local x=shell.resolve(bW[2])local aa=fs.getName(x):lower()if j.get_extension(x)~="lua"then x=x..".lua"end;if fs.exists(x)then ab.better_print(term,colors.red,nil,"PATH: \"/",x,"\" already exists, please use another path or delete it.")else local c0=fs.open(x,"w")c0.write("\n-- AUTO-GENERATED with \"YAGUI create\"\nlocal YAGUI_PATH = settings.get(\"YAGUI_PATH\")\nif not (type(YAGUI_PATH) == \"string\") then printError(\"YAGUI is not installed, please install it by opening it with argument \\\"setup\\\".\"); return; end\nif not fs.exists(YAGUI_PATH) then printError(\"Couldn't find YAGUI in path: \\\"\"..YAGUI_PATH..\"\\\", Please reinstall it by opening it with argument \\\"setup\\\".\"); return; end\nlocal YAGUI = dofile(YAGUI_PATH)\n-- End of AUTO-GENERATED code\n\n")c0.close()ab.better_print(term,colors.green,nil,"New project was created at \"/",x,"\".")end else ab.better_print(term,colors.red,nil,"You must specify a path to create a new project.")end elseif bW[1]then ab.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",bW[1],"\"")ab.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local c1={info=a,generic_utils=e,string_utils=j,math_utils=A,table_utils=X,color_utils=_,event_utils=a3,setting_utils=a9,monitor_utils=ab,screen_buffer=al,input=aO,WSS=aT,wireless_screen_share=aT,gui_elements=a_,Loop=bI}for d,n in pairs(b)do c1[d]=n end;return c1