--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.14",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI/",documentation="https://yagui.readthedocs.io/en/latest/",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",MOUSEDRAG="mouse_drag",MOUSESCROLL="mouse_scroll",CHAR="char",KEY="key",KEYUP="key_up",PASTE="paste",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONSTART=1,ONSTOP=2,ONDRAW=3,ONPRESS=4,ONFAILEDPRESS=5,ONTIMEOUT=6,ONCLOCK=7,ONEVENT=8,ONFOCUS=9,ONKEY=10,ONCHAR=11,MOUSE_LEFT=1,MOUSE_RIGHT=2,MOUSE_MIDDLE=3,SCROLL_UP=-1,SCROLL_DOWN=1,COMPUTER="computer",TURTLE="turtle",POCKET="pocket",ALIGN_LEFT=1,ALIGN_CENTER=2}for c,d in next,keys do if type(d)=="number"then b["KEY_"..c:upper()]=d end end;local e={set_callback=function(f,g,h)if g==b.ONSTART then f.callbacks.onStart=h elseif g==b.ONSTOP then f.callbacks.onStop=h elseif g==b.ONDRAW then f.callbacks.onDraw=h elseif g==b.ONPRESS then f.callbacks.onPress=h elseif g==b.ONFAILEDPRESS then f.callbacks.onFailedPress=h elseif g==b.ONTIMEOUT then f.callbacks.onTimeout=h elseif g==b.ONCLOCK then f.callbacks.onClock=h elseif g==b.ONEVENT then f.callbacks.onEvent=h elseif g==b.ONFOCUS then f.callbacks.onFocus=h elseif g==b.ONKEY then f.callbacks.onKey=h elseif g==b.ONCHAR then f.callbacks.onChar=h end end,get_computer_type=function()local i=b.COMPUTER;if turtle then i=b.TURTLE elseif pocket then i=b.POCKET end;return i,term.isColor()end}local j={}j={magic_characters={"(",")",".","%","+","-","*","?","[","]","^","$"},join=function(k,l)if not l then l=""end;local m=""for d=1,#k do local n=k[d]m=m..tostring(n)if d<#k then m=m..l end end;return m end,split=function(m,l)local k={}if not(#l>0)then return k end;while true do local o=m:find(l)if o then table.insert(k,m:sub(1,o-1))m=m:sub(o+1)else table.insert(k,m)break end end;return k end,compare_versions=function(p,q)local r=j.split(p,".")local s=j.split(q,".")local t=#r;local u=#s;for v=1,math.min(t,u)do if tonumber(r[v])>tonumber(s[v])then return 1 elseif tonumber(r[v])<tonumber(s[v])then return-1 end end;if t>u then return 1 elseif t<u then return-1 end;return 0 end,escape_magic_characters=function(m)for d,w in next,j.magic_characters do m=m:gsub("[%"..w.."]",'%%%'..w)end;return m end,get_extension=function(x)local y,z=x:gsub(".*%.","")if z>0 then return y end;return""end}local A={}A={Vector2={new=function(B,C)local D={x=B or 0,y=C or 0}setmetatable(D,A.Vector2)return D end,duplicate=function(self)return A.Vector2.new(self.x,self.y)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y end,cross=function(self,E)return self.x*E.y-self.y*E.x end,rotate=function(self,F)local G=math.cos(F)local H=math.sin(F)return A.Vector2.new(G*self.x-H*self.y,H*self.x+G*self.y)end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y)else return string.format("(%f; %f)",self.x,self.y)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector2.new(self.x+E.x,self.y+E.y)end,__sub=function(self,E)return A.Vector2.new(self.x-E.x,self.y-E.y)end,__mul=function(self,J)if type(self)=="number"then return A.Vector2.new(J.x*self,J.y*self)else return A.Vector2.new(self.x*J,self.y*J)end end,__div=function(self,J)return A.Vector2.new(self.x/J,self.y/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},Vector3={new=function(B,C,K)local L={x=B or 0,y=C or 0,z=K or 0}setmetatable(L,A.Vector3)return L end,duplicate=function(self)return A.Vector3.new(self.x,self.y,self.z)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)+math.pow(self.z,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y+self.z*E.z end,cross=function(self,E)return A.Vector3.new(self.y*E.z-self.z*E.y,self.z*E.x-self.x*E.z,self.x*E.y-self.y*E.x)end,rotate=function(self,M,F)local G=math.cos(F)return G*self+math.sin(F)*M:cross(self)+(1-G)*M:dot(self)*M end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y,self.z)else return string.format("(%f; %f; %f)",self.x,self.y,self.z)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector3.new(self.x+E.x,self.y+E.y,self.z+E.z)end,__sub=function(self,E)return A.Vector3.new(self.x-E.x,self.y-E.y,self.z-E.z)end,__mul=function(self,J)if type(self)=="number"then return A.Vector3.new(J.x*self,J.y*self,J.z*self)else return A.Vector3.new(self.x*J,self.y*J,self.z*J)end end,__div=function(self,J)return A.Vector3.new(self.x/J,self.y/J,self.z/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},map=function(n,N,O,P,Q,R)local S=(n-N)/(O-N)*(Q-P)+P;if R then return A.constrain(S,P,Q)end;return S end,constrain=function(n,T,U)return math.min(U,math.max(T,n))end,round=function(J)return math.floor(J+0.5)end,round_numbers=function(...)local V={...}local W={}for d,J in next,V do table.insert(W,A.round(J))end;return table.unpack(W)end,floor_numbers=function(...)local V={...}local X={}for d,J in next,V do table.insert(X,math.floor(J))end;return table.unpack(X)end,ceil_numbers=function(...)local V={...}local Y={}for d,J in next,V do table.insert(Y,math.ceil(J))end;return table.unpack(Y)end}A.Vector2.__index=A.Vector2;A.Vector3.__index=A.Vector3;A.Vector2.ONE=A.Vector2.new(1,1)A.Vector2.UP=A.Vector2.new(0,-1)A.Vector2.DOWN=A.Vector2.new(0,1)A.Vector2.LEFT=A.Vector2.new(-1,0)A.Vector2.RIGHT=A.Vector2.new(1,0)A.Vector2.ZERO=A.Vector2.new(0,0)A.Vector3.ONE=A.Vector3.new(1,1,1)A.Vector3.UP=A.Vector3.new(0,1,0)A.Vector3.DOWN=A.Vector3.new(0,-1,0)A.Vector3.LEFT=A.Vector3.new(-1,0,0)A.Vector3.RIGHT=A.Vector3.new(1,0,0)A.Vector3.FORWARD=A.Vector3.new(0,0,1)A.Vector3.BACK=A.Vector3.new(0,0,-1)A.Vector3.ZERO=A.Vector3.new(0,0,0)local Z={has_value=function(k,n)for _,a0 in next,k do if a0==n then return true,_ end end;return false,nil end,has_key=function(k,d)if k[d]~=nil then return true,k[d]end;return false,nil end}local a1={}a1={colors={[1]="0",[2]="1",[4]="2",[8]="3",[16]="4",[32]="5",[64]="6",[128]="7",[256]="8",[512]="9",[1024]="a",[2048]="b",[4096]="c",[8192]="d",[16384]="e",[32768]="f"},color_to_paint=function(a2)return a1.colors[a2]end,paint_to_color=function(a3)local a4,a2=Z.has_value(a1.colors,a3)if a4 then return a2 end end}local a5={is_area_pressed=function(a6,a7,B,C,a8,a9)if a6>=B and a6<B+a8 then if a7>=C and a7<C+a9 then return true end end;return false end,format_event_table=function(aa)local g={}g.name=aa[1]if g.name=="mouse_click"then g.name=b.TOUCH;g.from="terminal"g.button=aa[2]g.x=aa[3]g.y=aa[4]return g elseif g.name=="monitor_touch"then g.name=b.TOUCH;g.from=aa[2]g.button=1;g.x=aa[3]g.y=aa[4]return g elseif g.name=="mouse_drag"then g.name=b.MOUSEDRAG;g.button=aa[2]g.x=aa[3]g.y=aa[4]return g elseif g.name=="mouse_up"then g.name=b.MOUSEUP;g.button=aa[2]g.x=aa[3]g.y=aa[4]return g elseif g.name=="mouse_scroll"then g.name=b.MOUSESCROLL;g.direction=aa[2]g.x=aa[3]g.y=aa[4]return g elseif g.name=="char"then g.name=b.CHAR;g.char=aa[2]return g elseif g.name=="key"then g.name=b.KEY;g.key=aa[2]return g elseif g.name=="key_up"then g.name=b.KEYUP;g.key=aa[2]return g elseif g.name=="paste"then g.name=b.PASTE;g.paste=aa[2]return g end;table.remove(aa,1)g.parameters=aa;return g end}local ab={}ab={_path="/.settings",set=function(ac,n)settings.set(ac,n)settings.save(ab._path)end,unset=function(ac)settings.unset(ac)settings.save(ab._path)end,get=function(ac)return settings.get(ac)end}local ad={get_monitors=function(ae)local af={}for d,ag in next,ae do if ag=="terminal"then af[ag]=term else if peripheral.getType(ag)=="monitor"then af[ag]=peripheral.wrap(ag)end end end;return af end,better_print=function(ah,ai,aj,...)local ak=j.join({...},"")local al=ah.getTextColor()local am=ah.getBackgroundColor()if ai then ah.setTextColor(ai)end;if aj then ah.setBackgroundColor(aj)end;print(ak)ah.setTextColor(al)ah.setBackgroundColor(am)end,better_clear=function(ah)ah.clear()ah.setCursorPos(1,1)end}local an={frame={pixels={},background=nil},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,B,C)B=tostring(B)C=tostring(C)if self.pixels[B]then if self.pixels[B][C]then return true end end;return false end,get_pixel=function(self,B,C)B=tostring(B)C=tostring(C)if self:is_pixel_custom(B,C)then return self.pixels[B][C]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,B,C,char,ai,aj)B=tostring(B)C=tostring(C)local ao=self:get_pixel(B,C)if char and#char==1 then ao.char=char end;ao.foreground=ai or ao.background;ao.background=aj or ao.background;if not self.pixels[B]then self.pixels[B]={}end;self.pixels[B][C]=ao end,clear=function(self)self.pixels={}end},set_screens=function(self,ap)self.screens=ad.get_monitors(ap)end,set_monitors=function(self,ae)self:set_screens(ae)end,clear=function(self)self.buffer:clear()end,draw=function(self)local aq=self.screens;local ar=self.buffer;for as,at in next,aq do local au,av=at.getCursorPos()local a8,a9=at.getSize()for C=1,a9 do local aw={text="",background="",foreground=""}for B=1,a8 do local ao=ar:get_pixel(B,C)aw.text=aw.text..ao.char;aw.background=aw.background..a1.colors[ao.background]aw.foreground=aw.foreground..a1.colors[ao.foreground]end;at.setCursorPos(1,C)at.blit(aw.text,aw.foreground,aw.background)end;at.setCursorPos(au,av)end;self.frame.pixels=self.buffer.pixels;self.frame.background=self.buffer.background;if self.clear_after_draw then self:clear()end end,point=function(self,B,C,a2)self.buffer:set_pixel(B,C," ",a2,a2)end,write=function(self,B,C,ax,ai,aj)for ay=0,#ax-1 do char=ax:sub(ay+1,ay+1)self.buffer:set_pixel(B+ay,C,char,ai,aj)end end,rectangle=function(self,B,C,a8,a9,a2)for ay=0,a8-1 do for az=0,a9-1 do self:point(B+ay,C+az,a2)end end end,line=function(self,aA,aB,aC,aD,a2)local function aE(aA,aB,aC,aD)local aF=1;if aA>aC then aF=-1 end;local aG=aC-aA;local aH=aD-aB;local aI=1;if aH<0 then aI=-1;aH=-aH end;local aJ=2*aH-aG;local C=aB;for B=aA,aC,aF do self:point(B,C,a2)if aJ>0 then C=C+aI;aJ=aJ-2*aG end;aJ=aJ+2*aH end end;local function aK(aA,aB,aC,aD)local aF=1;if aB>aD then aF=-1 end;local aG=aC-aA;local aH=aD-aB;local aL=1;if aG<0 then aL=-1;aG=-aG end;local aJ=2*aG-aH;local B=aA;for C=aB,aD,aF do self:point(B,C,a2)if aJ>0 then B=B+aL;aJ=aJ-2*aH end;aJ=aJ+2*aG end end;if math.abs(aD-aB)<math.abs(aC-aA)then if aA>aC then aE(aC,aD,aA,aB)else aE(aA,aB,aC,aD)end else if aB>aD then aK(aC,aD,aA,aB)else aK(aA,aB,aC,aD)end end end,circle=function(self,aM,aN,aO,a2)local aP=aO*aO;self:point(aM,aN+aO,a2)self:point(aM,aN-aO,a2)self:point(aM+aO,aN,a2)self:point(aM-aO,aN,a2)local B=1;local C=math.floor(math.sqrt(aP-1)+0.5)while B<C do self:point(aM+B,aN+C,a2)self:point(aM+B,aN-C,a2)self:point(aM-B,aN+C,a2)self:point(aM-B,aN-C,a2)self:point(aM+C,aN+B,a2)self:point(aM+C,aN-B,a2)self:point(aM-C,aN+B,a2)self:point(aM-C,aN-B,a2)B=B+1;C=math.floor(math.sqrt(aP-B*B)+0.5)end;if B==C then self:point(aM+B,aN+C,a2)self:point(aM+B,aN-C,a2)self:point(aM-B,aN+C,a2)self:point(aM-B,aN-C,a2)end end}local aQ={pressed_keys={},reset=function(self)self.pressed_keys={}end,is_key_pressed=function(self,aR,d)if self.pressed_keys[d]then if aR then self:remove_key(d)end;return true end;return false end,are_keys_pressed=function(self,aS,...)local keys={...}if not(#keys>0)then return false end;for aT,d in next,keys do if not self:is_key_pressed(false,d)then return false end end;if aS then self:remove_keys(table.unpack(keys))end;return true end,add_key=function(self,d)self.pressed_keys[d]=true end,remove_key=function(self,d)self.pressed_keys[d]=nil end,remove_keys=function(self,...)local keys={...}for aT,d in next,keys do self:remove_key(d)end end,manage_event=function(self,aU)if aU.name==b.KEY then self:add_key(aU.key)elseif aU.name==b.KEYUP then self:remove_key(aU.key)end end}local aV={}aV={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,aW)rednet.open(aW)self.side=aW end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,aX)if not aX then aX=os.getComputerID()end;aX=tostring(aX)local aY=self.root.protocol..self.root.host_prefix..aX;if rednet.lookup(aY,aX)then return false,aX end;rednet.host(aY,aX)self.servername=aY;self.hostname=aX;return true,aX end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast(an.frame,self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,aX)aX=tostring(aX)local aY=self.root.protocol..self.root.host_prefix..aX;local aZ=rednet.lookup(aY,aX)if not aZ then return false,aX end;self.servername=aY;self.host_id=aZ;return true,aX end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,a_)if not a_ then a_=self.root.default_timeout end;local b0={rednet.receive(self.servername,a_)}if b0[1]==self.host_id then local ar=b0[2]if not ar then return false end;if ar==b.DISCONNECTED then return ar end;an.buffer.background=ar.background;an.buffer.pixels=ar.pixels;return true end;return false end}}aV.server.root=aV;aV.client.root=aV;local b1={}b1={Clock={new=function(b2)local b3={enabled=true,oneshot=false,clock=os.clock(),interval=b2,callbacks={onClock=function()end}}setmetatable(b3,b1.Clock)return b3 end,event=function(self,aU)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,aU)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(B,C,ax,ai,aj)local b4={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text_alignment=b.ALIGN_CENTER,text=ax,pos=A.Vector2.new(B,C),colors={foreground=ai,background=aj},callbacks={onDraw=function()end}}setmetatable(b4,b1.Label)return b4 end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local b5=j.split(self.text,"\n")if self.text_alignment==b.ALIGN_LEFT then for d,b6 in next,b5 do an:write(self.pos.x,self.pos.y+d-1,b6,self.colors.foreground,self.colors.background)end elseif self.text_alignment==b.ALIGN_CENTER then local b7=0;for d,b6 in next,b5 do if d==1 then b7=math.floor(#b6/2)an:write(self.pos.x,self.pos.y,b6,self.colors.foreground,self.colors.background)else an:write(self.pos.x+b7-math.floor(#b6/2),self.pos.y+d-1,b6,self.colors.foreground,self.colors.background)end end end end},Button={new=function(B,C,a8,a9,ax,ai,b8,b9)local ba={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,shortcut_once=true,shortcut={},text_alignment=b.ALIGN_CENTER,text=ax,pos=A.Vector2.new(B,C),size=A.Vector2.new(a8,a9),timed={enabled=false,clock=b1.Clock.new(0.5)},colors={foreground=ai,active_background=b8,unactive_background=b9},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onTimeout=function()end}}ba.timed.clock.binded_button=ba;ba.timed.clock.oneshot=true;ba.timed.clock:stop()e.set_callback(ba.timed.clock,b.ONCLOCK,function(self,aU)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,aU)self.binded_button.callbacks.onTimeout(self.binded_button,aU)end)setmetatable(ba,b1.Button)return ba end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.active then an:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else an:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local b5=j.split(self.text,"\n")local bb=math.floor((self.size.y-#b5)/2)+self.pos.y;for az=0,#b5-1 do local b6=b5[az+1]local bc;if self.text_alignment==b.ALIGN_LEFT then bc=self.pos.x elseif self.text_alignment==b.ALIGN_CENTER then bc=math.floor((self.size.x-#b6)/2)+self.pos.x end;an:write(bc,bb+az,b6,self.colors.foreground)end end,event=function(self,aU)if self.hidden then return false end;if aU.name==b.TOUCH then if a5.is_area_pressed(aU.x,aU.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self:press(aU)return true else self.callbacks.onFailedPress(self,aU)end elseif aQ:are_keys_pressed(self.shortcut_once,table.unpack(self.shortcut))then self:press(aU)end;if self.timed.enabled then self.timed.clock:event(aU)end end,press=function(self,aU)if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,aU)end else self.active=not self.active;self.callbacks.onPress(self,aU)end end},Progressbar={new=function(B,C,a8,a9,bd,T,U,ai,be,bf)local bg={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a8,a9),value={max=U,min=T,current=bd,draw_percentage=true},colors={foreground=ai,filled_background=be,unfilled_background=bf},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end}}setmetatable(bg,b1.Progressbar)return bg end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bh=A.map(self.value.current,self.value.min,self.value.max,0,1,true)local bi=math.floor(self.size.x*bh)an:rectangle(self.pos.x,self.pos.y,bi,self.size.y,self.colors.filled_background)an:rectangle(self.pos.x+bi,self.pos.y,self.size.x-bi,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local bj=tostring(bh*100).."%"local bk=math.floor((self.size.x-#bj)/2)+self.pos.x;local bb=math.floor((self.size.y-1)/2)+self.pos.y;an:write(bk,bb,bj,self.colors.foreground)end end,event=function(self,aU)if self.hidden then return false end;if aU.name==b.TOUCH then if a5.is_area_pressed(aU.x,aU.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,aU)end end end,set=function(self,n)local bl=A.constrain(n,self.value.min,self.value.max)self.value.current=bl end},Memo={new=function(B,C,a8,a9,ai,aj)local bm={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a8,a9),editable=true,lines={},first_visible_line=1,first_visible_char=1,cursor={visible=false,text=" ",blink=b1.Clock.new(0.5),pos=A.Vector2.new(1,1)},limits=A.Vector2.new(0,0),whitelist={},blacklist={},colors={foreground=ai,background=aj,cursor=colors.white,cursor_text=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end,onKey=function()end,onChar=function()end}}bm.cursor.blink.binded_cursor=bm.cursor;e.set_callback(bm.cursor.blink,b.ONCLOCK,function(self,aU)self.binded_cursor.visible=not self.binded_cursor.visible end)setmetatable(bm,b1.Memo)return bm end,draw=function(self)if self.hidden then return end;an:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)local bn=self.cursor.pos.x-self.first_visible_char;local bo=self.cursor.pos.y-self.first_visible_line;if bn>=self.size.x then self.first_visible_char=self.first_visible_char+bn-self.size.x+1;bn=self.cursor.pos.x-self.first_visible_char-1 elseif bn<1 then self.first_visible_char=self.first_visible_char+bn;bn=0 end;if bo>=self.size.y then self.first_visible_line=self.first_visible_line+bo-self.size.y+1;bo=self.cursor.pos.y-self.first_visible_line-1 elseif bo<1 then self.first_visible_line=self.first_visible_line+bo;bo=0 end;for C=1,self.size.y do local b6=self.lines[C+self.first_visible_line-1]or""local bp=b6:sub(self.first_visible_char,self.first_visible_char+self.size.x-1)an:write(self.pos.x,self.pos.y+C-1,bp,self.colors.foreground)end;if self.cursor.visible then an:write(bn+self.pos.x,bo+self.pos.y,self.cursor.text,self.colors.cursor_text,self.colors.cursor)end end,event=function(self,aU)if self.hidden then return false end;if not self.editable then return false end;if aU.name==b.TOUCH then if a5.is_area_pressed(aU.x,aU.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then local B=aU.x-self.pos.x;local C=aU.y-self.pos.y;self:set_cursor(B+self.first_visible_char,C+self.first_visible_line)self:focus(true,aU)self.callbacks.onPress(self,aU)return true else self:focus(false,aU)self.callbacks.onFailedPress(self,aU)return false end elseif aU.name==b.DELETED then self:focus(false,aU)return false end;if self.focussed then self.cursor.blink:event(self.cursor.blink,aU)if aU.name==b.PASTE then self:write(aU.paste)elseif aU.name==b.CHAR then if self.callbacks.onChar(self,aU)then return true end;self:write(aU.char)elseif aU.name==b.KEY then if self.callbacks.onKey(self,aU)then return true end;if aU.key==b.KEY_UP then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y-1)elseif aU.key==b.KEY_DOWN then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)elseif aU.key==b.KEY_RIGHT then local b6=self.lines[self.cursor.pos.y]if self.lines[self.cursor.pos.y+1]and self.cursor.pos.x>=#b6+1 then self:set_cursor(1,self.cursor.pos.y+1)else self:set_cursor(self.cursor.pos.x+1,self.cursor.pos.y)end elseif aU.key==b.KEY_LEFT then if self.cursor.pos.x<=1 and self.cursor.pos.y>1 then local bq=self.lines[self.cursor.pos.y-1]self:set_cursor(#bq+1,self.cursor.pos.y-1)else self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aU.key==b.KEY_BACKSPACE then local b6=self.lines[self.cursor.pos.y]if self.cursor.pos.x<=1 then if self.cursor.pos.y>1 then table.remove(self.lines,self.cursor.pos.y)local br=#self.lines[self.cursor.pos.y-1]+1;local bs=self.cursor.pos.y-1;self:set_cursor(br,bs)self:write(b6)self:set_cursor(br,bs)end else self.lines[self.cursor.pos.y]=b6:sub(1,self.cursor.pos.x-2)..b6:sub(self.cursor.pos.x)self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif aU.key==b.KEY_DELETE then local b6=self.lines[self.cursor.pos.y]local bt=b6:sub(self.cursor.pos.x)if#bt>0 then self.lines[self.cursor.pos.y]=b6:sub(1,self.cursor.pos.x-1)..b6:sub(self.cursor.pos.x+1)else local bu=self.lines[self.cursor.pos.y+1]if bu then local br=self.cursor.pos.x;local bs=self.cursor.pos.y;table.remove(self.lines,self.cursor.pos.y+1)self:write(bu)self:set_cursor(br,bs)end end elseif aU.key==b.KEY_ENTER then self:write("\n")elseif aU.key==b.KEY_TAB then self:write("  ")end elseif aU.name==b.MOUSESCROLL then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+aU.direction)end;return true end end,focus=function(self,bv,aU)if bv then self.focussed=true;self.callbacks.onFocus(self,aU)else self.focussed=false;self.cursor.visible=false;self.callbacks.onFocus(self,aU)end end,set_cursor=function(self,br,bs,bw)if not self.lines[1]then self.lines[1]=""end;if self.limits.y>0 then bs=A.constrain(bs,1,self.limits.y)end;if bw then for C=#self.lines+1,bs do if not self.lines[C]then self.lines[C]=""end end else bs=A.constrain(bs,1,#self.lines)end;br=A.constrain(br,1,#self.lines[bs]+1)self.cursor.pos=A.Vector2.new(br,bs)end,write=function(self,...)local ax=j.join({...},"")local b5=j.split(ax,"\n")self:set_cursor(self.cursor.pos.x,self.cursor.pos.y,true)if#self.whitelist>0 then local bx="[^"..j.escape_magic_characters(j.join(self.whitelist,"")).."]"for d,b6 in next,b5 do b5[d]=b6:gsub(bx,"")end elseif#self.blacklist>0 then local bx="["..j.escape_magic_characters(j.join(self.blacklist,"")).."]"for d,b6 in next,b5 do b5[d]=b6:gsub(bx,"")end end;if self.limits.y>0 then for C=1,#self.lines+#b5-1-self.limits.y do table.remove(b5)end;if#b5==0 then return end end;if#b5>1 then for by,b6 in next,b5 do if by==1 then local bz=self.lines[self.cursor.pos.y]local bA=bz:sub(1,self.cursor.pos.x-1)local bt=bz:sub(self.cursor.pos.x)local bB=b5[#b5]if self.limits.x>0 then b6=b6:sub(1,self.limits.x-#bA)bB=bB:sub(1,self.limits.x-#bt)end;self.lines[self.cursor.pos.y]=bA..b6;self:set_cursor(1,self.cursor.pos.y+1,true)table.insert(self.lines,self.cursor.pos.y,bB..bt)self:set_cursor(#bB+1,self.cursor.pos.y)elseif by==#b5 then break else if self.limits.x>0 then b6=b6:sub(1,self.limits.x)end;table.insert(self.lines,self.cursor.pos.y,b6)self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)end end else local bz=self.lines[self.cursor.pos.y]local bA=bz:sub(1,self.cursor.pos.x-1)local bt=bz:sub(self.cursor.pos.x)if self.limits.x>0 then b5[1]=b5[1]:sub(1,self.limits.x-(#bA+#bt))end;self.lines[self.cursor.pos.y]=bA..b5[1]..bt;self:set_cursor(self.cursor.pos.x+#b5[1],self.cursor.pos.y)end end,print=function(self,...)local ax=j.join({...},"\n").."\n"self:write(ax)end,clear=function(self)self.lines={""}self:set_cursor(1,1)end},Window={new=function(B,C,a8,a9,aj,bC)local bD={draw_priority=b.HIGH_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(a8,a9),drag_options={enabled=true,from=A.Vector2.new(1,1)},shadow={enabled=bC,offset=A.Vector2.new(1,1)},elements={},colors={background=aj,shadow=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end}}setmetatable(bD,b1.Window)return bD end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.shadow.enabled then an:rectangle(self.pos.x+self.shadow.offset.x,self.pos.y+self.shadow.offset.y,self.size.x,self.size.y,self.colors.shadow)end;an:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)self:draw_elements()end,event=function(self,aU)if self.hidden then return false end;local bE=self:event_elements(aU)if not bE then if aU.name==b.TOUCH then if a5.is_area_pressed(aU.x,aU.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.drag_options.from=A.Vector2.new(aU.x,aU.y)self.focussed=true;self.callbacks.onPress(self,aU)self.callbacks.onFocus(self,aU)return true else self.focussed=false;self.callbacks.onFailedPress(self,aU)self.callbacks.onFocus(self,aU)end elseif aU.name==b.MOUSEDRAG and self.focussed then self:drag(aU.x,aU.y)return true elseif aU.name==b.DELETED then self.focussed=false;self.callbacks.onFocus(self,aU)end else self.focussed=false;self.callbacks.onFocus(self,aU)end;return bE end,drag=function(self,B,C)if self.drag_options.enabled then local bF=A.Vector2.new(B-self.drag_options.from.x,C-self.drag_options.from.y)self.pos=self.pos+bF;for d,bG in next,self.elements do if bG.pos then bG.pos=bG.pos+bF end end;self.drag_options.from=A.Vector2.new(B,C)end end,set_elements=function(self,bH,bI)self.elements={}for d,bG in next,bH do if bI then bG.pos=self.pos+bG.pos-A.Vector2.ONE end;table.insert(self.elements,bG)end end,draw_elements=function(self)for d=#self.elements,1,-1 do local bG=self.elements[d]if bG.draw then bG:draw()end end end,event_elements=function(self,aU)local bE=false;for d,bG in next,self.elements do if bG.event then local bJ=bG:event(aU)bE=bE or bJ;if bJ then aU={name=b.DELETED}end end end;return bE end}}b1.Clock.__index=b1.Clock;b1.Label.__index=b1.Label;b1.Button.__index=b1.Button;b1.Progressbar.__index=b1.Progressbar;b1.Memo.__index=b1.Memo;b1.Window.__index=b1.Window;local bK={}bK={new=function(bL,bM)local bN={options={enabled=false,FPS_target=bL,EPS_target=bM},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=b1.Clock.new(1/bL),stats_clock=b1.Clock.new(1),FPS_label=b1.Label.new(1,1,"1 FPS",colors.white),EPS_label=b1.Label.new(1,2,"1 EPS",colors.white)}},stats={pos=A.Vector2.new(1,1),elements=nil,enabled=true,enable=function(self,bO)self.enabled=bO;self.elements.stats_clock.enabled=bO;self.elements.FPS_label.hidden=not bO;self.elements.EPS_label.hidden=not bO end,update_pos=function(self)self.elements.FPS_label.pos=self.pos;self.elements.EPS_label.pos=self.pos+A.Vector2.DOWN end,FPS=0,EPS=0},callbacks={onStart=function()end,onStop=function()end,onDraw=function()end,onClock=function()end,onEvent=function()end}}bN.elements.loop.stats_clock.stats=bN.stats;bN.stats.elements=bN.elements.loop;e.set_callback(bN.elements.loop.stats_clock,b.ONCLOCK,function(self,aU)self.stats:update_pos()self.stats.elements.FPS_label.text=tostring(self.stats.FPS).." FPS"self.stats.elements.EPS_label.text=tostring(self.stats.EPS).." EPS"self.stats.FPS=0;self.stats.EPS=0 end)bN.stats:enable(false)setmetatable(bN,bK)return bN end,set_monitors=function(self,ae)self.monitors=ad.get_monitors(ae)end,set_elements=function(self,bH)self.elements.high_priority={}self.elements.low_priority={}for d,n in next,bH do if n.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,n)else table.insert(self.elements.low_priority,n)end end end,draw_elements=function(self)local function bP(k)for d=#k,1,-1 do local bG=k[d]if bG.draw then bG:draw()end end end;self.callbacks.onDraw(self)local bQ=an.screens;an.screens=self.monitors;bP(self.elements.low_priority)bP(self.elements.high_priority)for d,bG in next,self.elements.loop do if bG.draw then bG:draw()end end;an:draw()an.screens=bQ;if self.stats.enabled then self.stats.FPS=self.stats.FPS+1 end end,event_elements=function(self,aU)local function aa(k)for d,bG in next,k do if bG.event then if bG:event(aU)then aU={name=b.DELETED}end end end end;if self.callbacks.onEvent(self,aU)then aU={name=b.DELETED}end;if aU.name==b.TOUCH then local bR=false;for bS,ah in next,self.monitors do if aU.from==bS then bR=true;break end end;if not bR then aU={name=b.DELETED}end end;aa(self.elements.loop)local bT={}for d,bG in next,self.elements.high_priority do if bG.event then local bU=bG:event(aU)if bU then aU={name=b.DELETED}if self.elements.high_priority~=bG then table.insert(bT,{element=bG,key=d})end end end end;if#bT>0 then for d,n in next,bT do table.insert(self.elements.high_priority,1,n.element)table.remove(self.elements.high_priority,n.key+#bT)end end;aa(self.elements.low_priority)if self.stats.enabled then self.stats.EPS=self.stats.EPS+1 end end,start=function(self)self.enabled=true;aQ:reset()e.set_callback(self.elements.loop.clock,b.ONCLOCK,function(bV,aU)self.callbacks.onClock(self,aU)self:draw_elements()bV.interval=1/self.options.FPS_target end)self.stats:update_pos()self.callbacks.onStart(self)while self.enabled do local bW=os.startTimer(1/self.options.EPS_target)local bX={os.pullEvent()}local aU=a5.format_event_table(bX)aQ:manage_event(aU)self:event_elements(aU)os.cancelTimer(bW)end;aQ:reset()self.callbacks.onStop(self)end,stop=function(self)self.enabled=false end}bK.__index=bK;local bY={...}if bY[1]=="help"then local b5={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil},{text=" - create <PATH> (creates a new YAGUI project)",foreground=colors.green,background=nil}}for d,b6 in next,b5 do ad.better_print(term,b6.foreground,b6.background,b6.text)end elseif bY[1]=="info"then ad.better_print(term,colors.red,nil,"Library Version: ",a.ver)ad.better_print(term,colors.yellow,nil,"Library Author: ",a.author)ad.better_print(term,colors.green,nil,"Library Website: ",a.website)ad.better_print(term,colors.blue,nil,"Library Documentation: ",a.documentation)elseif bY[1]=="ver"then ad.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif bY[1]=="copyright"then local bZ={colors.red,colors.yellow,colors.green}local b_=j.split(a.copyright,"\n\n")for d,c0 in next,b_ do ad.better_print(term,bZ[d],nil,c0)if d<#b_ then read("")end end elseif bY[1]=="setup"then if shell then local c1="YAGUI_PATH"local x="/"..shell.getRunningProgram()ab.set(c1,x)ad.better_print(term,colors.green,nil,"Lib path was set to \"",ab.get(c1),"\".")else ad.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE!")end elseif bY[1]=="create"then if bY[2]then local x=shell.resolve(bY[2])local ac=fs.getName(x):lower()if j.get_extension(x)~="lua"then x=x..".lua"end;if fs.exists(x)then ad.better_print(term,colors.red,nil,"PATH: \"/",x,"\" already exists, please use another path or delete it.")else local c2=fs.open(x,"w")c2.write("\n-- AUTO-GENERATED with \"YAGUI create\"\nlocal YAGUI_PATH = settings.get(\"YAGUI_PATH\")\nif not (type(YAGUI_PATH) == \"string\") then printError(\"YAGUI is not installed, please install it by opening it with argument \\\"setup\\\".\"); return; end\nif not fs.exists(YAGUI_PATH) then printError(\"Couldn't find YAGUI in path: \\\"\"..YAGUI_PATH..\"\\\", Please reinstall it by opening it with argument \\\"setup\\\".\"); return; end\nlocal YAGUI = dofile(YAGUI_PATH)\n-- End of AUTO-GENERATED code\n\n")c2.close()ad.better_print(term,colors.green,nil,"New project was created at \"/",x,"\".")end else ad.better_print(term,colors.red,nil,"You must specify a path to create a new project.")end elseif bY[1]then ad.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",bY[1],"\"")ad.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local c3={info=a,generic_utils=e,string_utils=j,math_utils=A,table_utils=Z,color_utils=a1,event_utils=a5,setting_utils=ab,monitor_utils=ad,screen_buffer=an,input=aQ,WSS=aV,wireless_screen_share=aV,gui_elements=b1,Loop=bK}for d,n in next,b do c3[d]=n end;return c3