--[[
Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
--]]
local a={ver="1.15",author="hds536jhmk",website="https://github.com/hds536jhmk/YAGUI/",documentation="https://yagui.readthedocs.io/en/latest/",copyright="Copyright (c) 2019, hds536jhmk : https://github.com/hds536jhmk/YAGUI\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted, provided that the above\ncopyright notice and this permission notice appear in all copies.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\nWITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\nMERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\nANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\nWHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\nACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\nOR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."}local b={TOUCH="screen_touch",MOUSEUP="mouse_up",MOUSEDRAG="mouse_drag",MOUSESCROLL="mouse_scroll",CHAR="char",KEY="key",KEYUP="key_up",PASTE="paste",DELETED="DELETED",DISCONNECTED="DISCONNECTED",LOW_PRIORITY=1,HIGH_PRIORITY=2,ONSTART=1,ONSTOP=2,ONDRAW=3,ONPRESS=4,ONFAILEDPRESS=5,ONTIMEOUT=6,ONCLOCK=7,ONEVENT=8,ONFOCUS=9,ONKEY=10,ONCHAR=11,MOUSE_LEFT=1,MOUSE_RIGHT=2,MOUSE_MIDDLE=3,SCROLL_UP=-1,SCROLL_DOWN=1,COMPUTER="computer",TURTLE="turtle",POCKET="pocket",ALIGN_LEFT=1,ALIGN_CENTER=2}for c,d in next,keys do if type(d)=="number"then b["KEY_"..c:upper()]=d end end;local e={set_callback=function(f,g,h)if g==b.ONSTART then f.callbacks.onStart=h elseif g==b.ONSTOP then f.callbacks.onStop=h elseif g==b.ONDRAW then f.callbacks.onDraw=h elseif g==b.ONPRESS then f.callbacks.onPress=h elseif g==b.ONFAILEDPRESS then f.callbacks.onFailedPress=h elseif g==b.ONTIMEOUT then f.callbacks.onTimeout=h elseif g==b.ONCLOCK then f.callbacks.onClock=h elseif g==b.ONEVENT then f.callbacks.onEvent=h elseif g==b.ONFOCUS then f.callbacks.onFocus=h elseif g==b.ONKEY then f.callbacks.onKey=h elseif g==b.ONCHAR then f.callbacks.onChar=h end end,get_computer_type=function()local i=b.COMPUTER;if turtle then i=b.TURTLE elseif pocket then i=b.POCKET end;return i,term.isColor()end}local j={}j={magic_characters={"(",")",".","%","+","-","*","?","[","]","^","$"},join=function(k,l)if not l then l=""end;local m=""for d=1,#k do local n=k[d]m=m..tostring(n)if d<#k then m=m..l end end;return m end,split=function(m,l)local k={}if not(#l>0)then return k end;while true do local o=m:find(l)if o then table.insert(k,m:sub(1,o-1))m=m:sub(o+1)else table.insert(k,m)break end end;return k end,compare_versions=function(p,q)local r=j.split(p,".")local s=j.split(q,".")local t=#r;local u=#s;for v=1,math.min(t,u)do if tonumber(r[v])>tonumber(s[v])then return 1 elseif tonumber(r[v])<tonumber(s[v])then return-1 end end;if t>u then return 1 elseif t<u then return-1 end;return 0 end,escape_magic_characters=function(m)for d,w in next,j.magic_characters do m=m:gsub("[%"..w.."]",'%%%'..w)end;return m end,get_extension=function(x)local y,z=x:gsub(".*%.","")if z>0 then return y end;return""end}local A={}A={Vector2={new=function(B,C)local D={x=B or 0,y=C or 0}setmetatable(D,A.Vector2)return D end,duplicate=function(self)return A.Vector2.new(self.x,self.y)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y end,cross=function(self,E)return self.x*E.y-self.y*E.x end,rotate=function(self,F)local G=math.cos(F)local H=math.sin(F)return A.Vector2.new(G*self.x-H*self.y,H*self.x+G*self.y)end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y)else return string.format("(%f; %f)",self.x,self.y)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector2.new(self.x+E.x,self.y+E.y)end,__sub=function(self,E)return A.Vector2.new(self.x-E.x,self.y-E.y)end,__mul=function(self,J)if type(self)=="number"then return A.Vector2.new(J.x*self,J.y*self)else return A.Vector2.new(self.x*J,self.y*J)end end,__div=function(self,J)return A.Vector2.new(self.x/J,self.y/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},Vector3={new=function(B,C,K)local L={x=B or 0,y=C or 0,z=K or 0}setmetatable(L,A.Vector3)return L end,duplicate=function(self)return A.Vector3.new(self.x,self.y,self.z)end,length_sq=function(self)return math.pow(self.x,2)+math.pow(self.y,2)+math.pow(self.z,2)end,length=function(self)return math.sqrt(self:length_sq())end,unit=function(self)return self/self:length()end,dot=function(self,E)return self.x*E.x+self.y*E.y+self.z*E.z end,cross=function(self,E)return A.Vector3.new(self.y*E.z-self.z*E.y,self.z*E.x-self.x*E.z,self.x*E.y-self.y*E.x)end,rotate=function(self,M,F)local G=math.cos(F)return G*self+math.sin(F)*M:cross(self)+(1-G)*M:dot(self)*M end,string=function(self,I)if I then return string.format("(%."..tostring(I).."f; %."..tostring(I).."f; %."..tostring(I).."f)",self.x,self.y,self.z)else return string.format("(%f; %f; %f)",self.x,self.y,self.z)end end,__tostring=function(self)return self:string(0)end,__add=function(self,E)return A.Vector3.new(self.x+E.x,self.y+E.y,self.z+E.z)end,__sub=function(self,E)return A.Vector3.new(self.x-E.x,self.y-E.y,self.z-E.z)end,__mul=function(self,J)if type(self)=="number"then return A.Vector3.new(J.x*self,J.y*self,J.z*self)else return A.Vector3.new(self.x*J,self.y*J,self.z*J)end end,__div=function(self,J)return A.Vector3.new(self.x/J,self.y/J,self.z/J)end,__eq=function(self,E)return self:length_sq()==E:length_sq()end,__lt=function(self,E)return self:length_sq()<E:length_sq()end,__le=function(self,E)return self:length_sq()<=E:length_sq()end},map=function(n,N,O,P,Q,R)local S=(n-N)/(O-N)*(Q-P)+P;if R then return A.constrain(S,P,Q)end;return S end,constrain=function(n,T,U)return math.min(U,math.max(T,n))end,round=function(J)return math.floor(J+0.5)end,round_numbers=function(...)local V={...}local W={}for d,J in next,V do table.insert(W,A.round(J))end;return table.unpack(W)end,floor_numbers=function(...)local V={...}local X={}for d,J in next,V do table.insert(X,math.floor(J))end;return table.unpack(X)end,ceil_numbers=function(...)local V={...}local Y={}for d,J in next,V do table.insert(Y,math.ceil(J))end;return table.unpack(Y)end}A.Vector2.__index=A.Vector2;A.Vector3.__index=A.Vector3;A.Vector2.ONE=A.Vector2.new(1,1)A.Vector2.UP=A.Vector2.new(0,-1)A.Vector2.DOWN=A.Vector2.new(0,1)A.Vector2.LEFT=A.Vector2.new(-1,0)A.Vector2.RIGHT=A.Vector2.new(1,0)A.Vector2.ZERO=A.Vector2.new(0,0)A.Vector3.ONE=A.Vector3.new(1,1,1)A.Vector3.UP=A.Vector3.new(0,1,0)A.Vector3.DOWN=A.Vector3.new(0,-1,0)A.Vector3.LEFT=A.Vector3.new(-1,0,0)A.Vector3.RIGHT=A.Vector3.new(1,0,0)A.Vector3.FORWARD=A.Vector3.new(0,0,1)A.Vector3.BACK=A.Vector3.new(0,0,-1)A.Vector3.ZERO=A.Vector3.new(0,0,0)local Z={}Z={has_value=function(k,n)for _,a0 in next,k do if a0==n then return true,_ end end;return false,nil end,has_key=function(k,d)if k[d]~=nil then return true,k[d]end;return false,nil end,serialise=function(k,a1,a2,a3,a4,a5)local a1=a1 or 0;local a3=a3 or"  "local a6=0;local a4=a4 or"\n"local a5=a5 or" "if not a2 then a3,a4,a5="","",""end;local function a7(k)local a8=a3:rep(a6+1)local a9="{"..a4;for d,n in next,k do local aa=type(n)local ab=tostring(n)local ac=type(d)local ad;if ac=="string"then ad="\"%s\"":format(d)else ad=tostring(d)end;a9=a9 .."%s[%s]%s=%s":format(a8,ad,a5,a5)if aa=="table"then if a6<a1 then a6=a6+1;a9=a9 ..a7(n)a6=a6-1 else a9=a9 .."{}"end elseif aa=="string"or aa=="function"then a9=a9 .."%q":format(ab)else a9=a9 .."%s":format(ab)end;if next(k,d)then a9=a9 ..","..a4 else a9=a9 ..a4 end end;a9=a9 ..a3:rep(a6).."}"return a9 end;return a7(k)end,unserialise=textutils.unserialise,unserialize=textutils.unserialize}Z.serialize=Z.serialise;local ae={}ae={colors={[1]="0",[2]="1",[4]="2",[8]="3",[16]="4",[32]="5",[64]="6",[128]="7",[256]="8",[512]="9",[1024]="a",[2048]="b",[4096]="c",[8192]="d",[16384]="e",[32768]="f"},color_to_paint=function(af)return ae.colors[af]end,paint_to_color=function(ag)local ah,af=Z.has_value(ae.colors,ag)if ah then return af end end}local ai={is_area_pressed=function(aj,ak,B,C,al,am)if aj>=B and aj<B+al then if ak>=C and ak<C+am then return true end end;return false end,format_event_table=function(an)local g={}g.name=an[1]if g.name=="mouse_click"then g.name=b.TOUCH;g.from="terminal"g.button=an[2]g.x=an[3]g.y=an[4]return g elseif g.name=="monitor_touch"then g.name=b.TOUCH;g.from=an[2]g.button=1;g.x=an[3]g.y=an[4]return g elseif g.name=="mouse_drag"then g.name=b.MOUSEDRAG;g.button=an[2]g.x=an[3]g.y=an[4]return g elseif g.name=="mouse_up"then g.name=b.MOUSEUP;g.button=an[2]g.x=an[3]g.y=an[4]return g elseif g.name=="mouse_scroll"then g.name=b.MOUSESCROLL;g.direction=an[2]g.x=an[3]g.y=an[4]return g elseif g.name=="char"then g.name=b.CHAR;g.char=an[2]return g elseif g.name=="key"then g.name=b.KEY;g.key=an[2]return g elseif g.name=="key_up"then g.name=b.KEYUP;g.key=an[2]return g elseif g.name=="paste"then g.name=b.PASTE;g.paste=an[2]return g end;table.remove(an,1)g.parameters=an;return g end}local ao={}ao={_path="/.settings",set=function(ap,n)settings.set(ap,n)settings.save(ao._path)end,unset=function(ap)settings.unset(ap)settings.save(ao._path)end,get=function(ap)return settings.get(ap)end}local aq={get_monitors=function(ar)local as={}for d,at in next,ar do if at=="terminal"then as[at]=term else if peripheral.getType(at)=="monitor"then as[at]=peripheral.wrap(at)end end end;return as end,better_print=function(au,av,aw,...)local ax=j.join({...},"")local ay=au.getTextColor()local az=au.getBackgroundColor()if av then au.setTextColor(av)end;if aw then au.setBackgroundColor(aw)end;print(ax)au.setTextColor(ay)au.setBackgroundColor(az)end,better_clear=function(au)au.clear()au.setCursorPos(1,1)end}local aA={frame={pixels={},background=nil},screens={terminal=term},clear_after_draw=true,buffer={pixels={},background=colors.black,is_pixel_custom=function(self,B,C)B=tostring(B)C=tostring(C)if self.pixels[B]then if self.pixels[B][C]then return true end end;return false end,get_pixel=function(self,B,C)B=tostring(B)C=tostring(C)if self:is_pixel_custom(B,C)then return self.pixels[B][C]end;return{char=" ",foreground=self.background,background=self.background}end,set_pixel=function(self,B,C,char,av,aw)B=tostring(B)C=tostring(C)local aB=self:get_pixel(B,C)if char and#char==1 then aB.char=char end;aB.foreground=av or aB.background;aB.background=aw or aB.background;if not self.pixels[B]then self.pixels[B]={}end;self.pixels[B][C]=aB end,clear=function(self)self.pixels={}end},set_screens=function(self,aC)self.screens=aq.get_monitors(aC)end,set_monitors=function(self,ar)self:set_screens(ar)end,clear=function(self)self.buffer:clear()end,draw=function(self)local aD=self.screens;local aE=self.buffer;for aF,aG in next,aD do local aH,aI=aG.getCursorPos()local al,am=aG.getSize()for C=1,am do local aJ={text="",background="",foreground=""}for B=1,al do local aB=aE:get_pixel(B,C)aJ.text=aJ.text..aB.char;aJ.background=aJ.background..ae.colors[aB.background]aJ.foreground=aJ.foreground..ae.colors[aB.foreground]end;aG.setCursorPos(1,C)aG.blit(aJ.text,aJ.foreground,aJ.background)end;aG.setCursorPos(aH,aI)end;self.frame.pixels=self.buffer.pixels;self.frame.background=self.buffer.background;if self.clear_after_draw then self:clear()end end,point=function(self,B,C,af)self.buffer:set_pixel(B,C," ",af,af)end,write=function(self,B,C,aK,av,aw)for aL=0,#aK-1 do char=aK:sub(aL+1,aL+1)self.buffer:set_pixel(B+aL,C,char,av,aw)end end,rectangle=function(self,B,C,al,am,af)for aL=0,al-1 do for aM=0,am-1 do self:point(B+aL,C+aM,af)end end end,line=function(self,aN,aO,aP,aQ,af)local function aR(aN,aO,aP,aQ)local aS=1;if aN>aP then aS=-1 end;local aT=aP-aN;local aU=aQ-aO;local aV=1;if aU<0 then aV=-1;aU=-aU end;local aW=2*aU-aT;local C=aO;for B=aN,aP,aS do self:point(B,C,af)if aW>0 then C=C+aV;aW=aW-2*aT end;aW=aW+2*aU end end;local function aX(aN,aO,aP,aQ)local aS=1;if aO>aQ then aS=-1 end;local aT=aP-aN;local aU=aQ-aO;local aY=1;if aT<0 then aY=-1;aT=-aT end;local aW=2*aT-aU;local B=aN;for C=aO,aQ,aS do self:point(B,C,af)if aW>0 then B=B+aY;aW=aW-2*aU end;aW=aW+2*aT end end;if math.abs(aQ-aO)<math.abs(aP-aN)then if aN>aP then aR(aP,aQ,aN,aO)else aR(aN,aO,aP,aQ)end else if aO>aQ then aX(aP,aQ,aN,aO)else aX(aN,aO,aP,aQ)end end end,circle=function(self,aZ,a_,b0,af)local b1=b0*b0;self:point(aZ,a_+b0,af)self:point(aZ,a_-b0,af)self:point(aZ+b0,a_,af)self:point(aZ-b0,a_,af)local B=1;local C=math.floor(math.sqrt(b1-1)+0.5)while B<C do self:point(aZ+B,a_+C,af)self:point(aZ+B,a_-C,af)self:point(aZ-B,a_+C,af)self:point(aZ-B,a_-C,af)self:point(aZ+C,a_+B,af)self:point(aZ+C,a_-B,af)self:point(aZ-C,a_+B,af)self:point(aZ-C,a_-B,af)B=B+1;C=math.floor(math.sqrt(b1-B*B)+0.5)end;if B==C then self:point(aZ+B,a_+C,af)self:point(aZ+B,a_-C,af)self:point(aZ-B,a_+C,af)self:point(aZ-B,a_-C,af)end end}local b2={pressed_keys={},reset=function(self)self.pressed_keys={}end,is_key_pressed=function(self,b3,d)if self.pressed_keys[d]then if b3 then self:remove_key(d)end;return true end;return false end,are_keys_pressed=function(self,b4,...)local keys={...}if not(#keys>0)then return false end;for b5,d in next,keys do if not self:is_key_pressed(false,d)then return false end end;if b4 then self:remove_keys(table.unpack(keys))end;return true end,add_key=function(self,d)self.pressed_keys[d]=true end,remove_key=function(self,d)self.pressed_keys[d]=nil end,remove_keys=function(self,...)local keys={...}for b5,d in next,keys do self:remove_key(d)end end,manage_event=function(self,b6)if b6.name==b.KEY then self:add_key(b6.key)elseif b6.name==b.KEYUP then self:remove_key(b6.key)end end}local b7={}b7={side=nil,protocol="YAGUI-"..a.ver.."_WSS",host_prefix="_Host:",default_timeout=0.5,open=function(self,b8)rednet.open(b8)self.side=b8 end,close=function(self)rednet.close(self.side)self.side=nil end,server={root={},servername=nil,hostname=nil,host=function(self,b9)if not b9 then b9=os.getComputerID()end;b9=tostring(b9)local ba=self.root.protocol..self.root.host_prefix..b9;if rednet.lookup(ba,b9)then return false,b9 end;rednet.host(ba,b9)self.servername=ba;self.hostname=b9;return true,b9 end,unhost=function(self)rednet.broadcast(b.DISCONNECTED,self.servername)rednet.unhost(self.servername,self.hostname)self.servername=nil;self.hostname=nil end,broadcast=function(self)rednet.broadcast(aA.frame,self.servername)end},client={root={},servername=nil,host_id=nil,connect=function(self,b9)b9=tostring(b9)local ba=self.root.protocol..self.root.host_prefix..b9;local bb=rednet.lookup(ba,b9)if not bb then return false,b9 end;self.servername=ba;self.host_id=bb;return true,b9 end,disconnect=function(self)self.servername=nil;self.host_id=nil end,listen=function(self,bc)if not bc then bc=self.root.default_timeout end;local bd={rednet.receive(self.servername,bc)}if bd[1]==self.host_id then local aE=bd[2]if not aE then return false end;if aE==b.DISCONNECTED then return aE end;aA.buffer.background=aE.background;aA.buffer.pixels=aE.pixels;return true end;return false end}}b7.server.root=b7;b7.client.root=b7;local be={}be={Clock={new=function(bf)local bg={enabled=true,oneshot=false,clock=os.clock(),interval=bf,callbacks={onClock=function()end}}setmetatable(bg,be.Clock)return bg end,event=function(self,b6)if not self.enabled then self:reset_timer()return end;if os.clock()>=self.clock+self.interval then self:reset_timer()self.callbacks.onClock(self,b6)if self.oneshot then self:stop()end end end,start=function(self)self:reset_timer()self.enabled=true end,stop=function(self)self.enabled=false end,reset_timer=function(self)self.clock=os.clock()end},Label={new=function(B,C,aK,av,aw)local bh={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,text_alignment=b.ALIGN_CENTER,text=aK,pos=A.Vector2.new(B,C),colors={foreground=av,background=aw},callbacks={onDraw=function()end}}setmetatable(bh,be.Label)return bh end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bi=j.split(self.text,"\n")if self.text_alignment==b.ALIGN_LEFT then for d,bj in next,bi do aA:write(self.pos.x,self.pos.y+d-1,bj,self.colors.foreground,self.colors.background)end elseif self.text_alignment==b.ALIGN_CENTER then local bk=0;for d,bj in next,bi do if d==1 then bk=math.floor(#bj/2)aA:write(self.pos.x,self.pos.y,bj,self.colors.foreground,self.colors.background)else aA:write(self.pos.x+bk-math.floor(#bj/2),self.pos.y+d-1,bj,self.colors.foreground,self.colors.background)end end end end},Button={new=function(B,C,al,am,aK,av,bl,bm)local bn={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,shortcut_once=true,shortcut={},text_alignment=b.ALIGN_CENTER,text=aK,pos=A.Vector2.new(B,C),size=A.Vector2.new(al,am),timed={enabled=false,clock=be.Clock.new(0.5)},colors={foreground=av,active_background=bl,unactive_background=bm},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onTimeout=function()end}}bn.timed.clock.binded_button=bn;bn.timed.clock.oneshot=true;bn.timed.clock:stop()e.set_callback(bn.timed.clock,b.ONCLOCK,function(self,b6)self.binded_button.active=false;self.binded_button.callbacks.onPress(self.binded_button,b6)self.binded_button.callbacks.onTimeout(self.binded_button,b6)end)setmetatable(bn,be.Button)return bn end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.active then aA:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.active_background)else aA:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.unactive_background)end;local bi=j.split(self.text,"\n")local bo=math.floor((self.size.y-#bi)/2)+self.pos.y;for aM=0,#bi-1 do local bj=bi[aM+1]local bp;if self.text_alignment==b.ALIGN_LEFT then bp=self.pos.x elseif self.text_alignment==b.ALIGN_CENTER then bp=math.floor((self.size.x-#bj)/2)+self.pos.x end;aA:write(bp,bo+aM,bj,self.colors.foreground)end end,event=function(self,b6)if self.hidden then return false end;if b6.name==b.TOUCH then if ai.is_area_pressed(b6.x,b6.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self:press(b6)return true else self.callbacks.onFailedPress(self,b6)end elseif b2:are_keys_pressed(self.shortcut_once,table.unpack(self.shortcut))then self:press(b6)end;if self.timed.enabled then self.timed.clock:event(b6)end end,press=function(self,b6)if self.timed.enabled then self.timed.clock:start()if not self.active then self.active=true;self.callbacks.onPress(self,b6)end else self.active=not self.active;self.callbacks.onPress(self,b6)end end},Progressbar={new=function(B,C,al,am,bq,T,U,av,br,bs)local bt={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,active=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(al,am),value={max=U,min=T,current=bq,draw_percentage=true},colors={foreground=av,filled_background=br,unfilled_background=bs},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end}}setmetatable(bt,be.Progressbar)return bt end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)local bu=A.map(self.value.current,self.value.min,self.value.max,0,1,true)local bv=math.floor(self.size.x*bu)aA:rectangle(self.pos.x,self.pos.y,bv,self.size.y,self.colors.filled_background)aA:rectangle(self.pos.x+bv,self.pos.y,self.size.x-bv,self.size.y,self.colors.unfilled_background)if self.value.draw_percentage then local bw=tostring(bu*100).."%"local bx=math.floor((self.size.x-#bw)/2)+self.pos.x;local bo=math.floor((self.size.y-1)/2)+self.pos.y;aA:write(bx,bo,bw,self.colors.foreground)end end,event=function(self,b6)if self.hidden then return false end;if b6.name==b.TOUCH then if ai.is_area_pressed(b6.x,b6.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.callbacks.onPress(self,b6)end end end,set=function(self,n)local by=A.constrain(n,self.value.min,self.value.max)self.value.current=by end},Memo={new=function(B,C,al,am,av,aw)local bz={draw_priority=b.LOW_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(al,am),editable=true,lines={},first_visible_line=1,first_visible_char=1,cursor={visible=false,text=" ",blink=be.Clock.new(0.5),pos=A.Vector2.new(1,1)},limits=A.Vector2.new(0,0),whitelist={},blacklist={},colors={foreground=av,background=aw,cursor=colors.white,cursor_text=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end,onKey=function()end,onChar=function()end}}bz.cursor.blink.binded_cursor=bz.cursor;e.set_callback(bz.cursor.blink,b.ONCLOCK,function(self,b6)self.binded_cursor.visible=not self.binded_cursor.visible end)setmetatable(bz,be.Memo)return bz end,draw=function(self)if self.hidden then return end;aA:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)local bA=self.cursor.pos.x-self.first_visible_char;local bB=self.cursor.pos.y-self.first_visible_line;if bA>=self.size.x then self.first_visible_char=self.first_visible_char+bA-self.size.x+1;bA=self.cursor.pos.x-self.first_visible_char-1 elseif bA<1 then self.first_visible_char=self.first_visible_char+bA;bA=0 end;if bB>=self.size.y then self.first_visible_line=self.first_visible_line+bB-self.size.y+1;bB=self.cursor.pos.y-self.first_visible_line-1 elseif bB<1 then self.first_visible_line=self.first_visible_line+bB;bB=0 end;for C=1,self.size.y do local bj=self.lines[C+self.first_visible_line-1]or""local bC=bj:sub(self.first_visible_char,self.first_visible_char+self.size.x-1)aA:write(self.pos.x,self.pos.y+C-1,bC,self.colors.foreground)end;if self.cursor.visible then aA:write(bA+self.pos.x,bB+self.pos.y,self.cursor.text,self.colors.cursor_text,self.colors.cursor)end end,event=function(self,b6)if self.hidden then return false end;if not self.editable then return false end;if b6.name==b.TOUCH then if ai.is_area_pressed(b6.x,b6.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then local B=b6.x-self.pos.x;local C=b6.y-self.pos.y;self:set_cursor(B+self.first_visible_char,C+self.first_visible_line)self:focus(true,b6)self.callbacks.onPress(self,b6)return true else self:focus(false,b6)self.callbacks.onFailedPress(self,b6)return false end elseif b6.name==b.DELETED then self:focus(false,b6)return false end;if self.focussed then self.cursor.blink:event(self.cursor.blink,b6)if b6.name==b.PASTE then self:write(b6.paste)elseif b6.name==b.CHAR then if self.callbacks.onChar(self,b6)then return true end;self:write(b6.char)elseif b6.name==b.KEY then if self.callbacks.onKey(self,b6)then return true end;if b6.key==b.KEY_UP then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y-1)elseif b6.key==b.KEY_DOWN then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)elseif b6.key==b.KEY_RIGHT then local bj=self.lines[self.cursor.pos.y]if self.lines[self.cursor.pos.y+1]and self.cursor.pos.x>=#bj+1 then self:set_cursor(1,self.cursor.pos.y+1)else self:set_cursor(self.cursor.pos.x+1,self.cursor.pos.y)end elseif b6.key==b.KEY_LEFT then if self.cursor.pos.x<=1 and self.cursor.pos.y>1 then local bD=self.lines[self.cursor.pos.y-1]self:set_cursor(#bD+1,self.cursor.pos.y-1)else self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif b6.key==b.KEY_BACKSPACE then local bj=self.lines[self.cursor.pos.y]if self.cursor.pos.x<=1 then if self.cursor.pos.y>1 then table.remove(self.lines,self.cursor.pos.y)local bE=#self.lines[self.cursor.pos.y-1]+1;local bF=self.cursor.pos.y-1;self:set_cursor(bE,bF)self:write(bj)self:set_cursor(bE,bF)end else self.lines[self.cursor.pos.y]=bj:sub(1,self.cursor.pos.x-2)..bj:sub(self.cursor.pos.x)self:set_cursor(self.cursor.pos.x-1,self.cursor.pos.y)end elseif b6.key==b.KEY_DELETE then local bj=self.lines[self.cursor.pos.y]local bG=bj:sub(self.cursor.pos.x)if#bG>0 then self.lines[self.cursor.pos.y]=bj:sub(1,self.cursor.pos.x-1)..bj:sub(self.cursor.pos.x+1)else local bH=self.lines[self.cursor.pos.y+1]if bH then local bE=self.cursor.pos.x;local bF=self.cursor.pos.y;table.remove(self.lines,self.cursor.pos.y+1)self:write(bH)self:set_cursor(bE,bF)end end elseif b6.key==b.KEY_ENTER then self:write("\n")elseif b6.key==b.KEY_TAB then self:write("  ")end elseif b6.name==b.MOUSESCROLL then self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+b6.direction)end;return true end end,focus=function(self,bI,b6)if bI then self.focussed=true;self.callbacks.onFocus(self,b6)else self.focussed=false;self.cursor.visible=false;self.callbacks.onFocus(self,b6)end end,set_cursor=function(self,bE,bF,bJ)if not self.lines[1]then self.lines[1]=""end;if self.limits.y>0 then bF=A.constrain(bF,1,self.limits.y)end;if bJ then for C=#self.lines+1,bF do if not self.lines[C]then self.lines[C]=""end end else bF=A.constrain(bF,1,#self.lines)end;bE=A.constrain(bE,1,#self.lines[bF]+1)self.cursor.pos=A.Vector2.new(bE,bF)end,write=function(self,...)local aK=j.join({...},"")local bi=j.split(aK,"\n")self:set_cursor(self.cursor.pos.x,self.cursor.pos.y,true)if#self.whitelist>0 then local bK="[^"..j.escape_magic_characters(j.join(self.whitelist,"")).."]"for d,bj in next,bi do bi[d]=bj:gsub(bK,"")end elseif#self.blacklist>0 then local bK="["..j.escape_magic_characters(j.join(self.blacklist,"")).."]"for d,bj in next,bi do bi[d]=bj:gsub(bK,"")end end;if self.limits.y>0 then for C=1,#self.lines+#bi-1-self.limits.y do table.remove(bi)end;if#bi==0 then return end end;if#bi>1 then for bL,bj in next,bi do if bL==1 then local bM=self.lines[self.cursor.pos.y]local bN=bM:sub(1,self.cursor.pos.x-1)local bG=bM:sub(self.cursor.pos.x)local bO=bi[#bi]if self.limits.x>0 then bj=bj:sub(1,self.limits.x-#bN)bO=bO:sub(1,self.limits.x-#bG)end;self.lines[self.cursor.pos.y]=bN..bj;self:set_cursor(1,self.cursor.pos.y+1,true)table.insert(self.lines,self.cursor.pos.y,bO..bG)self:set_cursor(#bO+1,self.cursor.pos.y)elseif bL==#bi then break else if self.limits.x>0 then bj=bj:sub(1,self.limits.x)end;table.insert(self.lines,self.cursor.pos.y,bj)self:set_cursor(self.cursor.pos.x,self.cursor.pos.y+1)end end else local bM=self.lines[self.cursor.pos.y]local bN=bM:sub(1,self.cursor.pos.x-1)local bG=bM:sub(self.cursor.pos.x)if self.limits.x>0 then bi[1]=bi[1]:sub(1,self.limits.x-(#bN+#bG))end;self.lines[self.cursor.pos.y]=bN..bi[1]..bG;self:set_cursor(self.cursor.pos.x+#bi[1],self.cursor.pos.y)end end,print=function(self,...)local aK=j.join({...},"\n").."\n"self:write(aK)end,clear=function(self)self.lines={""}self:set_cursor(1,1)end},Window={new=function(B,C,al,am,aw,bP)local bQ={draw_priority=b.HIGH_PRIORITY,focussed=false,hidden=false,pos=A.Vector2.new(B,C),size=A.Vector2.new(al,am),drag_options={enabled=true,from=A.Vector2.new(1,1)},shadow={enabled=bP,offset=A.Vector2.new(1,1)},elements={},colors={background=aw,shadow=colors.black},callbacks={onDraw=function()end,onPress=function()end,onFailedPress=function()end,onFocus=function()end}}setmetatable(bQ,be.Window)return bQ end,draw=function(self)if self.hidden then return end;self.callbacks.onDraw(self)if self.shadow.enabled then aA:rectangle(self.pos.x+self.shadow.offset.x,self.pos.y+self.shadow.offset.y,self.size.x,self.size.y,self.colors.shadow)end;aA:rectangle(self.pos.x,self.pos.y,self.size.x,self.size.y,self.colors.background)self:draw_elements()end,event=function(self,b6)if self.hidden then return false end;local bR=self:event_elements(b6)if not bR then if b6.name==b.TOUCH then if ai.is_area_pressed(b6.x,b6.y,self.pos.x,self.pos.y,self.size.x,self.size.y)then self.drag_options.from=A.Vector2.new(b6.x,b6.y)self.focussed=true;self.callbacks.onPress(self,b6)self.callbacks.onFocus(self,b6)return true else self.focussed=false;self.callbacks.onFailedPress(self,b6)self.callbacks.onFocus(self,b6)end elseif b6.name==b.MOUSEDRAG and self.focussed then self:drag(b6.x,b6.y)return true elseif b6.name==b.DELETED then self.focussed=false;self.callbacks.onFocus(self,b6)end else self.focussed=false;self.callbacks.onFocus(self,b6)end;return bR end,drag=function(self,B,C)if self.drag_options.enabled then local bS=A.Vector2.new(B-self.drag_options.from.x,C-self.drag_options.from.y)self.pos=self.pos+bS;for d,bT in next,self.elements do if bT.pos then bT.pos=bT.pos+bS end end;self.drag_options.from=A.Vector2.new(B,C)end end,set_elements=function(self,bU,bV)self.elements={}for d,bT in next,bU do if bV then bT.pos=self.pos+bT.pos-A.Vector2.ONE end;table.insert(self.elements,bT)end end,draw_elements=function(self)for d=#self.elements,1,-1 do local bT=self.elements[d]if bT.draw then bT:draw()end end end,event_elements=function(self,b6)local bR=false;for d,bT in next,self.elements do if bT.event then local bW=bT:event(b6)bR=bR or bW;if bW then b6={name=b.DELETED}end end end;return bR end}}be.Clock.__index=be.Clock;be.Label.__index=be.Label;be.Button.__index=be.Button;be.Progressbar.__index=be.Progressbar;be.Memo.__index=be.Memo;be.Window.__index=be.Window;local bX={}bX={new=function(bY,bZ)local b_={options={enabled=false,FPS_target=bY,EPS_target=bZ},monitors={terminal=term},elements={high_priority={},low_priority={},loop={clock=be.Clock.new(1/bY),stats_clock=be.Clock.new(1),FPS_label=be.Label.new(1,1,"1 FPS",colors.white),EPS_label=be.Label.new(1,2,"1 EPS",colors.white)}},stats={pos=A.Vector2.new(1,1),elements=nil,enabled=true,enable=function(self,c0)self.enabled=c0;self.elements.stats_clock.enabled=c0;self.elements.FPS_label.hidden=not c0;self.elements.EPS_label.hidden=not c0 end,update_pos=function(self)self.elements.FPS_label.pos=self.pos;self.elements.EPS_label.pos=self.pos+A.Vector2.DOWN end,FPS=0,EPS=0},callbacks={onStart=function()end,onStop=function()end,onDraw=function()end,onClock=function()end,onEvent=function()end}}b_.elements.loop.stats_clock.stats=b_.stats;b_.stats.elements=b_.elements.loop;e.set_callback(b_.elements.loop.stats_clock,b.ONCLOCK,function(self,b6)self.stats:update_pos()self.stats.elements.FPS_label.text=tostring(self.stats.FPS).." FPS"self.stats.elements.EPS_label.text=tostring(self.stats.EPS).." EPS"self.stats.FPS=0;self.stats.EPS=0 end)b_.stats:enable(false)setmetatable(b_,bX)return b_ end,set_monitors=function(self,ar)self.monitors=aq.get_monitors(ar)end,set_elements=function(self,bU)self.elements.high_priority={}self.elements.low_priority={}for d,n in next,bU do if n.draw_priority==b.HIGH_PRIORITY then table.insert(self.elements.high_priority,n)else table.insert(self.elements.low_priority,n)end end end,draw_elements=function(self)local function c1(k)for d=#k,1,-1 do local bT=k[d]if bT.draw then bT:draw()end end end;self.callbacks.onDraw(self)local c2=aA.screens;aA.screens=self.monitors;c1(self.elements.low_priority)c1(self.elements.high_priority)for d,bT in next,self.elements.loop do if bT.draw then bT:draw()end end;aA:draw()aA.screens=c2;if self.stats.enabled then self.stats.FPS=self.stats.FPS+1 end end,event_elements=function(self,b6)local function an(k)for d,bT in next,k do if bT.event then if bT:event(b6)then b6={name=b.DELETED}end end end end;if self.callbacks.onEvent(self,b6)then b6={name=b.DELETED}end;if b6.name==b.TOUCH then local c3=false;for c4,au in next,self.monitors do if b6.from==c4 then c3=true;break end end;if not c3 then b6={name=b.DELETED}end end;an(self.elements.loop)local c5={}for d,bT in next,self.elements.high_priority do if bT.event then local c6=bT:event(b6)if c6 then b6={name=b.DELETED}if self.elements.high_priority~=bT then table.insert(c5,{element=bT,key=d})end end end end;if#c5>0 then for d,n in next,c5 do table.insert(self.elements.high_priority,1,n.element)table.remove(self.elements.high_priority,n.key+#c5)end end;an(self.elements.low_priority)if self.stats.enabled then self.stats.EPS=self.stats.EPS+1 end end,start=function(self)self.enabled=true;b2:reset()e.set_callback(self.elements.loop.clock,b.ONCLOCK,function(c7,b6)self.callbacks.onClock(self,b6)self:draw_elements()c7.interval=1/self.options.FPS_target end)self.stats:update_pos()self.callbacks.onStart(self)while self.enabled do local c8=os.startTimer(1/self.options.EPS_target)local c9={os.pullEvent()}local b6=ai.format_event_table(c9)b2:manage_event(b6)self:event_elements(b6)os.cancelTimer(c8)end;b2:reset()self.callbacks.onStop(self)end,stop=function(self)self.enabled=false end}bX.__index=bX;local ca={...}if ca[1]=="help"then local bi={{text="LIBFILE <COMMAND>",foreground=colors.green,background=nil},{text=" - help (shows this list of commands)",foreground=colors.blue,background=nil},{text=" - info (prints info about the lib)",foreground=colors.yellow,background=nil},{text=" - ver (prints version of the lib)",foreground=colors.green,background=nil},{text=" - copyright (prints copyright of the lib)",foreground=colors.blue,background=nil},{text=" - setup (adds YAGUI_PATH to computer's settings)",foreground=colors.yellow,background=nil},{text=" - create <PATH> (creates a new YAGUI project)",foreground=colors.green,background=nil}}for d,bj in next,bi do aq.better_print(term,bj.foreground,bj.background,bj.text)end elseif ca[1]=="info"then aq.better_print(term,colors.red,nil,"Library Version: ",a.ver)aq.better_print(term,colors.yellow,nil,"Library Author: ",a.author)aq.better_print(term,colors.green,nil,"Library Website: ",a.website)aq.better_print(term,colors.blue,nil,"Library Documentation: ",a.documentation)elseif ca[1]=="ver"then aq.better_print(term,colors.red,nil,"Library Version: ",a.ver)elseif ca[1]=="copyright"then local cb={colors.red,colors.yellow,colors.green}local cc=j.split(a.copyright,"\n\n")for d,cd in next,cc do aq.better_print(term,cb[d],nil,cd)if d<#cc then read("")end end elseif ca[1]=="setup"then if shell then local ce="YAGUI_PATH"local x="/"..shell.getRunningProgram()ao.set(ce,x)aq.better_print(term,colors.green,nil,"Lib path was set to \"",ao.get(ce),"\".")else aq.better_print(term,colors.red,nil,"SHELL API ISN'T AVAILABLE!")end elseif ca[1]=="create"then if ca[2]then local x=shell.resolve(ca[2])local ap=fs.getName(x):lower()if j.get_extension(x)~="lua"then x=x..".lua"end;if fs.exists(x)then aq.better_print(term,colors.red,nil,"PATH: \"/",x,"\" already exists, please use another path or delete it.")else local cf=fs.open(x,"w")cf.write("\n-- AUTO-GENERATED with \"YAGUI create\"\nlocal YAGUI_PATH = settings.get(\"YAGUI_PATH\")\nif not (type(YAGUI_PATH) == \"string\") then printError(\"YAGUI is not installed, please install it by opening it with argument \\\"setup\\\".\"); return; end\nif not fs.exists(YAGUI_PATH) then printError(\"Couldn't find YAGUI in path: \\\"\"..YAGUI_PATH..\"\\\", Please reinstall it by opening it with argument \\\"setup\\\".\"); return; end\nlocal YAGUI = dofile(YAGUI_PATH)\n-- End of AUTO-GENERATED code\n\n")cf.close()aq.better_print(term,colors.green,nil,"New project was created at \"/",x,"\".")end else aq.better_print(term,colors.red,nil,"You must specify a path to create a new project.")end elseif ca[1]then aq.better_print(term,colors.red,nil,"UNKNOWN COMMAND: \"",ca[1],"\"")aq.better_print(term,colors.green,nil,"Use \"help\" to get a list of available commands!")end;local cg={info=a,generic_utils=e,string_utils=j,math_utils=A,table_utils=Z,color_utils=ae,event_utils=ai,setting_utils=ao,monitor_utils=aq,screen_buffer=aA,input=b2,WSS=b7,wireless_screen_share=b7,gui_elements=be,Loop=bX}for d,n in next,b do cg[d]=n end;return cg